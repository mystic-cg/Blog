<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>我还是个宝宝!</title>
  
  <subtitle>宝宝,就是我,耶~</subtitle>
  <link href="https://blog.caoyu.info/atom.xml" rel="self"/>
  
  <link href="https://blog.caoyu.info/"/>
  <updated>2024-12-01T01:17:32.000Z</updated>
  <id>https://blog.caoyu.info/</id>
  
  <author>
    <name>紫玄</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Winter in 2024</title>
    <link href="https://blog.caoyu.info/2024-Winter.html"/>
    <id>https://blog.caoyu.info/2024-Winter.html</id>
    <published>2024-12-01T01:17:32.000Z</published>
    <updated>2024-12-01T01:17:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Welcome</h1><p>Welcome to the quiet beauty of Winter in 2024.</p><p>Winter wind howls through the trees.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;Welcome to the quiet beauty of Winter in 2024.&lt;/p&gt;
&lt;p&gt;Winter wind howls through the trees.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="time" scheme="https://blog.caoyu.info/categories/time/"/>
    
    
    <category term="time" scheme="https://blog.caoyu.info/tags/time/"/>
    
    <category term="2024" scheme="https://blog.caoyu.info/tags/2024/"/>
    
    <category term="Winter" scheme="https://blog.caoyu.info/tags/Winter/"/>
    
  </entry>
  
  <entry>
    <title>My Open Source Project &quot;husky-rs&quot;</title>
    <link href="https://blog.caoyu.info/mosp-husky-rs.html"/>
    <id>https://blog.caoyu.info/mosp-husky-rs.html</id>
    <published>2024-10-01T10:47:20.000Z</published>
    <updated>2024-10-02T10:41:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1>husky-rs</h1><p><strong>husky-rs</strong> is a lightweight Git hook manager tailored for Rust projects.</p><ul><li><a href="https://github.com/pplmx/husky-rs">View husky-rs on GitHub</a></li><li><a href="https://crates.io/crates/husky-rs">Get husky-rs on crates.io</a></li></ul><h2 id="Key-Features">Key Features</h2><ul><li><strong>Easy Integration</strong>: Seamlessly integrates into your Rust projects with minimal setup.</li><li><strong>Automated Efficiency</strong>: Executes automated tasks via Git hooks, improving team collaboration and productivity.</li><li><strong>Flexible Customization</strong>: Supports a wide variety of Git hooks, allowing for extensive configuration to meet your project’s needs.</li></ul><p>Explore the project on <a href="https://github.com/pplmx/husky-rs">GitHub</a> for more details and contribute to its development!</p>]]></content>
    
    
    <summary type="html">A git hook manager for Rust projects</summary>
    
    
    
    <category term="mosp" scheme="https://blog.caoyu.info/categories/mosp/"/>
    
    
    <category term="hook" scheme="https://blog.caoyu.info/tags/hook/"/>
    
    <category term="hooks" scheme="https://blog.caoyu.info/tags/hooks/"/>
    
    <category term="git-hook" scheme="https://blog.caoyu.info/tags/git-hook/"/>
    
    <category term="git-hooks" scheme="https://blog.caoyu.info/tags/git-hooks/"/>
    
    <category term="husky" scheme="https://blog.caoyu.info/tags/husky/"/>
    
    <category term="husky-rs" scheme="https://blog.caoyu.info/tags/husky-rs/"/>
    
  </entry>
  
  <entry>
    <title>My Open Source Project &quot;template&quot;</title>
    <link href="https://blog.caoyu.info/mosp-template.html"/>
    <id>https://blog.caoyu.info/mosp-template.html</id>
    <published>2024-10-01T10:47:20.000Z</published>
    <updated>2024-10-02T10:41:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1>template</h1><p><strong>template</strong> is a powerful tool for generating boilerplate code, supporting a variety of programming languages.</p><ul><li><a href="https://github.com/x-pt/template">View template on GitHub</a></li><li><a href="https://x-pt.github.io">Visit the project page</a></li></ul><h2 id="Key-Features">Key Features</h2><ul><li><strong>Multi-language Template Generation</strong>:<blockquote><p>Automatically generates project templates for multiple languages including Rust, Go, Python, C++, TypeScript, and more.</p></blockquote></li><li><strong>GitHub Actions Integration</strong>:<blockquote><p>Deeply integrated with GitHub Actions to provide built-in CI/CD pipelines, auto-issue labeling, automated releases, and more.</p></blockquote></li><li><strong>Streamlined Project Automation</strong>:<blockquote><p>Includes ready-to-use configurations for common tasks like continuous integration (CI), continuous deployment (CD), and project maintenance, minimizing manual setup.</p></blockquote></li></ul><p>Check out the repository on <a href="https://github.com/x-pt/template">GitHub</a> to explore how <strong>template</strong> can simplify your project workflows and contribute to its ongoing development!</p>]]></content>
    
    
    <summary type="html">A project to generate boilerplate code for various programming languages with deep GitHub Actions integration</summary>
    
    
    
    <category term="mosp" scheme="https://blog.caoyu.info/categories/mosp/"/>
    
    
    <category term="template" scheme="https://blog.caoyu.info/tags/template/"/>
    
    <category term="boilerplate" scheme="https://blog.caoyu.info/tags/boilerplate/"/>
    
  </entry>
  
  <entry>
    <title>Autumn in 2024</title>
    <link href="https://blog.caoyu.info/2024-Autumn.html"/>
    <id>https://blog.caoyu.info/2024-Autumn.html</id>
    <published>2024-09-01T01:23:36.000Z</published>
    <updated>2024-09-01T01:23:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Welcome</h1><p>Welcome to the colorful and reflective season of Autumn in 2024.</p><p>Autumn leaves fall gently to the ground.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;Welcome to the colorful and reflective season of Autumn in 2024.&lt;/p&gt;
&lt;p&gt;Autumn leaves fall gently to the ground.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="time" scheme="https://blog.caoyu.info/categories/time/"/>
    
    
    <category term="time" scheme="https://blog.caoyu.info/tags/time/"/>
    
    <category term="Autumn" scheme="https://blog.caoyu.info/tags/Autumn/"/>
    
    <category term="2024" scheme="https://blog.caoyu.info/tags/2024/"/>
    
  </entry>
  
  <entry>
    <title>Summer in 2024</title>
    <link href="https://blog.caoyu.info/2024-Summer.html"/>
    <id>https://blog.caoyu.info/2024-Summer.html</id>
    <published>2024-06-01T01:24:18.000Z</published>
    <updated>2024-06-01T01:24:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Welcome</h1><p>Welcome to the vibrant warmth of Summer in 2024.</p><p>Summer sun shines brightly, warming the earth.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;Welcome to the vibrant warmth of Summer in 2024.&lt;/p&gt;
&lt;p&gt;Summer sun shines brightly, warming the earth.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="time" scheme="https://blog.caoyu.info/categories/time/"/>
    
    
    <category term="time" scheme="https://blog.caoyu.info/tags/time/"/>
    
    <category term="Summer" scheme="https://blog.caoyu.info/tags/Summer/"/>
    
    <category term="2024" scheme="https://blog.caoyu.info/tags/2024/"/>
    
  </entry>
  
  <entry>
    <title>How to get the Patchset Number from a Gerrit Event in a Jenkins Pipeline</title>
    <link href="https://blog.caoyu.info/jenkins-pipeline-gerrit-patchset.html"/>
    <id>https://blog.caoyu.info/jenkins-pipeline-gerrit-patchset.html</id>
    <published>2024-04-11T06:25:42.000Z</published>
    <updated>2024-04-11T06:25:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Retrieving the Patchset Number from a Gerrit Event</h1><h2 id="clone-by-http">clone by http</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123; skipDefaultCheckout() &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Checkout PatchSet&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(</span><br><span class="line">                    <span class="symbol">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;FETCH_HEAD&#x27;</span>]],</span><br><span class="line">                    <span class="symbol">extensions:</span> [</span><br><span class="line">                        cloneOption(</span><br><span class="line">                            <span class="symbol">depth:</span> <span class="number">1</span>,</span><br><span class="line">                            <span class="symbol">shallow:</span> <span class="literal">true</span>,</span><br><span class="line">                            <span class="symbol">noTags:</span> <span class="literal">true</span>,</span><br><span class="line">                        )</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="symbol">userRemoteConfigs:</span> [[</span><br><span class="line">                        <span class="symbol">refspec:</span> <span class="string">&#x27;$&#123;GERRIT_REFSPEC&#125;&#x27;</span>,</span><br><span class="line">                        <span class="symbol">url:</span> <span class="string">&#x27;https://$&#123;GERRIT_HOST&#125;/$&#123;GERRIT_PROJECT&#125;&#x27;</span></span><br><span class="line">                    ]]</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="clone-by-ssh">clone by ssh</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123; skipDefaultCheckout() &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Checkout PatchSet&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(</span><br><span class="line">                    <span class="symbol">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;FETCH_HEAD&#x27;</span>]],</span><br><span class="line">                    <span class="symbol">extensions:</span> [</span><br><span class="line">                        cloneOption(</span><br><span class="line">                            <span class="symbol">depth:</span> <span class="number">1</span>,</span><br><span class="line">                            <span class="symbol">shallow:</span> <span class="literal">true</span>,</span><br><span class="line">                            <span class="symbol">noTags:</span> <span class="literal">true</span>,</span><br><span class="line">                        ),</span><br><span class="line">                        [<span class="attr">$class:</span> <span class="string">&#x27;UserIdentity&#x27;</span>, <span class="attr">email:</span> <span class="string">&#x27;jenkins@x.internal&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;Jenkins&#x27;</span>]</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="symbol">userRemoteConfigs:</span> [[</span><br><span class="line">                        <span class="symbol">credentialsId:</span> <span class="string">&#x27;&lt;CRED_ID&gt;&#x27;</span>,</span><br><span class="line">                        <span class="symbol">refspec:</span> <span class="string">&#x27;$&#123;GERRIT_REFSPEC&#125;&#x27;</span>,</span><br><span class="line">                        <span class="symbol">url:</span> <span class="string">&quot;ssh://jenkins@$&#123;GERRIT_HOST&#125;:$&#123;GERRIT_PORT&#125;/$&#123;GERRIT_PROJECT&#125;&quot;</span></span><br><span class="line">                    ]]</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Get Patchset Number from a Gerrit Event in a Jenkins Pipeline</summary>
    
    
    
    <category term="ci" scheme="https://blog.caoyu.info/categories/ci/"/>
    
    
    <category term="ci" scheme="https://blog.caoyu.info/tags/ci/"/>
    
    <category term="jenkins" scheme="https://blog.caoyu.info/tags/jenkins/"/>
    
    <category term="gerrit" scheme="https://blog.caoyu.info/tags/gerrit/"/>
    
    <category term="pipeline" scheme="https://blog.caoyu.info/tags/pipeline/"/>
    
    <category term="groovy" scheme="https://blog.caoyu.info/tags/groovy/"/>
    
  </entry>
  
  <entry>
    <title>Export Data from MySQL by mysqldump</title>
    <link href="https://blog.caoyu.info/mysql-export-data.html"/>
    <id>https://blog.caoyu.info/mysql-export-data.html</id>
    <published>2024-03-13T07:47:20.000Z</published>
    <updated>2024-03-13T07:47:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1>how to export data from the mysql</h1><h2 id="use-mysqldump">use mysqldump</h2><p>Just for the mysql/mariadb using:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker container run -it --<span class="built_in">rm</span> mysql:8 bash -c <span class="string">&quot;echo -e &#x27;[mysqldump]\nuser=aurora\npassword=aurora&#x27; &gt; ~/.my.cnf &amp;&amp; \</span></span><br><span class="line"><span class="string">    mysqldump -h 192.168.91.199 your_database_name&quot;</span> &gt; exported.sql</span><br></pre></td></tr></table></figure><p>For the SQLite compatibility:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker container run -it --<span class="built_in">rm</span> mysql:8 bash -c <span class="string">&quot;echo -e &#x27;[mysqldump]\nuser=aurora\npassword=aurora&#x27; &gt; ~/.my.cnf &amp;&amp; \</span></span><br><span class="line"><span class="string">    mysqldump --compact --no-create-info --skip-add-locks --complete-insert -h 192.168.91.199 your_database_name \</span></span><br><span class="line"><span class="string">        table1 \</span></span><br><span class="line"><span class="string">        table2 \</span></span><br><span class="line"><span class="string">        table3 \</span></span><br><span class="line"><span class="string">        table4&quot;</span> &gt; exported.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Some Compatible Options for SQLite</span></span><br><span class="line"><span class="comment">## because the sqlite cannot parse the &quot;\&#x27;&quot;, we should use double single quote instead</span></span><br><span class="line">sed -i <span class="string">&quot;s/\\\&#x27;/&#x27;&#x27;/g&quot;</span> exported.sql</span><br></pre></td></tr></table></figure><h2 id="Explanation-in-Details">Explanation in Details</h2><p><code>docker container run -it --rm mysql:8 bash -c</code>:</p><ul><li><code>mysql:8</code> is the image name and tag</li><li><code>-it</code> is to run the container in interactive mode</li><li><code>--rm</code> is to remove the container after it is stopped</li><li><code>bash -c</code> is to run the command in the container</li></ul><p>The left is a combined command to create a <code>.my.cnf</code> file and run <code>mysqldump</code> command.</p><ul><li><code>echo -e '[mysqldump]\nuser=aurora\npassword=aurora' &gt; ~/.my.cnf</code> is to create a <code>.my.cnf</code> file at <code>$HOME</code> with the content  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqldump]</span><br><span class="line">user=aurora</span><br><span class="line">password=aurora</span><br></pre></td></tr></table></figure></li><li><code>--compact</code> is to use the compact format, which aims to remove the Comment Syntax, the <code>/*!</code> and <code>*/</code> are removed</li><li><code>--no-create-info</code> is to skip the <code>CREATE TABLE</code> statement, because the statement is not compatible with SQLite</li><li><code>--skip-add-locks</code> is to skip the <code>LOCK TABLES</code> statement, because the statement is not compatible with SQLite</li><li><code>--complete-insert</code> is to use the <code>INSERT INTO</code> statement with the column names</li><li><code>-h</code> is to specify the db host</li><li><code>your_database_name</code> is the database name</li><li><code>table1 table2 table3 table4</code> are the exported table names, separated by space; if not specified, all tables will be exported</li><li><code>&gt; exported.sql</code> is to redirect the output to a file named <code>exported.sql</code>, at the host current directory</li></ul>]]></content>
    
    
    <summary type="html">Use mysqldump to export data from MySQL/MariaDB, and make it compatible with SQLite</summary>
    
    
    
    <category term="database" scheme="https://blog.caoyu.info/categories/database/"/>
    
    
    <category term="database" scheme="https://blog.caoyu.info/tags/database/"/>
    
    <category term="mysql" scheme="https://blog.caoyu.info/tags/mysql/"/>
    
    <category term="mariadb" scheme="https://blog.caoyu.info/tags/mariadb/"/>
    
    <category term="sqlite" scheme="https://blog.caoyu.info/tags/sqlite/"/>
    
  </entry>
  
  <entry>
    <title>Spring in 2024</title>
    <link href="https://blog.caoyu.info/2024-Spring.html"/>
    <id>https://blog.caoyu.info/2024-Spring.html</id>
    <published>2024-03-01T01:18:40.000Z</published>
    <updated>2024-03-01T01:18:40.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Welcome</h1><p>Welcome to the renewal and growth of Spring in 2024.</p><p>Spring rain brings new life to the world.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;Welcome to the renewal and growth of Spring in 2024.&lt;/p&gt;
&lt;p&gt;Spring rain brings new life to the world.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="time" scheme="https://blog.caoyu.info/categories/time/"/>
    
    
    <category term="time" scheme="https://blog.caoyu.info/tags/time/"/>
    
    <category term="2024" scheme="https://blog.caoyu.info/tags/2024/"/>
    
    <category term="Spring" scheme="https://blog.caoyu.info/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Use node 18/20 on CentOS 7</title>
    <link href="https://blog.caoyu.info/centos7-install-node-18-20.html"/>
    <id>https://blog.caoyu.info/centos7-install-node-18-20.html</id>
    <published>2024-02-28T13:47:20.000Z</published>
    <updated>2024-02-28T13:47:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1>how to use node 18/20 on centos7</h1><h2 id="install-node-by-nvm">install node by nvm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install nvm</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># install node</span></span><br><span class="line">nvm ls-remote --lts</span><br><span class="line"></span><br><span class="line"><span class="comment"># node 16 is lts/gallium, node 20 is lts/iron</span></span><br><span class="line">nvm install lts/gallium</span><br><span class="line">nvm install lts/iron</span><br><span class="line"></span><br><span class="line"><span class="comment"># check node version</span></span><br><span class="line">nvm <span class="built_in">alias</span> default lts/gallium</span><br><span class="line">node -v</span><br><span class="line"></span><br><span class="line">nvm <span class="built_in">alias</span> default lts/iron</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure><p>You will find that node 16 works well, but node 20 will not work, because the <code>glibc</code> version is too low.<br>That's so bad, but don't worry; we can fix it by the following steps.</p><h2 id="install-glibc-2-31-and-libstdc-so-6-0-25">install glibc 2.31 and libstdc++.so.6.0.25</h2><p>Follow my another article <a href="https://blog.caoyu.info/centos7-upgrade-libc.html">centos7-upgrade-libc</a> to upgrade <code>glibc</code> to 2.31.</p><h2 id="test">test</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvm <span class="built_in">alias</span> default lts/iron</span><br><span class="line">node -v <span class="comment"># it works well</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">How to use node 18/20 on CentOS 7</summary>
    
    
    
    <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="centos7" scheme="https://blog.caoyu.info/tags/centos7/"/>
    
  </entry>
  
  <entry>
    <title>How to upgrade glibc on CentOS 7</title>
    <link href="https://blog.caoyu.info/centos7-upgrade-libc.html"/>
    <id>https://blog.caoyu.info/centos7-upgrade-libc.html</id>
    <published>2024-02-28T13:45:20.000Z</published>
    <updated>2024-08-18T03:03:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>how to upgrade glibc on centos7</h1><blockquote><p><strong>⚠ WARNING: Upgrading GLIBC on CentOS 7 is a high-risk operation!</strong></p><p>This process can potentially break your system, especially if done incorrectly.</p><p>It is highly recommended to <strong>backup your system</strong> and test the upgrade on a non-production environment first.</p><p>Proceed with caution!</p></blockquote><p>This guide provides step-by-step instructions to upgrade the GNU C Library (glibc) and GCC on CentOS 7, along with handling potential issues.</p><h2 id="check-the-current-version">check the current version</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br><span class="line"></span><br><span class="line">locate libc.so.6</span><br><span class="line">locate libstdc++.so.6</span><br><span class="line">strings /usr/lib64/libc.so.6 | grep -E <span class="string">&quot;^GLIBC_&quot;</span></span><br><span class="line">strings /usr/lib64/libstdc++.so.6 | grep -E <span class="string">&quot;^GLIBCXX_&quot;</span></span><br></pre></td></tr></table></figure><h2 id="install-gcc-8">install gcc 8</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y centos-release-scl</span><br><span class="line"><span class="built_in">sudo</span> yum install -y devtoolset-8</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable gcc 8 temporarily</span></span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-8 bash</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-8 zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable gcc 8 permanently</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ -f /opt/rh/devtoolset-8/enable ] &amp;&amp; source /opt/rh/devtoolset-8/enable&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ -f /opt/rh/devtoolset-8/enable ] &amp;&amp; source /opt/rh/devtoolset-8/enable&quot;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the version</span></span><br><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br></pre></td></tr></table></figure><h2 id="install-glibc-2-31">install glibc 2.31</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum groupinstall -y  <span class="string">&quot;Development tools&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y gettext-devel openssl-devel perl-CPAN perl-devel zlib-devel ncurses-devel nss-devel</span><br><span class="line"></span><br><span class="line">GLIBC_VERSION=<span class="string">&quot;2.31&quot;</span></span><br><span class="line"><span class="comment"># GNU=&quot;https://ftp.gnu.org/gnu&quot;</span></span><br><span class="line">GNU_MIRROR=<span class="string">&quot;https://mirrors.aliyun.com/gnu&quot;</span></span><br><span class="line">wget <span class="variable">$&#123;GNU_MIRROR&#125;</span>/glibc/glibc-<span class="variable">$&#123;GLIBC_VERSION&#125;</span>.tar.xz</span><br><span class="line">tar -xf glibc-<span class="variable">$&#123;GLIBC_VERSION&#125;</span>.tar.xz &amp;&amp; <span class="built_in">cd</span> glibc-<span class="variable">$&#123;GLIBC_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> build; <span class="built_in">cd</span> build</span><br><span class="line">../configure --prefix=/usr --with-headers=/usr/include --with-binutils=/usr/bin --disable-profile --enable-add-ons</span><br><span class="line">../configure --prefix=/usr \</span><br><span class="line">    --with-headers=/usr/include \</span><br><span class="line">    --with-binutils=/usr/bin \</span><br><span class="line">    --enable-add-ons \</span><br><span class="line">    --enable-obsolete-nsl \</span><br><span class="line">    --disable-profile \</span><br><span class="line">    --disable-sanity-checks \</span><br><span class="line">    --disable-werror</span><br><span class="line">make -j8</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure><h3 id="issue-ld-cannot-find-lnss-test2">issue: &quot;ld: cannot find -lnss_test2&quot;</h3><p>Maybe you will encounter the following error:</p><blockquote><p>/usr/bin/ld: cannot find -lnss_test2</p></blockquote><p>You can fix it by the following <a href="https://garlicspace.com/2020/07/18/centos7-%E5%8D%87%E7%BA%A7-glibc-gcc/#make_install">this</a>:</p><blockquote><p>vim ../scripts/test-installation.pl +128</p><p>Before changed:</p><pre><code>    &amp;&amp; $name ne &quot;nss_test1&quot; &amp;&amp; $name ne &quot;libgcc_s&quot;) &#123;</code></pre><p>append this condition <code>&amp;&amp; $name ne &quot;nss_test2&quot;</code> to skip the test of nss_test2</p><p>Changed:</p><pre><code>    &amp;&amp; $name ne &quot;nss_test1&quot; &amp;&amp; $name ne &quot;nss_test2&quot; &amp;&amp; $name ne &quot;libgcc_s&quot;) &#123;</code></pre></blockquote><h2 id="upgrade-libstdc-if-necessary">upgrade libstdc++, if necessary</h2><p>After you have installed glibc 2.31, you also replace the old <code>libstdc++.so.6</code> with the new one.</p><p>Before replacing, it looks like this:</p><p><code>ls -l /usr/lib64/libstdc++.so.6*</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx. 1 root root   19 Feb 27 22:24 /usr/lib64/libstdc++.so.6 -&gt; libstdc++.so.6.0.19</span><br><span class="line">-rwxr-xr-x. 1 root root 973K Sep 29  2020 /usr/lib64/libstdc++.so.6.0.19</span><br></pre></td></tr></table></figure><p>We will replace it with <code>libstdc++.so.6.0.25</code>.<br>But how to get it? A simple way is to use docker image to get it, like this:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show the libc and libstdc++ version</span></span><br><span class="line">❯ docker container run -it --<span class="built_in">rm</span> centos:8 bash -c <span class="string">&quot;ls -l /lib64/libc.so.6*&quot;</span></span><br><span class="line">lrwxrwxrwx 1 root root 12 Mar 11  2021 /lib64/libc.so.6 -&gt; libc-2.28.so</span><br><span class="line">❯ docker container run -it --<span class="built_in">rm</span> centos:8 bash -c <span class="string">&quot;ls -l /lib64/libstdc++.so.6*&quot;</span></span><br><span class="line">lrwxrwxrwx 1 root root      19 Oct 12  2020 /lib64/libstdc++.so.6 -&gt; libstdc++.so.6.0.25</span><br><span class="line">-rwxr-xr-x 1 root root 1661392 Oct 12  2020 /lib64/libstdc++.so.6.0.25</span><br><span class="line"></span><br><span class="line"><span class="comment"># start a container and copy libstdc++ to the host</span></span><br><span class="line">docker container run -d --name t1 centos:8 init</span><br><span class="line">docker container <span class="built_in">cp</span> t1:/usr/lib64/libstdc++.so.6.0.25 /var/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># replace the host libstdc++</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /var/tmp/libstdc++.so.6.0.25 /usr/lib64</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -fr /usr/lib64/libstdc++.so.6</span><br><span class="line"><span class="built_in">cd</span> /usr/lib64; <span class="built_in">sudo</span> <span class="built_in">ln</span> -s libstdc++.so.6.0.25 libstdc++.so.6</span><br></pre></td></tr></table></figure><p>Replaced, it looks like this:</p><p><code>ls -l /usr/lib64/libstdc++.so.6*</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx. 1 root root      19 Feb 27 22:24 /usr/lib64/libstdc++.so.6 -&gt; libstdc++.so.6.0.25</span><br><span class="line">-rwxr-xr-x. 1 root root  995840 Sep 29  2020 /usr/lib64/libstdc++.so.6.0.19</span><br><span class="line">-rwxr-xr-x. 1 root root 1661392 Feb 27 22:24 /usr/lib64/libstdc++.so.6.0.25</span><br></pre></td></tr></table></figure><h2 id="Question">Question</h2><h3 id="gnome-terminal-cannot-open">gnome-terminal cannot open</h3><p>try this command: <code>sudo localedef -f UTF-8 -i en_US en_US.UTF-8</code></p>]]></content>
    
    
    <summary type="html">Upgrade glibc from 2.17 to 2.31 on CentOS 7</summary>
    
    
    
    <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="centos7" scheme="https://blog.caoyu.info/tags/centos7/"/>
    
  </entry>
  
  <entry>
    <title>Bootstrap a CentOS 7 server</title>
    <link href="https://blog.caoyu.info/centos7-init.html"/>
    <id>https://blog.caoyu.info/centos7-init.html</id>
    <published>2024-01-13T03:18:20.000Z</published>
    <updated>2024-02-28T13:43:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1>bootstrap a CentOS 7 server</h1><h2 id="install-gcc-11">install gcc 11</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y centos-release-scl</span><br><span class="line"><span class="built_in">sudo</span> yum install -y devtoolset-11</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable gcc 11 temporarily</span></span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-11 bash</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-11 zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable gcc 11 permanently</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ -f /opt/rh/devtoolset-11/enable ] &amp;&amp; source /opt/rh/devtoolset-11/enable&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ -f /opt/rh/devtoolset-11/enable ] &amp;&amp; source /opt/rh/devtoolset-11/enable&quot;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the version</span></span><br><span class="line">gcc --version</span><br><span class="line">g++ --version</span><br></pre></td></tr></table></figure><h2 id="install-zsh">install zsh</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum groupinstall -y <span class="string">&quot;Development tools&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y gettext-devel openssl-devel perl-CPAN perl-devel zlib-devel ncurses-devel</span><br><span class="line">wget --no-check-certificate https://www.zsh.org/pub/zsh-5.9.tar.xz</span><br><span class="line">tar -xf zsh-5.9.tar.xz</span><br><span class="line"><span class="built_in">cd</span> zsh-5.9</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/usr/local/bin/zsh&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/shells</span><br><span class="line"></span><br><span class="line">chsh -s /usr/local/bin/zsh</span><br></pre></td></tr></table></figure><h2 id="install-git">install git</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check the old git version</span></span><br><span class="line">git --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove the old git</span></span><br><span class="line"><span class="built_in">sudo</span> yum remove -y git</span><br><span class="line"><span class="built_in">sudo</span> yum remove -y git-*</span><br><span class="line"></span><br><span class="line"><span class="comment"># install a repo</span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm</span><br><span class="line"><span class="built_in">sudo</span> yum install -y git</span><br><span class="line"></span><br><span class="line"><span class="comment"># check git version</span></span><br><span class="line">git --version</span><br></pre></td></tr></table></figure><h2 id="install-oh-my-zsh">install oh-my-zsh</h2><p>Follow this <a href="https://blog.caoyu.info/build-server-zsh.html">link</a></p><h2 id="install-cmake">install cmake</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download and extract</span></span><br><span class="line">CMAKE_VERSION=3.28.3</span><br><span class="line">wget https://github.com/Kitware/CMake/releases/download/v<span class="variable">$&#123;CMAKE_VERSION&#125;</span>/cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>.tar.gz</span><br><span class="line">tar -xf cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># compile</span></span><br><span class="line"><span class="built_in">cd</span> cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span></span><br><span class="line">./configure</span><br><span class="line">make -j 8</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># check cmake version</span></span><br><span class="line">cmake --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove cmake source code</span></span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">rm</span> -rf cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>*</span><br></pre></td></tr></table></figure><h3 id="install-docker">install docker</h3><p>FYI: <a href="https://docs.docker.com/engine/install/centos/">install docker</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y docker-buildx-plugin</span><br><span class="line">curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line"><span class="built_in">sudo</span> sh get-docker.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># start docker</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># post installation</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/sbin/groupadd docker</span><br><span class="line"><span class="built_in">sudo</span> /usr/sbin/usermod -aG docker <span class="variable">$USER</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><h3 id="install-java">install java</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm</span><br><span class="line"><span class="built_in">sudo</span> yum install -y ./jdk-17_linux-x64_bin.rpm</span><br><span class="line"><span class="built_in">rm</span> -f jdk-17_linux-x64_bin.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="install-go">install go</h3><p>Follow this <a href="https://blog.caoyu.info/install-binary-file.html">link</a></p><h2 id="install-python-from-source">install python from source</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download and extract</span></span><br><span class="line"><span class="comment"># PYTHON_VERSION=3.12.2</span></span><br><span class="line">PYTHON_VERSION=3.8.18</span><br><span class="line">wget -O /var/tmp/python.tar.xz <span class="string">&quot;https://www.python.org/ftp/python/<span class="variable">$&#123;PYTHON_VERSION&#125;</span>/Python-<span class="variable">$&#123;PYTHON_VERSION&#125;</span>.tar.xz&quot;</span></span><br><span class="line">install -d /var/tmp/python; tar -xf /var/tmp/python.tar.xz -C /var/tmp/python --strip-components 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># compile</span></span><br><span class="line"><span class="built_in">cd</span> /var/tmp/python</span><br><span class="line">./configure --enable-optimizations</span><br><span class="line">make -j 8</span><br><span class="line"><span class="comment"># altinstall will not replace the system python,</span></span><br><span class="line"><span class="comment"># which means you need to use python3.8 and pip3.8 instead of python3 and pip3</span></span><br><span class="line"><span class="built_in">sudo</span> make altinstall</span><br><span class="line"></span><br><span class="line"><span class="comment"># of course, you can use ln -s to make python3.8 as default python3,</span></span><br><span class="line"><span class="comment"># because the centos 7 system python is 2.7</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /usr/local/bin/python3.8 /usr/local/bin/python3</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /usr/local/bin/pip3.8 /usr/local/bin/pip3</span><br></pre></td></tr></table></figure><h2 id="install-node">install node</h2><p>Node 17 is the latest version which supports CentOS 7, due to the <code>glibc</code> version.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install nvm</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># install node</span></span><br><span class="line">nvm ls-remote --lts</span><br><span class="line">nvm install lts/gallium</span><br><span class="line"></span><br><span class="line"><span class="comment"># check node version</span></span><br><span class="line">node -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># config npm mirror</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># or config .npmrc manually</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; ~/.npmrc</span></span><br><span class="line"><span class="string">home=&quot;https://npmmirror.com&quot;</span></span><br><span class="line"><span class="string">registry=&quot;https://registry.npmmirror.com/&quot;</span></span><br><span class="line"><span class="string">electron_mirror=&quot;https://npmmirror.com/mirrors/electron/&quot;</span></span><br><span class="line"><span class="string">electron_custom_dir=&quot;&#123;&#123; version &#125;&#125;&quot;</span></span><br><span class="line"><span class="string">electron_builder_binaries_mirror=&quot;http://npmmirror.com/mirrors/electron-builder-binaries/&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="install-nvim">install nvim</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">NVIM_VERSION=0.9.5</span><br><span class="line">wget https://github.com/neovim/neovim/releases/download/v<span class="variable">$&#123;NVIM_VERSION&#125;</span>/nvim.appimage</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> u+x nvim.appimage &amp;&amp; ./nvim.appimage</span><br><span class="line"></span><br><span class="line"><span class="comment"># if no error, move it to /usr/local/bin</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> nvim.appimage /usr/local/bin/nvim</span><br><span class="line"></span><br><span class="line"><span class="comment"># if error</span></span><br><span class="line">./nvim.appimage --appimage-extract</span><br><span class="line">./squashfs-root/usr/bin/nvim</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> squashfs-root/usr/bin/nvim /usr/local/bin/nvim</span><br><span class="line"></span><br><span class="line"><span class="comment"># check nvim version</span></span><br><span class="line">nvim --version</span><br></pre></td></tr></table></figure><h3 id="install-LunarVim">install LunarVim</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LV_BRANCH=<span class="string">&#x27;release-1.3/neovim-0.9&#x27;</span> bash &lt;(curl -s https://raw.githubusercontent.com/LunarVim/LunarVim/release-1.3/neovim-0.9/utils/installer/install.sh)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the following to ~/.config/lvim/config.lua</span></span><br><span class="line">vim.opt.shiftwidth = 4 -- the number of spaces inserted <span class="keyword">for</span> each indentation</span><br><span class="line">vim.opt.tabstop = 4 -- insert spaces <span class="keyword">for</span> a tab</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Bootstrap a CentOS7 server with some necessary packages</summary>
    
    
    
    <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="centos7" scheme="https://blog.caoyu.info/tags/centos7/"/>
    
  </entry>
  
  <entry>
    <title>Call cxx-static-lib in Go</title>
    <link href="https://blog.caoyu.info/golang-call-cxx-static-lib.html"/>
    <id>https://blog.caoyu.info/golang-call-cxx-static-lib.html</id>
    <published>2023-11-27T05:25:42.000Z</published>
    <updated>2023-11-27T05:25:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1>How to compile and call a CXX-static library in Golang</h1><h2 id="touch-some-files-first">touch some files first</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create a directory for this project</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ./hi/lib; <span class="built_in">cd</span> ./hi</span><br><span class="line"><span class="built_in">touch</span> ./main.go ./lib/hi.h ./lib/hi.cpp</span><br></pre></td></tr></table></figure><h2 id="Create-a-header-file-hi-h">Create a header file: hi.h</h2><p>In comparison with <a href="https://blog.caoyu.info/golang-call-c-static-lib.html">c-static-lib</a>, the header file here has some extra contents</p><blockquote><p>extern &quot;C&quot; { ... }</p></blockquote><p>mainly to be compatible with C++ compilers.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> HI_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HI_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_hi</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// HI_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Create-a-source-file-hi-cpp">Create a source file: hi.cpp</h2><p>Different from <a href="https://blog.caoyu.info/golang-call-c-static-lib.html">c-static-lib</a>, the c++ source file must include the header file.</p><blockquote><p>#include &quot;hi.h&quot;</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hi.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;hi, from C++\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Create-a-main-file-main-go">Create a main file: main.go</h2><p>Compared to <a href="https://blog.caoyu.info/golang-call-cxx-static-lib.html">c-static-lib</a>, the LDFLAGS here has an extra <code>-l stdc++</code> to link the C++<br>standard library.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#cgo CFLAGS: -I $&#123;SRCDIR&#125;/lib</span></span><br><span class="line"><span class="comment">#cgo LDFLAGS: -L $&#123;SRCDIR&#125;/lib -l hi -l stdc++</span></span><br><span class="line"><span class="comment">#include &quot;hi.h&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    C.print_hi()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Compile-the-source-file-into-a-static-library">Compile the source file into a static library</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -c ./lib/hi.cpp -o ./lib/hi.o</span><br><span class="line">ar rcs ./lib/libhi.a ./lib/hi.o</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># go run directly</span></span><br><span class="line">go run main.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># or build and run</span></span><br><span class="line">go build -o bin/hi main.go &amp;&amp; ./bin/hi</span><br></pre></td></tr></table></figure><h2 id="Summary">Summary</h2><p>The key points are different from <a href="https://blog.caoyu.info/golang-call-c-static-lib.html">call c-static-lib</a>:</p><ul><li>use <code>extern &quot;C&quot; &#123; ... &#125;</code> in header file to be compatible with C++ compilers</li><li>source file must include the header file</li><li>add <code>-l stdc++</code> to <code>LDFLAGS</code></li><li>use <code>g++</code> to compile the source file into a static library</li></ul><p>If you are not sure the static lib is <code>c</code> or <code>c++</code>,<br>your golang code can always use the <code>c++</code> way to call it, which is more compatible.</p><blockquote><p>Always add <code>-l stdc++</code> to <code>LDFLAGS</code></p></blockquote><h2 id="FYI">FYI</h2><p><a href="https://github.com/pplmx/cgo_demo">Source Code</a></p>]]></content>
    
    
    <summary type="html">Here is a quick start for call cxx-static-lib in Go on Windows(MinGW)/Linux.</summary>
    
    
    
    <category term="golang" scheme="https://blog.caoyu.info/categories/golang/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="golang" scheme="https://blog.caoyu.info/tags/golang/"/>
    
    <category term="go" scheme="https://blog.caoyu.info/tags/go/"/>
    
    <category term="cgo" scheme="https://blog.caoyu.info/tags/cgo/"/>
    
    <category term="static" scheme="https://blog.caoyu.info/tags/static/"/>
    
    <category term="lib" scheme="https://blog.caoyu.info/tags/lib/"/>
    
    <category term="mingw" scheme="https://blog.caoyu.info/tags/mingw/"/>
    
    <category term="windows" scheme="https://blog.caoyu.info/tags/windows/"/>
    
    <category term="cxx" scheme="https://blog.caoyu.info/tags/cxx/"/>
    
    <category term="g++" scheme="https://blog.caoyu.info/tags/g/"/>
    
  </entry>
  
  <entry>
    <title>Check Network Availability</title>
    <link href="https://blog.caoyu.info/net-check.html"/>
    <id>https://blog.caoyu.info/net-check.html</id>
    <published>2023-11-24T02:45:42.000Z</published>
    <updated>2023-11-24T02:45:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Check Network Availability</h1><p>The following commands can be used to check if a remote host is available on the network.</p><p>Here is an example to check if port 22 on 192.168.21.32 is open.</p><h2 id="Linux">Linux</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nc -zv 192.168.21.32 22</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line">nmap -p 22 192.168.21.32</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or, <span class="keyword">if</span> no output, port is open</span></span><br><span class="line">timeout 1 bash -c &#x27;cat &lt; /dev/null &gt; /dev/tcp/192.168.21.32/22&#x27;</span><br><span class="line">echo &gt;/dev/tcp/192.168.21.32/22</span><br></pre></td></tr></table></figure><h2 id="Windows">Windows</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.21.32 22</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or (PowerShell)</span></span><br><span class="line">Test-NetConnection -ComputerName 192.168.21.32 -Port 22</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Network Availability on Linux and Windows.</summary>
    
    
    
    <category term="network" scheme="https://blog.caoyu.info/categories/network/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="network" scheme="https://blog.caoyu.info/tags/network/"/>
    
    <category term="windows" scheme="https://blog.caoyu.info/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>Call c-static-lib in Go</title>
    <link href="https://blog.caoyu.info/golang-call-c-static-lib.html"/>
    <id>https://blog.caoyu.info/golang-call-c-static-lib.html</id>
    <published>2023-11-24T02:29:42.000Z</published>
    <updated>2023-11-27T05:25:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1>How to compile and call a C-static lib in Golang</h1><h2 id="touch-some-files-first">touch some files first</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create a directory for this project</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ./hi/lib; <span class="built_in">cd</span> ./hi</span><br><span class="line"><span class="built_in">touch</span> ./main.go ./lib/hi.h ./lib/hi.c</span><br></pre></td></tr></table></figure><h2 id="Create-a-header-file-hi-h">Create a header file: hi.h</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> HI_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HI_H</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_hi</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// HI_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Create-a-source-file-hi-c">Create a source file: hi.c</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_hi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hi, from C\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Create-a-main-file-main-go">Create a main file: main.go</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#cgo CFLAGS: -I $&#123;SRCDIR&#125;/lib</span></span><br><span class="line"><span class="comment">#cgo LDFLAGS: -L $&#123;SRCDIR&#125;/lib -l hi</span></span><br><span class="line"><span class="comment">#include &quot;hi.h&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">C.print_hi()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Compile-the-source-file-into-a-static-library">Compile the source file into a static library</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c ./lib/hi.c -o ./lib/hi.o</span><br><span class="line">ar rcs ./lib/libhi.a ./lib/hi.o</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># go run directly</span></span><br><span class="line">go run main.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># or build and run</span></span><br><span class="line">go build -o bin/hi main.go &amp;&amp; ./bin/hi</span><br></pre></td></tr></table></figure><h2 id="FYI">FYI</h2><p><a href="https://github.com/pplmx/cgo_demo">Source Code</a></p>]]></content>
    
    
    <summary type="html">Here is a quick start for call c-static-lib in Go on Windows(MinGW)/Linux.</summary>
    
    
    
    <category term="golang" scheme="https://blog.caoyu.info/categories/golang/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="gcc" scheme="https://blog.caoyu.info/tags/gcc/"/>
    
    <category term="golang" scheme="https://blog.caoyu.info/tags/golang/"/>
    
    <category term="go" scheme="https://blog.caoyu.info/tags/go/"/>
    
    <category term="cgo" scheme="https://blog.caoyu.info/tags/cgo/"/>
    
    <category term="static" scheme="https://blog.caoyu.info/tags/static/"/>
    
    <category term="lib" scheme="https://blog.caoyu.info/tags/lib/"/>
    
    <category term="c" scheme="https://blog.caoyu.info/tags/c/"/>
    
    <category term="mingw" scheme="https://blog.caoyu.info/tags/mingw/"/>
    
    <category term="windows" scheme="https://blog.caoyu.info/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>Why go build/test is so slow on Windows</title>
    <link href="https://blog.caoyu.info/golang-build-slow-on-windows.html"/>
    <id>https://blog.caoyu.info/golang-build-slow-on-windows.html</id>
    <published>2023-11-24T02:25:42.000Z</published>
    <updated>2023-11-24T02:25:42.000Z</updated>
    
    <content type="html"><![CDATA[<style>r { color: Red }o { color: Orange }g { color: Lime }aquamarine { color: aquamarine }pp { color: Violet }aqua { color: aqua }</style><h1>Why <code>go build</code> or <code>go test</code> is <o>so slow</o> on Windows</h1><h2 id="Problem">Problem</h2><p>When you run <code>go build</code> or <code>go test</code> on Windows, it is very slow.</p><p>If <code>go build</code> costs <g>10s</g> on Linux, it may cost <r>70s or more</r> on Windows, which is so annoying.</p><h2 id="Reason">Reason</h2><p>The reason is that Windows Defender scans the files generated by <code>go build</code> or <code>go test</code> in real time, which causes the slow.</p><h2 id="Solution">Solution</h2><p>Exclude the files used by <code>go</code>:</p><ul><li><code>%userprofile%\go\</code></li><li><code>%localappdata%\go-build\</code></li><li><code>&lt;YOUR GO CODE DIR&gt;</code>, e.g. <code>%userprofile%\JetBrains\</code></li></ul><ol><li>Open Windows Defender Security Center</li><li>Click &quot;<pp>Virus &amp; threat protection</pp>&quot;</li><li>Click &quot;<pp>Virus &amp; threat protection settings</pp>&quot;</li><li>Click &quot;<pp>Add or remove exclusions</pp>&quot;</li><li>Click &quot;<pp>Add an exclusion</pp>&quot;</li><li>Click &quot;<pp>Folder</pp>&quot;</li><li>Select the above folders one by one</li></ol><h2 id="BTW">BTW</h2><p>Maybe you can also exclude the process <code>go.exe</code> in &quot;<pp>Exclusions</pp>&quot; page, but I haven't tried it.</p>]]></content>
    
    
    <summary type="html">Let&#39;s investigate why go build/test are so slow on Windows.</summary>
    
    
    
    <category term="golang" scheme="https://blog.caoyu.info/categories/golang/"/>
    
    
    <category term="golang" scheme="https://blog.caoyu.info/tags/golang/"/>
    
    <category term="go" scheme="https://blog.caoyu.info/tags/go/"/>
    
    <category term="windows" scheme="https://blog.caoyu.info/tags/windows/"/>
    
    <category term="build" scheme="https://blog.caoyu.info/tags/build/"/>
    
    <category term="test" scheme="https://blog.caoyu.info/tags/test/"/>
    
  </entry>
  
  <entry>
    <title>Auto release custom func resource in Python</title>
    <link href="https://blog.caoyu.info/python-auto-release-custom-func-resource.html"/>
    <id>https://blog.caoyu.info/python-auto-release-custom-func-resource.html</id>
    <published>2023-09-03T13:57:12.000Z</published>
    <updated>2023-09-03T13:57:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1>how to release a user-defined resource automatically</h1><h2 id="Problem">Problem</h2><p>You want to release a resource returned by a custom function automatically when the resource is no longer needed.</p><h2 id="Solution">Solution</h2><p>According to the <a href="https://docs.python.org/3/reference/datamodel.html#context-managers">Python documentation</a>, a context manager is an object that<br>defines the runtime context to be established when executing a <code>with</code> statement. The context manager's <code>__enter__()</code> method is called when the <code>with</code><br>statement is entered and the context manager's <code>__exit__()</code> method is called when the <code>with</code> statement is exited. The <code>__exit__()</code> method is passed<br>the exception type, value, and traceback. If the <code>with</code> statement exits normally, the exception type, value, and traceback are <code>None</code>.</p><p>Use the <code>contextlib.contextmanager</code> decorator to create a context manager. The function must return a generator that yields exactly one value. The<br>value yielded is bound to the variable in the <code>with</code> statement's <code>as</code> clause. The generator's code block is executed when the <code>with</code> statement is<br>entered and exited.</p><p>The following example shows how to use the <code>contextlib.contextmanager</code> decorator to create a context manager from a function that returns a resource<br>object.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">managed_custom_resource</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    resource = acquire_resource(*args, **kwargs)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> resource</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        release_resource(resource)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">acquire_resource</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;acquire_resource(*args=&#123;&#125;, **kwargs=&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(args, kwargs))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Code to acquire resource, e.g.:</span></span><br><span class="line">    resource = <span class="built_in">object</span>()</span><br><span class="line">    <span class="keyword">return</span> resource</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">release_resource</span>(<span class="params">resource</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;release_resource(resource=&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(resource))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Code to release resource, e.g.:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">How to release a user-defined resource automatically?</summary>
    
    
    
    <category term="python" scheme="https://blog.caoyu.info/categories/python/"/>
    
    
    <category term="python" scheme="https://blog.caoyu.info/tags/python/"/>
    
    <category term="with" scheme="https://blog.caoyu.info/tags/with/"/>
    
    <category term="resource" scheme="https://blog.caoyu.info/tags/resource/"/>
    
    <category term="context manager" scheme="https://blog.caoyu.info/tags/context-manager/"/>
    
  </entry>
  
  <entry>
    <title>Top 30 most-viewed videos in YouTube</title>
    <link href="https://blog.caoyu.info/youtube-most-30-viewed-music-videos.html"/>
    <id>https://blog.caoyu.info/youtube-most-30-viewed-music-videos.html</id>
    <published>2023-09-02T13:02:18.000Z</published>
    <updated>2023-09-02T13:02:18.000Z</updated>
    
    <content type="html"><![CDATA[<style>r { color: Red }o { color: Orange }g { color: Lime }aquamarine { color: aquamarine }pp { color: Violet }aqua { color: aqua }</style><h1>YouTube Most 30 Viewed Music Videos</h1><ul><li>Counting at <aqua>2023-09-02 21:00:00 UTC+8</aqua></li><li>Name with <pp>purple</pp> means for children songs</li></ul><table><thead><tr><th>No.</th><th>Video name</th><th>Views (billions)</th><th>Publication date</th></tr></thead><tbody><tr><td>1.</td><td><a href="https://www.youtube.com/watch?v=XqZsoesa55w"><pp>Baby Shark Dance</pp></a></td><td>13.28</td><td>2016-06-17</td></tr><tr><td>2.</td><td><a href="https://www.youtube.com/watch?v=kJQP7kiw5Fk">Despacito</a></td><td>8.25</td><td>2017-01-12</td></tr><tr><td>3.</td><td><a href="https://www.youtube.com/watch?v=F4tHL8reNCs"><pp>Johny Johny Yes Papa</pp></a></td><td>6.78</td><td>2016-10-08</td></tr><tr><td>4.</td><td><a href="https://www.youtube.com/watch?v=WRVsOCh907o"><pp>Bath Song</pp></a></td><td>6.38</td><td>2018-05-02</td></tr><tr><td>5.</td><td><a href="https://www.youtube.com/watch?v=JGwWNGJdvx8">Shape of You</a></td><td>6.07</td><td>2017-01-30</td></tr><tr><td>6.</td><td><a href="https://www.youtube.com/watch?v=RgKAFK5djSk">See You Again</a></td><td>6.01</td><td>2015-04-06</td></tr><tr><td>7.</td><td><a href="https://www.youtube.com/watch?v=e_04ZrNroTo"><pp>Wheels on the Bus</pp></a></td><td>5.53</td><td>2018-05-24</td></tr><tr><td>8.</td><td><a href="https://www.youtube.com/watch?v=hq3yfQnllfQ"><pp>Phonics Song with Two Words</pp></a></td><td>5.46</td><td>2014-03-06</td></tr><tr><td>9.</td><td><a href="https://www.youtube.com/watch?v=OPf0YbXqDm0">Uptown Funk</a></td><td>5.01</td><td>2014-11-19</td></tr><tr><td>10.</td><td><a href="https://www.youtube.com/watch?v=_nAu9D-8srA&amp;list=PLJny7Hjsq0AznF7I7nV_MkQVdoItluPWc"><pp>Learning Colors</pp></a></td><td>4.96</td><td>2018-02-27</td></tr><tr><td>11.</td><td><a href="https://www.youtube.com/watch?v=9bZkp7q19f0">Gangnam Style</a></td><td>4.88</td><td>2012-07-15</td></tr><tr><td>12.</td><td><a href="https://www.youtube.com/watch?v=KYniUCGPGLs"><pp>Masha and the Bear – Recipe for Disaster</pp></a></td><td>4.56</td><td>2012-01-31</td></tr><tr><td>13.</td><td><a href="https://www.youtube.com/watch?v=FzG4uDgje3M">Dame Tu Cosita</a></td><td>4.43</td><td>2018-04-05</td></tr><tr><td>14.</td><td><a href="https://www.youtube.com/watch?v=k85mRPqvMbE">Axel F</a></td><td>4.03</td><td>2009-06-16</td></tr><tr><td>15.</td><td><a href="https://www.youtube.com/watch?v=09R8_2nJtjg">Sugar</a></td><td>3.92</td><td>2015-01-14</td></tr><tr><td>16.</td><td><a href="https://www.youtube.com/watch?v=hT_nvWreIhg">Counting Stars</a></td><td>3.864</td><td>2013-05-31</td></tr><tr><td>17.</td><td><a href="https://www.youtube.com/watch?v=CevxZvSJLk8">Roar</a></td><td>3.863</td><td>2013-09-05</td></tr><tr><td>18.</td><td><a href="https://www.youtube.com/watch?v=MR5XSOdjKMA"><pp>Baa Baa Black Sheep</pp></a></td><td>3.75</td><td>2018-06-25</td></tr><tr><td>19.</td><td><a href="https://www.youtube.com/watch?v=pRpeEdMmmQ0">Waka Waka (This Time for Africa)</a></td><td>3.71</td><td>2010-06-04</td></tr><tr><td>20.</td><td><a href="https://www.youtube.com/watch?v=fRh_vgS2dFE">Sorry</a></td><td>3.70</td><td>2015-10-22</td></tr><tr><td>21.</td><td><a href="https://www.youtube.com/watch?v=3bLfzgZ-wO8"><pp>Lakdi Ki Kathi</pp></a></td><td>3.666</td><td>2018-06-14</td></tr><tr><td>22.</td><td><a href="https://www.youtube.com/watch?v=lp-EO5I60KA">Thinking Out Loud</a></td><td>3.650</td><td>2014-10-07</td></tr><tr><td>23.</td><td><a href="https://www.youtube.com/watch?v=0KSOMA3QBU0">Dark Horse</a></td><td>3.579</td><td>2014-02-20</td></tr><tr><td>24.</td><td><a href="https://www.youtube.com/watch?v=138nNxXUJXw&amp;t=33s"><pp>Humpty the train on a fruits ride</pp></a></td><td>3.540</td><td>2018-01-26</td></tr><tr><td>25.</td><td><a href="https://www.youtube.com/watch?v=2Vv-BfVoq4g">Perfect</a></td><td>3.530</td><td>2017-11-09</td></tr><tr><td>26.</td><td><a href="https://www.youtube.com/watch?v=60ItHLz5WEA">Faded</a></td><td>3.506</td><td>2015-12-03</td></tr><tr><td>27.</td><td><a href="https://www.youtube.com/watch?v=RBumgq5yVrA">Let Her Go</a></td><td>3.503</td><td>2012-07-25</td></tr><tr><td>28.</td><td><a href="https://www.youtube.com/watch?v=aJOTlE1K90k">Girls Like You</a></td><td>3.472</td><td>2018-05-31</td></tr><tr><td>29.</td><td><a href="https://www.youtube.com/watch?v=YqeW9_5kURI">Lean On</a></td><td>3.449</td><td>2015-03-22</td></tr><tr><td>30.</td><td><a href="https://www.youtube.com/watch?v=NUsoVlDFqZg">Bailando</a></td><td>3.445</td><td>2014-04-11</td></tr></tbody></table><h2 id="FYI">FYI</h2><p><a href="https://www.youtube.com/playlist?list=PLirAqAtl_h2r5g8xGajEwdXd3x1sZh8hC">Most Viewed Videos of All Time</a></p>]]></content>
    
    
    <summary type="html">Show the top 30 most viewed videos in YouTube</summary>
    
    
    
    <category term="music" scheme="https://blog.caoyu.info/categories/music/"/>
    
    
    <category term="youtube" scheme="https://blog.caoyu.info/tags/youtube/"/>
    
    <category term="music" scheme="https://blog.caoyu.info/tags/music/"/>
    
    <category term="video" scheme="https://blog.caoyu.info/tags/video/"/>
    
    <category term="most viewed" scheme="https://blog.caoyu.info/tags/most-viewed/"/>
    
  </entry>
  
  <entry>
    <title>Autumn in 2023</title>
    <link href="https://blog.caoyu.info/2023-Autumn.html"/>
    <id>https://blog.caoyu.info/2023-Autumn.html</id>
    <published>2023-09-01T01:14:46.000Z</published>
    <updated>2023-09-01T01:14:46.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Welcome</h1><p>Welcome to the colorful and reflective season of Autumn in 2023.</p><p>Autumn leaves fall gently to the ground.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;Welcome to the colorful and reflective season of Autumn in 2023.&lt;/p&gt;
&lt;p&gt;Autumn leaves fall gently to the ground.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="time" scheme="https://blog.caoyu.info/categories/time/"/>
    
    
    <category term="time" scheme="https://blog.caoyu.info/tags/time/"/>
    
    <category term="2023" scheme="https://blog.caoyu.info/tags/2023/"/>
    
    <category term="Autumn" scheme="https://blog.caoyu.info/tags/Autumn/"/>
    
  </entry>
  
  <entry>
    <title>How to handle libc version not found in docker multi-stage build</title>
    <link href="https://blog.caoyu.info/libc-version-not-found.html"/>
    <id>https://blog.caoyu.info/libc-version-not-found.html</id>
    <published>2023-07-28T02:48:32.000Z</published>
    <updated>2023-07-28T06:06:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1>About debugging the issue &quot;glibc version not found&quot;</h1><h2 id="Pre">Pre</h2><p>Recently, I wanna build an image from the <code>previous Dockerfile</code> (Which absolutely works fine before).</p><p>However, it stuck in <code>libc version not found</code> when I ran it.</p><h2 id="Dockerfile">Dockerfile</h2><p>Here is my Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span> AS so</span><br><span class="line"><span class="comment"># build dynamic lib</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span> AS <span class="keyword">env</span></span><br><span class="line"><span class="comment"># install node packages</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> gcr.io/distroless/nodejs18-debian11</span><br><span class="line"><span class="comment"># running js app with golang dynamic lib</span></span><br></pre></td></tr></table></figure><h2 id="1st-issue">1st issue</h2><p>Upon running the image, it throws:</p><blockquote><p>/usr/lib/x86_64-linux-gnu/libstdc++.so.6: version GLIBCXX_3.4.29 not found(required by ffi-napi)</p></blockquote><p>I realized that maybe the problem is in the second <code>node:18</code> image, so I changed it to <code>node:16</code>, but the problem still exists; I tried <code>node:20</code><br>image again, still again.</p><p>After a lot of searching, I found that the <code>node:18</code> image was upgraded from the default system version <code>bullseye</code> to <code>bookworm</code>, so I tried to use<br>the <code>node:18-bullseye</code> image, and the problem was solved.</p><p>Then, I dived into the second issue. &gt;&lt;...</p><h2 id="2nd-issue">2nd issue</h2><p>After I fixed the 1st issue, it threw another error:</p><blockquote><p>/lib/x86_64-linux-gnu/libc.so.6: version GLIBC_2.32 not found(required by my golang dynamic lib)</p></blockquote><p>Due to the experience of the first issue, after confirming that the <code>golang</code> image has this version <code>golang:1.20-bullseye</code>, I immediately tried<br>the <code>golang:1.20-bullseye</code> image, but the problem was not solved as I expected. Sad.</p><p>After a long time of thinking, I suddenly realized that maybe the system version(Ubuntu 22) of my docker is too high?</p><p>I immediately tried to use my Ubuntu 18.04 system version to run, and the problem was solved! Wonderful!!!</p><p>BTW, Changing <code>golang:1.20</code> to <code>golang:1.20-bullseye</code> is <strong>necessary</strong>, if not, it still<br>throws <code>/lib/x86_64-linux-gnu/libc.so.6: version GLIBC_2.32 not found</code></p><h2 id="Fixed-Dockerfile">Fixed Dockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span>-bullseye AS so</span><br><span class="line"><span class="comment"># build dynamic lib</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-bullseye AS <span class="keyword">env</span></span><br><span class="line"><span class="comment"># install node packages</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> gcr.io/distroless/nodejs18-debian11</span><br><span class="line"><span class="comment"># running js app with golang dynamic lib</span></span><br></pre></td></tr></table></figure><h2 id="Conclusion">Conclusion</h2><ul><li>When using FROM in Dockerfile, not only need to specify the software version, but also need to specify the system version</li><li>The host system version of Docker is not easy to control, just don't be too high or too low</li></ul>]]></content>
    
    
    <summary type="html">use specific software version and specify system version</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="multi-stage" scheme="https://blog.caoyu.info/tags/multi-stage/"/>
    
    <category term="libc" scheme="https://blog.caoyu.info/tags/libc/"/>
    
    <category term="musl" scheme="https://blog.caoyu.info/tags/musl/"/>
    
    <category term="libstdc++" scheme="https://blog.caoyu.info/tags/libstdc/"/>
    
  </entry>
  
  <entry>
    <title>How to healthcheck distroless image</title>
    <link href="https://blog.caoyu.info/healthcheck-distroless-img.html"/>
    <id>https://blog.caoyu.info/healthcheck-distroless-img.html</id>
    <published>2023-07-28T02:44:11.000Z</published>
    <updated>2023-07-28T06:06:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1>How to healthcheck in distroless image</h1><h2 id="Dockerfile">Dockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### For HEALTHCHECK</span></span><br><span class="line"><span class="keyword">FROM</span> busybox AS wgeter</span><br><span class="line"></span><br><span class="line"><span class="comment"># wget grpc-health-probe</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget -O /tmp/hc https://github.com/grpc-ecosystem/grpc-health-probe/releases/download/v0.4.19/grpc_health_probe-linux-amd64 \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">chmod</span> +x /tmp/hc \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">mv</span> /tmp/hc /bin/hc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Deploy</span></span><br><span class="line"><span class="comment"># FROM gcr.io/distroless/static</span></span><br><span class="line"><span class="keyword">FROM</span> gcr.dockerproxy.com/distroless/static</span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy wget and health, one for http healthcheck, one for grpc healthcheck</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=wgeter /bin/wget /bin/wget</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=wgeter /bin/hc /bin/hc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=5s --<span class="built_in">timeout</span>=3s --start-period=5s --retries=3 CMD [<span class="string">&quot;hc&quot;</span>, <span class="string">&quot;-addr=localhost:9000&quot;</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">copy a wget or curl binary to distroless image to healthcheck</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="distroless" scheme="https://blog.caoyu.info/tags/distroless/"/>
    
    <category term="healthcheck" scheme="https://blog.caoyu.info/tags/healthcheck/"/>
    
    <category term="wget" scheme="https://blog.caoyu.info/tags/wget/"/>
    
    <category term="curl" scheme="https://blog.caoyu.info/tags/curl/"/>
    
  </entry>
  
</feed>

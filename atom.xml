<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>我还是个宝宝!</title>
  
  <subtitle>宝宝,就是我,耶~</subtitle>
  <link href="https://blog.caoyu.info/atom.xml" rel="self"/>
  
  <link href="https://blog.caoyu.info/"/>
  <updated>2023-07-28T02:48:32.000Z</updated>
  <id>https://blog.caoyu.info/</id>
  
  <author>
    <name>紫玄</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>How to Handle libc Version Not Found in Multi-Stage Build</title>
    <link href="https://blog.caoyu.info/libc-version-not-found.html"/>
    <id>https://blog.caoyu.info/libc-version-not-found.html</id>
    <published>2023-07-28T02:48:32.000Z</published>
    <updated>2023-07-28T02:48:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1>About debugging the issue &quot;glibc version not found&quot;</h1><h2 id="Pre">Pre</h2><p>Recently, I wanna build an image from the <code>previous Dockerfile</code> (Which absolutely works fine before).</p><p>However, it stuck in <code>libc version not found</code> when I ran it.</p><h2 id="Dockerfile">Dockerfile</h2><p>Here is my Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span> AS so</span><br><span class="line"><span class="comment"># build dynamic lib</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span> AS <span class="keyword">env</span></span><br><span class="line"><span class="comment"># install node packages</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> gcr.io/distroless/nodejs18-debian11</span><br><span class="line"><span class="comment"># running js app with golang dynamic lib</span></span><br></pre></td></tr></table></figure><h2 id="1st-issue">1st issue</h2><p>Upon running the image, it throws:</p><blockquote><p>/usr/lib/x86_64-linux-gnu/libstdc++.so.6: version GLIBCXX_3.4.29 not found(required by ffi-napi)</p></blockquote><p>I realized that maybe the problem is in the second <code>node:18</code> image, so I changed it to <code>node:16</code>, but the problem still exists; I tried <code>node:20</code> image again, still again.</p><p>After a lot of searching, I found that the <code>node:18</code> image was upgraded from the default system version <code>bullseye</code> to <code>bookworm</code>, so I tried to use the <code>node:18-bullseye</code> image, and the problem was solved.</p><p>Then, I dived into the second issue. &gt;&lt;...</p><h2 id="2nd-issue">2nd issue</h2><p>After I fixed the 1st issue, it threw another error:</p><blockquote><p>/lib/x86_64-linux-gnu/libc.so.6: version GLIBC_2.32 not found(required by my golang dynamic lib)</p></blockquote><p>Due to the experience of the first issue, after confirming that the <code>golang</code> image has this version <code>golang:1.20-bullseye</code>, I immediately tried the <code>golang:1.20-bullseye</code> image, but the problem was not solved as I expected. Sad.</p><p>After a long time of thinking, I suddenly realized that maybe the system version(Ubuntu 22) of my docker is too high?</p><p>I immediately tried to use my Ubuntu 18.04 system version to run, and the problem was solved! Wonderful!!!</p><p>BTW, Changing <code>golang:1.20</code> to <code>golang:1.20-bullseye</code> is <strong>necessary</strong>, if not, it still throws <code>/lib/x86_64-linux-gnu/libc.so.6: version GLIBC_2.32 not found</code></p><h2 id="Fixed-Dockerfile">Fixed Dockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span>-bullseye AS so</span><br><span class="line"><span class="comment"># build dynamic lib</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-bullseye AS <span class="keyword">env</span></span><br><span class="line"><span class="comment"># install node packages</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> gcr.io/distroless/nodejs18-debian11</span><br><span class="line"><span class="comment"># running js app with golang dynamic lib</span></span><br></pre></td></tr></table></figure><h2 id="Conclusion">Conclusion</h2><ul><li>When using FROM in Dockerfile, not only need to specify the software version, but also need to specify the system version</li><li>The host system version of Docker is not easy to control, just don't be too high or too low</li></ul>]]></content>
    
    
    <summary type="html">use specific software version and specify system version</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="multi-stage" scheme="https://blog.caoyu.info/tags/multi-stage/"/>
    
    <category term="libc" scheme="https://blog.caoyu.info/tags/libc/"/>
    
    <category term="musl" scheme="https://blog.caoyu.info/tags/musl/"/>
    
    <category term="libstdc++" scheme="https://blog.caoyu.info/tags/libstdc/"/>
    
  </entry>
  
  <entry>
    <title>How to HealthCheck Distroless Image</title>
    <link href="https://blog.caoyu.info/healthcheck-distroless-img.html"/>
    <id>https://blog.caoyu.info/healthcheck-distroless-img.html</id>
    <published>2023-07-28T02:44:11.000Z</published>
    <updated>2023-07-28T02:44:11.000Z</updated>
    
    <content type="html"><![CDATA[<h1>How to healthcheck in distroless image</h1><h2 id="Dockerfile">Dockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### For HEALTHCHECK</span></span><br><span class="line"><span class="keyword">FROM</span> busybox AS wgeter</span><br><span class="line"></span><br><span class="line"><span class="comment"># wget grpc-health-probe</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget -O /tmp/hc https://github.com/grpc-ecosystem/grpc-health-probe/releases/download/v0.4.19/grpc_health_probe-linux-amd64 \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">chmod</span> +x /tmp/hc \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">mv</span> /tmp/hc /bin/hc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Deploy</span></span><br><span class="line"><span class="comment"># FROM gcr.io/distroless/static</span></span><br><span class="line"><span class="keyword">FROM</span> gcr.dockerproxy.com/distroless/static</span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy wget and health, one for http healthcheck, one for grpc healthcheck</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=wgeter /bin/wget /bin/wget</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=wgeter /bin/hc /bin/hc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=5s --<span class="built_in">timeout</span>=3s --start-period=5s --retries=3 CMD [<span class="string">&quot;hc&quot;</span>, <span class="string">&quot;-addr=localhost:9000&quot;</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">copy a wget or curl binary to distroless image to healthcheck</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="distroless" scheme="https://blog.caoyu.info/tags/distroless/"/>
    
    <category term="healthcheck" scheme="https://blog.caoyu.info/tags/healthcheck/"/>
    
    <category term="wget" scheme="https://blog.caoyu.info/tags/wget/"/>
    
    <category term="curl" scheme="https://blog.caoyu.info/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>TODO on New OS</title>
    <link href="https://blog.caoyu.info/todo-new-os.html"/>
    <id>https://blog.caoyu.info/todo-new-os.html</id>
    <published>2023-07-28T02:40:11.000Z</published>
    <updated>2023-07-28T02:40:11.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Some Preparation for me on a New OS</h1><h2 id="General">General</h2><h3 id="pipx">pipx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipx install black commitizen flake8 hatch httpie pipenv poetry pre-commit</span><br></pre></td></tr></table></figure><h3 id="cargo">cargo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cargo install cargo-generate zoxide bat fd-find ripgrep</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> error, try to locked, e.g.</span></span><br><span class="line">cargo install --locked bat</span><br></pre></td></tr></table></figure><h2 id="Windows">Windows</h2><h3 id="scoop">scoop</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scoop install 7zip act aria2 btop cmake curl fzf gcc gradle gsudo make Meslo-NF Meslo-NF-Mono neovim scoop-search</span><br></pre></td></tr></table></figure><h3 id="winget">winget</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">winget install Git.Git</span><br><span class="line">winget install Fndroid.ClashForWindows</span><br><span class="line">winget install appmakes.Typora</span><br><span class="line">winget install OpenJS.NodeJS</span><br><span class="line">winget install GoLang.Go</span><br><span class="line">winget install NetEase.CloudMusic</span><br><span class="line">winget install JanDeDobbeleer.OhMyPosh</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">install some necessary tools for me on a new OS</summary>
    
    
    
    <category term="notes" scheme="https://blog.caoyu.info/categories/notes/"/>
    
    
    <category term="todo" scheme="https://blog.caoyu.info/tags/todo/"/>
    
    <category term="tools" scheme="https://blog.caoyu.info/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>Summer in 2023</title>
    <link href="https://blog.caoyu.info/2023-Summer.html"/>
    <id>https://blog.caoyu.info/2023-Summer.html</id>
    <published>2023-07-27T18:57:10.000Z</published>
    <updated>2023-07-27T18:57:10.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Welcome</h1><p>Welcome to the vibrant warmth of Summer in 2023.</p><p>Summer sun shines brightly, warming the earth.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;Welcome to the vibrant warmth of Summer in 2023.&lt;/p&gt;
&lt;p&gt;Summer sun shines brightly, warming the earth.&lt;/p&gt;
</summary>
      
    
    
    
    <category term="time" scheme="https://blog.caoyu.info/categories/time/"/>
    
    
    <category term="time" scheme="https://blog.caoyu.info/tags/time/"/>
    
    <category term="2023" scheme="https://blog.caoyu.info/tags/2023/"/>
    
    <category term="Summer" scheme="https://blog.caoyu.info/tags/Summer/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: SSP</title>
    <link href="https://blog.caoyu.info/quick-start-6-ldap-ssp.html"/>
    <id>https://blog.caoyu.info/quick-start-6-ldap-ssp.html</id>
    <published>2023-07-12T07:20:21.000Z</published>
    <updated>2023-07-12T07:20:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: SSP</h1><p>SSP(<code>Self-Service Password</code>), is a tool for ldap to change password.</p><h2 id="Prerequisite">Prerequisite</h2><blockquote><p><a href="https://blog.caoyu.info/quick-start-1-traefik.html">Traefik on HTTP</a></p><p>OR</p><p><a href="https://blog.caoyu.info/quick-start-1-1-traefik-ssl.html">Traefik on HTTPS</a></p><p>If HTTP, remove the <code>tls: &#123;&#125;</code> in dynamic configuration</p><p><a href="https://blog.caoyu.info/quick-start-2_1-bitnami-ldap.html">LDAP</a></p></blockquote><h2 id="Preparation">Preparation</h2><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">ssp:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">ltbproject/self-service-password</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">./ssp.conf.php:/var/www/conf/config.inc.local.php</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="configuration">configuration</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// general</span></span><br><span class="line"><span class="variable">$keyphrase</span> = <span class="string">&quot;mysecret&quot;</span>;</span><br><span class="line"><span class="comment">// $debug = true;</span></span><br><span class="line"><span class="comment">// $smarty_debug = true;</span></span><br><span class="line"><span class="variable">$login_forbidden_chars</span> = <span class="string">&quot;*()&amp;|&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ldap connection</span></span><br><span class="line"><span class="comment">// ldap-srv is your ldap service name in docker compose file</span></span><br><span class="line"><span class="variable">$ldap_url</span> = <span class="string">&quot;ldap://ldap-srv:1389&quot;</span>;</span><br><span class="line"><span class="variable">$ldap_binddn</span> = <span class="string">&quot;cn=admin,dc=chaos,dc=io&quot;</span>;</span><br><span class="line"><span class="variable">$ldap_bindpw</span> = <span class="string">&quot;secret&quot;</span>;</span><br><span class="line"><span class="variable">$who_change_password</span> = <span class="string">&quot;manager&quot;</span>;</span><br><span class="line"><span class="variable">$ldap_base</span> = <span class="string">&quot;ou=users,dc=chaos,dc=io&quot;</span>;</span><br><span class="line"><span class="variable">$ldap_filter</span> = <span class="string">&quot;(&amp;(objectClass=person)(uid=&#123;login&#125;))&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// password policy</span></span><br><span class="line"><span class="variable">$hash</span> = <span class="string">&quot;auto&quot;</span>;</span><br><span class="line"><span class="variable">$pwd_min_length</span> = <span class="number">12</span>;</span><br><span class="line"><span class="variable">$pwd_max_length</span> = <span class="number">30</span>;</span><br><span class="line"><span class="variable">$pwd_min_lower</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$pwd_min_upper</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$pwd_min_digit</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$pwd_min_special</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$pwd_special_chars</span> = <span class="string">&quot;^a-zA-Z0-9&quot;</span>; <span class="comment">// This means special characters are all characters except alphabetical letters and digits.</span></span><br><span class="line"><span class="variable">$pwd_no_special_at_ends</span> = <span class="literal">true</span>; <span class="comment">// Special characters are not allowed at the beginning or at the end of the password.</span></span><br><span class="line"><span class="variable">$pwd_show_policy</span> = <span class="string">&quot;always&quot;</span>; <span class="comment">// never, onerror, always</span></span><br><span class="line"><span class="variable">$pwd_show_policy_pos</span> = <span class="string">&quot;above&quot;</span>; <span class="comment">// above, below</span></span><br><span class="line"><span class="variable">$show_extended_error</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reset by mail tokens</span></span><br><span class="line"><span class="variable">$use_tokens</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$mail_address_use_ldap</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ssp-yml-in-dir-dynamic-conf">ssp.yml in dir dynamic-conf</h3><blockquote><p>You should touch <code>ssp.yml</code> in traefik dir <strong>dynamic-conf</strong>.</p><p>Much more information, please reference the <a href="#Prerequisite">Prerequisite</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">ssp:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">&quot;Host(`ssp.x.internal`)&quot;</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">&quot;ssp&quot;</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">services:</span></span><br><span class="line">        <span class="attr">ssp:</span></span><br><span class="line">            <span class="attr">loadBalancer:</span></span><br><span class="line">                <span class="attr">servers:</span></span><br><span class="line">                    <span class="bullet">-</span>   <span class="attr">url:</span> <span class="string">&quot;http://ssp&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-domain-parse">Config domain parse</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 ssp.x.internal\n&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p ssp up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p ssp up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://ssp.x.internal">https://ssp.x.internal</a></p><h2 id="FYI">FYI</h2><p><a href="https://github.com/ltb-project/self-service-password">https://github.com/ltb-project/self-service-password</a></p><p><a href="https://self-service-password.readthedocs.io/">https://self-service-password.readthedocs.io/</a></p>]]></content>
    
    
    <summary type="html">how to configure ssp for ldap based on traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="ssp" scheme="https://blog.caoyu.info/tags/ssp/"/>
    
    <category term="password" scheme="https://blog.caoyu.info/tags/password/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: Traefik with HTTP/3</title>
    <link href="https://blog.caoyu.info/quick-start-1_2-traefik-http3.html"/>
    <id>https://blog.caoyu.info/quick-start-1_2-traefik-http3.html</id>
    <published>2023-04-16T04:18:36.000Z</published>
    <updated>2023-04-16T04:22:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: Traefik with HTTP/3</h1><h2 id="Preparation">Preparation</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create <span class="built_in">dirs</span> and empty files</span></span><br><span class="line">mkdir -p traefik/dynamic-conf traefik/certs &amp;&amp; cd traefik &amp;&amp; touch compose.yml traefik.yml dynamic-conf/self.yml</span><br></pre></td></tr></table></figure><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">traefik:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">traefik:2.10</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;443:443/tcp&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;443:443/udp&quot;</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="comment"># /traefik.yml and /etc/traefik/traefik.yml are both available.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./traefik.yml:/etc/traefik/traefik.yml&quot;</span></span><br><span class="line">            <span class="comment"># dynamic-conf dir is self-defined</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./dynamic-conf:/etc/traefik/dynamic-conf&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./certs:/certs&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">traefik-net</span></span><br><span class="line">        <span class="attr">ipam:</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="bullet">-</span>   <span class="attr">subnet:</span> <span class="number">172.16</span><span class="number">.238</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="traefik-yml">traefik.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Static Configuration</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">INFO</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">    <span class="attr">dashboard:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">experimental:</span></span><br><span class="line">    <span class="attr">http3:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">entryPoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">        <span class="attr">address:</span> <span class="string">:80</span></span><br><span class="line">        <span class="attr">http:</span></span><br><span class="line">            <span class="attr">redirections:</span></span><br><span class="line">                <span class="attr">entryPoint:</span></span><br><span class="line">                    <span class="attr">to:</span> <span class="string">websecure</span></span><br><span class="line">                    <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">                    <span class="attr">permanent:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">websecure:</span></span><br><span class="line">        <span class="attr">address:</span> <span class="string">:443</span></span><br><span class="line">        <span class="attr">http3:</span> &#123; &#125;</span><br><span class="line"><span class="attr">providers:</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">directory:</span> <span class="string">/etc/traefik/dynamic-conf</span></span><br><span class="line">        <span class="attr">watch:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="self-yml-in-dir-dynamic-conf">self.yml in dir dynamic-conf</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Dynamic Configuration</span></span><br><span class="line"><span class="attr">tls:</span></span><br><span class="line">    <span class="attr">certificates:</span></span><br><span class="line">        <span class="bullet">-</span>   <span class="attr">certFile:</span> <span class="string">/certs/cert.pem</span></span><br><span class="line">            <span class="attr">keyFile:</span> <span class="string">/certs/key.pem</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">dashboard:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">Host(`traefik.x.internal`)</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">api@internal</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-DNS-domain-parse">Config DNS domain parse</h2><p>If you have DNS server, please reference the DNS server guide to config it</p><p>If not and using the unix-like system, edit the <code>/etc/hosts</code></p><p>if using windows, edit the <code>C:\Windows\System32\drivers\etc\hosts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 traefik.x.internal</span><br></pre></td></tr></table></figure><h2 id="Generate-Self-Signed-Certificates">Generate Self-Signed Certificates</h2><h3 id="Option-1-Using-mkcert">Option-1: Using mkcert</h3><p><code>mkcert</code> installation is here: <a href="https://github.com/FiloSottile/mkcert">https://github.com/FiloSottile/mkcert</a></p><p><code>mkcert</code> can solve the problem of browser distrust<br>If you want to solve this problem, then <code>mkcert</code> is the best choice.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">directly gen certs at the current <span class="built_in">dir</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mkcert example.com <span class="string">&quot;*.example.com&quot;</span> example.test localhost 127.0.0.1 ::1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">specify the cert output <span class="built_in">dir</span></span></span><br><span class="line">mkcert -key-file certs/key.pem -cert-file certs/cert.pem x.internal &quot;*.x.internal&quot;</span><br><span class="line">mkcert -install</span><br></pre></td></tr></table></figure><h3 id="Option-2-Using-openssl">Option-2: Using openssl</h3><ul><li><strong>option-a</strong>: configure with command line</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -nodes -newkey rsa:4096 -days 365 \</span><br><span class="line">    -subj &quot;/C=CN/ST=SH/L=Shanghai/CN=*.x.internal&quot; \</span><br><span class="line">    -keyout certs/key.pem \</span><br><span class="line">    -out certs/cert.pem</span><br></pre></td></tr></table></figure><ul><li><strong>option-b</strong>: configure with a <code>ssl.cnf</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">When using -x509, default_days <span class="keyword">in</span> config will be ignored, it is a bug</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">using -days to workaround</span></span><br><span class="line">openssl req -x509 -new -nodes -days 365 \</span><br><span class="line">    -config ssl.cnf \</span><br><span class="line">    -keyout certs/key.pem \</span><br><span class="line">    -out certs/cert.pem</span><br></pre></td></tr></table></figure><p><code>ssl.cnf</code> like as follows:</p><p>Tips: <code>DNS.1</code>, <code>DNS.2</code>, <code>IP.7</code>, <code>DNS.11</code>, the numbers are only required to be unique, and can also be unordered.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[ req ]</span><br><span class="line">default_bits       = 4096</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">x509_extensions    = v3_req</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line">C  = CN</span><br><span class="line">ST = SH</span><br><span class="line">L  = Shanghai</span><br><span class="line">O  = Individual</span><br><span class="line">OU = MyStudio</span><br><span class="line">CN = x.internal</span><br><span class="line"></span><br><span class="line">[ v3_req ]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[alt_names]</span><br><span class="line">DNS.1  = x.internal</span><br><span class="line">DNS.2  = *.x.internal</span><br><span class="line">IP.7   = 127.0.0.1</span><br><span class="line">DNS.11 = localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p traefik up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p traefik up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://traefik.x.internal">https://traefik.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to enable http3 for traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="https" scheme="https://blog.caoyu.info/tags/https/"/>
    
    <category term="ssl" scheme="https://blog.caoyu.info/tags/ssl/"/>
    
    <category term="openssl" scheme="https://blog.caoyu.info/tags/openssl/"/>
    
    <category term="certificates" scheme="https://blog.caoyu.info/tags/certificates/"/>
    
    <category term="http3" scheme="https://blog.caoyu.info/tags/http3/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: LDAP by Bitnami</title>
    <link href="https://blog.caoyu.info/quick-start-2_1-bitnami-ldap.html"/>
    <id>https://blog.caoyu.info/quick-start-2_1-bitnami-ldap.html</id>
    <published>2023-04-15T15:16:36.000Z</published>
    <updated>2023-04-16T04:24:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: LDAP by Bitnami</h1><h2 id="Prerequisite">Prerequisite</h2><blockquote><p><a href="https://blog.caoyu.info/quick-start-1-traefik.html">Traefik on HTTP</a></p><p>OR</p><p><a href="https://blog.caoyu.info/quick-start-1-1-traefik-ssl.html">Traefik on HTTPS</a></p><p>If HTTP, remove the <code>tls: &#123;&#125;</code> in dynamic configuration</p></blockquote><h2 id="Preparation">Preparation</h2><h3 id="compose-yml">compose.yml</h3><blockquote><p>For much more information, please reference <a href="https://hub.docker.com/r/bitnami/openldap/">here</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">bitnami-ldap:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">bitnami/openldap</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_ADMIN_USERNAME=admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_ADMIN_PASSWORD=secret</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_ROOT=dc=chaos,dc=io</span></span><br><span class="line">            <span class="comment"># for using phpldapadmin, config 389 and 636</span></span><br><span class="line">            <span class="comment"># if not, remove the following two environments</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_PORT_NUMBER=389</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_LDAPS_PORT_NUMBER=636</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">openldap:/bitnami/openldap</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">bitnami-ldapadmin:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">osixia/phpldapadmin</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PHPLDAPADMIN_LDAP_HOSTS=bitnami-ldap</span></span><br><span class="line">            <span class="comment"># if configure https by traefik, you need to configure the following two lines</span></span><br><span class="line">            <span class="comment"># if not, remove them</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">VIRTUAL_HOST=bitnami-ldap.x.internal</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PHPLDAPADMIN_HTTPS=false</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">openldap:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ldap-yml-in-dir-dynamic-conf">ldap.yml in dir dynamic-conf</h3><blockquote><p>You should touch <code>ldap.yml</code> in traefik dir <strong>dynamic-conf</strong>.</p><p>For much more information, please reference the <a href="#Prerequisite">Prerequisite</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">bitnami-ldap:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">&quot;Host(`bitnami-ldap.x.internal`)&quot;</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">&quot;bitnami-ldap&quot;</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">services:</span></span><br><span class="line">        <span class="attr">bitnami-ldap:</span></span><br><span class="line">            <span class="attr">loadBalancer:</span></span><br><span class="line">                <span class="attr">servers:</span></span><br><span class="line">                    <span class="bullet">-</span>   <span class="attr">url:</span> <span class="string">&quot;http://bitnami-ldapadmin&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-domain-parse">Config domain parse</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 bitnami-ldap.x.internal\n&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p bitnami-ldap up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p bitnami-ldap up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://bitnami-ldap.x.internal">https://bitnami-ldap.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to configure bitnami openldap based on traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="ldap" scheme="https://blog.caoyu.info/tags/ldap/"/>
    
    <category term="login" scheme="https://blog.caoyu.info/tags/login/"/>
    
    <category term="user" scheme="https://blog.caoyu.info/tags/user/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: Gerrit</title>
    <link href="https://blog.caoyu.info/quick-start-5-gerrit.html"/>
    <id>https://blog.caoyu.info/quick-start-5-gerrit.html</id>
    <published>2023-04-15T14:03:21.000Z</published>
    <updated>2023-04-15T14:03:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: Gerrit</h1><h2 id="Prerequisite">Prerequisite</h2><blockquote><p><a href="https://blog.caoyu.info/quick-start-1-traefik.html">Traefik on HTTP</a></p><p>OR</p><p><a href="https://blog.caoyu.info/quick-start-1-1-traefik-ssl.html">Traefik on HTTPS</a></p><p>If HTTP, remove the <code>tls: &#123;&#125;</code> in dynamic configuration</p><p><a href="https://blog.caoyu.info/quick-start-2-ldap.html">LDAP by Traefik</a></p></blockquote><h2 id="Preparation">Preparation</h2><h3 id="create-some-dirs-and-files">create some dirs and files</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo install -d /opt/gerrit; cd /opt/gerrit; sudo install -d etc git db index cache plugins</span><br></pre></td></tr></table></figure><h4 id="vim-opt-gerrit-etc-gerrit-config">vim /opt/gerrit/etc/gerrit.config</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[gerrit]</span></span><br><span class="line"><span class="attr">basePath</span> = git</span><br><span class="line"></span><br><span class="line"><span class="section">[index]</span></span><br><span class="line"><span class="attr">type</span> = LUCENE</span><br><span class="line"></span><br><span class="line"><span class="section">[auth]</span></span><br><span class="line"><span class="attr">type</span> = ldap</span><br><span class="line"></span><br><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">listenAddress</span> = *:<span class="number">29418</span></span><br><span class="line"></span><br><span class="line"><span class="section">[httpd]</span></span><br><span class="line"><span class="attr">listenUrl</span> = http://*:<span class="number">8080</span>/</span><br><span class="line"></span><br><span class="line"><span class="section">[cache]</span></span><br><span class="line"><span class="attr">directory</span> = cache</span><br><span class="line"></span><br><span class="line"><span class="section">[container]</span></span><br><span class="line"><span class="attr">user</span> = root</span><br><span class="line"></span><br><span class="line"><span class="section">[download]</span></span><br><span class="line"><span class="attr">schema</span> = http</span><br><span class="line"><span class="attr">schema</span> = ssh</span><br><span class="line"></span><br><span class="line"><span class="section">[plugins]</span></span><br><span class="line"><span class="comment"># for plugin-manager plugin</span></span><br><span class="line"><span class="attr">allowRemoteAdmin</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ldap]</span></span><br><span class="line"><span class="comment"># the second ldap is docker compose service name</span></span><br><span class="line"><span class="attr">server</span> = ldap://ldap</span><br><span class="line"><span class="comment"># dc=chaos,dc=io is from ldap service environment: LDAP_DOMAIN=chaos.io</span></span><br><span class="line"><span class="attr">username</span> = cn=admin,dc=chaos,dc=io</span><br><span class="line"><span class="attr">accountBase</span> = dc=chaos,dc=io</span><br><span class="line"><span class="attr">accountPattern</span> = (&amp;(objectClass=person)(uid=<span class="variable">$&#123;username&#125;</span>))</span><br><span class="line"><span class="attr">accountFullName</span> = displayName</span><br><span class="line"><span class="attr">accountEmailAddress</span> = mail</span><br><span class="line"></span><br><span class="line"><span class="section">[receive]</span></span><br><span class="line"><span class="attr">enableSignedPush</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[user]</span></span><br><span class="line"><span class="attr">name</span> = Gerrit Code Review</span><br><span class="line"><span class="attr">email</span> = webhook@example.com</span><br><span class="line"><span class="attr">anonymousCoward</span> = Gerrit Code Review</span><br><span class="line"></span><br><span class="line"><span class="section">[sendemail]</span></span><br><span class="line"><span class="attr">smtpServer</span> = smtp.exmail.qq.com</span><br><span class="line"><span class="attr">smtpServerPort</span> = <span class="number">465</span></span><br><span class="line"><span class="attr">smtpEncryption</span> = SSL</span><br><span class="line"><span class="attr">sslVerify</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">smtpUser</span> = webhook@example.com</span><br><span class="line"><span class="attr">smtpPass</span> = YOUR_PASSWORD</span><br><span class="line"><span class="attr">from</span> = <span class="variable">$&#123;user&#125;</span> (Code Review) &lt;webhook@example.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="section">[commentlink &quot;changeid&quot;]</span></span><br><span class="line"><span class="attr">match</span> = (I[<span class="number">0</span>-<span class="number">9</span>a-f]&#123;<span class="number">8</span>,<span class="number">40</span>&#125;)</span><br><span class="line"><span class="attr">link</span> = <span class="string">&quot;#/q/$1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[commentlink &quot;gitee&quot;]</span></span><br><span class="line"><span class="attr">match</span> = <span class="string">&quot;gitee: #(.&#123;6&#125;)&quot;</span></span><br><span class="line"><span class="attr">link</span> = https://e.gitee.com/example_user/dashboard?issue=<span class="variable">$1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="vim-opt-gerrit-etc-secure-config">vim /opt/gerrit/etc/secure.config</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[ldap]</span></span><br><span class="line"><span class="comment"># this value is from ldap service environment: LDAP_ADMIN_PASSWORD=secret</span></span><br><span class="line"><span class="attr">password</span> = secret</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">gerrit:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">gerritcodereview/gerrit</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;29418:29418&quot;</span></span><br><span class="line">        <span class="attr">expose:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/gerrit/etc:/var/gerrit/etc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/gerrit/git:/var/gerrit/git</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/gerrit/db:/var/gerrit/db</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/gerrit/index:/var/gerrit/index</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/gerrit/cache:/var/gerrit/cache</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/opt/gerrit/plugins:/var/gerrit/plugins</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">CANONICAL_WEB_URL=http://gerrit.x.internal</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">HTTPD_LISTEN_URL=proxy-http://*:8080</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">init</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="gerrit-yml-in-dir-dynamic-conf">gerrit.yml in dir dynamic-conf</h3><blockquote><p>You should touch <code>gerrit.yml</code> in traefik dir <strong>dynamic-conf</strong>.</p><p>For much more information, please reference the <a href="#Prerequisite">Prerequisite</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">gerrit:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">&quot;Host(`gerrit.x.internal`)&quot;</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">&quot;gerrit&quot;</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">services:</span></span><br><span class="line">        <span class="attr">gerrit:</span></span><br><span class="line">            <span class="attr">loadBalancer:</span></span><br><span class="line">                <span class="attr">servers:</span></span><br><span class="line">                    <span class="bullet">-</span>   <span class="attr">url:</span> <span class="string">&quot;http://gerrit:8080&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-domain-parse">Config domain parse</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 gerrit.x.internal\n&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><h3 id="STEP-1-Run-Gerrit-docker-init-setup-from-docker">STEP-1: Run Gerrit docker init setup from docker</h3><p><strong>Uncomment</strong> the <code>command: init</code> option in <code>compose.yml</code> and run Gerrit with docker-compose in foreground.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up gerrit</span><br></pre></td></tr></table></figure><p>Wait until you see in the output the message <code>Initialized /var/gerrit</code> and then the container will exit.</p><h3 id="STEP-2-Start-Gerrit-in-daemon-mode">STEP-2: Start Gerrit in daemon mode</h3><p><strong>Comment out</strong> the <code>command: init</code> option in docker-compose.yaml and start all the docker-compose nodes:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>Access: <a href="https://gerrit.x.internal">https://gerrit.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to configure gerrit with https based on traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="gerrit" scheme="https://blog.caoyu.info/tags/gerrit/"/>
    
    <category term="review" scheme="https://blog.caoyu.info/tags/review/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: SonarQube</title>
    <link href="https://blog.caoyu.info/quick-start-4-sonar.html"/>
    <id>https://blog.caoyu.info/quick-start-4-sonar.html</id>
    <published>2023-04-14T06:18:21.000Z</published>
    <updated>2023-04-16T04:23:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: Sonar</h1><h2 id="Prerequisite">Prerequisite</h2><blockquote><p><a href="https://blog.caoyu.info/quick-start-1-traefik.html">Traefik on HTTP</a></p><p>OR</p><p><a href="https://blog.caoyu.info/quick-start-1-1-traefik-ssl.html">Traefik on HTTPS</a></p><p>If HTTP, remove the <code>tls: &#123;&#125;</code> in dynamic configuration</p></blockquote><h2 id="Preparation">Preparation</h2><h3 id="configure-your-host-sysctl-firstly-etc-sysctl-conf">configure your host sysctl firstly: /etc/sysctl.conf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">append the following two line key-values to /etc/sysctl.conf</span></span><br><span class="line">vm.max_map_count = 524288</span><br><span class="line">fs.file-max = 131072</span><br></pre></td></tr></table></figure><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">sonarqube:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">sonarqube:community</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">sonarqube</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">sonarqube</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">SONAR_JDBC_URL:</span> <span class="string">jdbc:postgresql://db:5432/sonar</span></span><br><span class="line">            <span class="attr">SONAR_JDBC_USERNAME:</span> <span class="string">sonar</span></span><br><span class="line">            <span class="attr">SONAR_JDBC_PASSWORD:</span> <span class="string">sonar</span></span><br><span class="line">            <span class="comment"># configure ldap server, if no need, remove it</span></span><br><span class="line">            <span class="comment"># HERE LDAP server from the gerrit compose</span></span><br><span class="line">            <span class="attr">SONAR_SECURITY_REALM:</span> <span class="string">LDAP</span></span><br><span class="line">            <span class="attr">LDAP_URL:</span> <span class="string">ldap://ldap</span></span><br><span class="line">            <span class="attr">LDAP_BINDDN:</span> <span class="string">cn=admin,dc=chaos,dc=io</span></span><br><span class="line">            <span class="attr">LDAP_BINDPASSWORD:</span> <span class="string">secret</span></span><br><span class="line">            <span class="attr">LDAP_USER_BASEDN:</span> <span class="string">dc=chaos,dc=io</span></span><br><span class="line">            <span class="attr">LDAP_USER_REQUEST:</span> <span class="string">(&amp;(objectClass=person)(uid=&#123;login&#125;))</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">sonarqube_data:/opt/sonarqube/data</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">sonarqube_extensions:/opt/sonarqube/extensions</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">sonarqube_logs:/opt/sonarqube/logs</span></span><br><span class="line">        <span class="attr">ulimits:</span></span><br><span class="line">            <span class="attr">nofile:</span></span><br><span class="line">                <span class="attr">soft:</span> <span class="number">131072</span></span><br><span class="line">                <span class="attr">hard:</span> <span class="number">131072</span></span><br><span class="line">            <span class="attr">nproc:</span></span><br><span class="line">                <span class="attr">soft:</span> <span class="number">8192</span></span><br><span class="line">                <span class="attr">hard:</span> <span class="number">8192</span></span><br><span class="line">        <span class="attr">expose:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">9000</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line">    <span class="attr">db:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">postgres:14</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">postgresql</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">postgresql</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="attr">POSTGRES_USER:</span> <span class="string">sonar</span></span><br><span class="line">            <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">sonar</span></span><br><span class="line">            <span class="attr">POSTGRES_DB:</span> <span class="string">sonar</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">postgresql:/var/lib/postgresql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">postgresql_data:/var/lib/postgresql/data</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">sonarqube_data:</span></span><br><span class="line">    <span class="attr">sonarqube_extensions:</span></span><br><span class="line">    <span class="attr">sonarqube_logs:</span></span><br><span class="line">    <span class="attr">postgresql:</span></span><br><span class="line">    <span class="attr">postgresql_data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="sonar-yml-in-dir-dynamic-conf">sonar.yml in dir dynamic-conf</h3><blockquote><p>You should touch <code>sonar.yml</code> in traefik dir <strong>dynamic-conf</strong>.</p><p>For much more information, please reference the <a href="#Prerequisite">Prerequisite</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">sonarqube:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">&quot;Host(`sonar.x.internal`)&quot;</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">&quot;sonarqube&quot;</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">services:</span></span><br><span class="line">        <span class="attr">sonarqube:</span></span><br><span class="line">            <span class="attr">loadBalancer:</span></span><br><span class="line">                <span class="attr">servers:</span></span><br><span class="line">                    <span class="bullet">-</span>   <span class="attr">url:</span> <span class="string">&quot;http://sonarqube:9000&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-domain-parse">Config domain parse</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 sonar.x.internal\n&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p sonar up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p sonar up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://sonar.x.internal">https://sonar.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to configure sonarqube with https based on traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="sonarqube" scheme="https://blog.caoyu.info/tags/sonarqube/"/>
    
    <category term="sonar" scheme="https://blog.caoyu.info/tags/sonar/"/>
    
    <category term="security" scheme="https://blog.caoyu.info/tags/security/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: Jenkins</title>
    <link href="https://blog.caoyu.info/quick-start-3-jenkins.html"/>
    <id>https://blog.caoyu.info/quick-start-3-jenkins.html</id>
    <published>2023-04-14T06:14:21.000Z</published>
    <updated>2023-04-16T04:24:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: Jenkins</h1><h2 id="Prerequisite">Prerequisite</h2><blockquote><p><a href="https://blog.caoyu.info/quick-start-1-traefik.html">Traefik on HTTP</a></p><p>OR</p><p><a href="https://blog.caoyu.info/quick-start-1-1-traefik-ssl.html">Traefik on HTTPS</a></p><p>If HTTP, remove the <code>tls: &#123;&#125;</code> in dynamic configuration</p></blockquote><h2 id="Preparation">Preparation</h2><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">jenkins:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">jenkins/jenkins</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">jenkins</span></span><br><span class="line">        <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">expose:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">8080</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">50000</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">extra_hosts:</span></span><br><span class="line">            <span class="comment"># config for gerrit, sonar, ldap. if no, remove them</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">gerrit.x.internal:192.168.91.103</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">sonar.x.internal:192.168.91.103</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ldap.x.internal:192.168.91.103</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">jenkins_home:/var/jenkins_home</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">jenkins_home:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="jenkins-yml-in-dir-dynamic-conf">jenkins.yml in dir dynamic-conf</h3><blockquote><p>You should touch <code>jenkins.yml</code> in traefik dir <strong>dynamic-conf</strong>.</p><p>For much more information, please reference the <a href="#Prerequisite">Prerequisite</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">jenkins:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">&quot;Host(`jenkins.x.internal`)&quot;</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">&quot;jenkins&quot;</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">services:</span></span><br><span class="line">        <span class="attr">jenkins:</span></span><br><span class="line">            <span class="attr">loadBalancer:</span></span><br><span class="line">                <span class="attr">servers:</span></span><br><span class="line">                    <span class="bullet">-</span>   <span class="attr">url:</span> <span class="string">&quot;http://jenkins:8080&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-domain-parse">Config domain parse</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 jenkins.x.internal\n&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p jenkins up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p jenkins up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://jenkins.x.internal">https://jenkins.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to configure jenkins with https based on traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="jenkins" scheme="https://blog.caoyu.info/tags/jenkins/"/>
    
    <category term="ci" scheme="https://blog.caoyu.info/tags/ci/"/>
    
    <category term="cd" scheme="https://blog.caoyu.info/tags/cd/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: LDAP</title>
    <link href="https://blog.caoyu.info/quick-start-2-ldap.html"/>
    <id>https://blog.caoyu.info/quick-start-2-ldap.html</id>
    <published>2023-04-13T15:45:36.000Z</published>
    <updated>2023-04-16T04:20:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: LDAP</h1><p>If you want to use <code>bitnamic/openldap</code>,<br>please follow this <a href="https://blog.caoyu.info/quick-start-2_1-bitnami-ldap.html">Quick Start: LDAP by Bitnami</a>.</p><h2 id="Prerequisite">Prerequisite</h2><blockquote><p><a href="https://blog.caoyu.info/quick-start-1-traefik.html">Traefik on HTTP</a></p><p>OR</p><p><a href="https://blog.caoyu.info/quick-start-1-1-traefik-ssl.html">Traefik on HTTPS</a></p><p>If HTTP, remove the <code>tls: &#123;&#125;</code> in dynamic configuration</p></blockquote><h2 id="Preparation">Preparation</h2><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">ldap:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">osixia/openldap</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_ORGANISATION=Chaos</span> <span class="string">Inc.</span></span><br><span class="line">            <span class="comment"># if LDAP_DOMAIN=chaos.io, the login DN will be &quot;cn=admin,dc=chaos,dc=io&quot;</span></span><br><span class="line">            <span class="comment"># LDAP_DOMAIN default value is &quot;example.org&quot;</span></span><br><span class="line">            <span class="comment"># so default login DN is &quot;cn=admin,dc=example,dc=org&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_DOMAIN=chaos.io</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">LDAP_ADMIN_PASSWORD=secret</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ldap:/var/lib/ldap</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">slapd:/etc/ldap/slapd.d</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">ldapadmin:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">osixia/phpldapadmin</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PHPLDAPADMIN_LDAP_HOSTS=ldap</span></span><br><span class="line">            <span class="comment"># if configure https by traefik, you need to configure the following two lines</span></span><br><span class="line">            <span class="comment"># if not, remove them</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">VIRTUAL_HOST=ldap.x.internal</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PHPLDAPADMIN_HTTPS=false</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">ldap:</span></span><br><span class="line">    <span class="attr">slapd:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ldap-yml-in-dir-dynamic-conf">ldap.yml in dir dynamic-conf</h3><blockquote><p>You should touch <code>ldap.yml</code> in traefik dir <strong>dynamic-conf</strong>.</p><p>For much more information, please reference the <a href="#Prerequisite">Prerequisite</a>.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">ldap:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">&quot;Host(`ldap.x.internal`)&quot;</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">&quot;ldap&quot;</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">services:</span></span><br><span class="line">        <span class="attr">ldap:</span></span><br><span class="line">            <span class="attr">loadBalancer:</span></span><br><span class="line">                <span class="attr">servers:</span></span><br><span class="line">                    <span class="bullet">-</span>   <span class="attr">url:</span> <span class="string">&quot;http://ldapadmin&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-domain-parse">Config domain parse</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 ldap.x.internal\n&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p ldap up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p ldap up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://ldap.x.internal">https://ldap.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to configure ldap based on traefik</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="ldap" scheme="https://blog.caoyu.info/tags/ldap/"/>
    
    <category term="login" scheme="https://blog.caoyu.info/tags/login/"/>
    
    <category term="user" scheme="https://blog.caoyu.info/tags/user/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: Traefik with HTTPS</title>
    <link href="https://blog.caoyu.info/quick-start-1_1-traefik-ssl.html"/>
    <id>https://blog.caoyu.info/quick-start-1_1-traefik-ssl.html</id>
    <published>2023-04-13T09:28:36.000Z</published>
    <updated>2023-04-14T06:14:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: Traefik with SSL</h1><h2 id="Preparation">Preparation</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create <span class="built_in">dirs</span> and empty files</span></span><br><span class="line">mkdir -p traefik/dynamic-conf traefik/certs &amp;&amp; cd traefik &amp;&amp; touch compose.yml traefik.yml dynamic-conf/self.yml</span><br></pre></td></tr></table></figure><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">traefik:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">traefik:3.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="comment"># /traefik.yml and /etc/traefik/traefik.yml are both available.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./traefik.yml:/etc/traefik/traefik.yml&quot;</span></span><br><span class="line">            <span class="comment"># dynamic-conf dir is self-defined</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./dynamic-conf:/etc/traefik/dynamic-conf&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./certs:/certs&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">traefik-net</span></span><br><span class="line">        <span class="attr">ipam:</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="bullet">-</span>   <span class="attr">subnet:</span> <span class="number">172.16</span><span class="number">.238</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="traefik-yml">traefik.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Static Configuration</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">INFO</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">    <span class="attr">dashboard:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">entryPoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">        <span class="attr">address:</span> <span class="string">:80</span></span><br><span class="line">        <span class="attr">http:</span></span><br><span class="line">            <span class="attr">redirections:</span></span><br><span class="line">                <span class="attr">entryPoint:</span></span><br><span class="line">                    <span class="attr">to:</span> <span class="string">websecure</span></span><br><span class="line">                    <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">                    <span class="attr">permanent:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">websecure:</span></span><br><span class="line">        <span class="attr">address:</span> <span class="string">:443</span></span><br><span class="line"><span class="attr">providers:</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">directory:</span> <span class="string">/etc/traefik/dynamic-conf</span></span><br><span class="line">        <span class="attr">watch:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="self-yml-in-dir-dynamic-conf">self.yml in dir dynamic-conf</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Dynamic Configuration</span></span><br><span class="line"><span class="attr">tls:</span></span><br><span class="line">    <span class="attr">certificates:</span></span><br><span class="line">        <span class="bullet">-</span>   <span class="attr">certFile:</span> <span class="string">/certs/cert.pem</span></span><br><span class="line">            <span class="attr">keyFile:</span> <span class="string">/certs/key.pem</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">dashboard:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">Host(`traefik.x.internal`)</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">api@internal</span></span><br><span class="line">            <span class="attr">tls:</span> &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-DNS-domain-parse">Config DNS domain parse</h2><p>If you have DNS server, please reference the DNS server guide to config it</p><p>If not and using unix-like system, edit the <code>/etc/hosts</code></p><p>if using windows, edit the <code>C:\Windows\System32\drivers\etc\hosts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 traefik.x.internal</span><br></pre></td></tr></table></figure><h2 id="Generate-Self-Signed-Certificates">Generate Self-Signed Certificates</h2><h3 id="Option-1-Using-mkcert">Option-1: Using mkcert</h3><p><code>mkcert</code> installation is here: <a href="https://github.com/FiloSottile/mkcert">https://github.com/FiloSottile/mkcert</a></p><p><code>mkcert</code> can solve the problem of browser distrust<br>If you want to solve this problem, then <code>mkcert</code> is the best choice.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">directly gen certs at the current <span class="built_in">dir</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mkcert example.com <span class="string">&quot;*.example.com&quot;</span> example.test localhost 127.0.0.1 ::1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">specify the cert output <span class="built_in">dir</span></span></span><br><span class="line">mkcert -key-file certs/key.pem -cert-file certs/cert.pem x.internal &quot;*.x.internal&quot;</span><br><span class="line">mkcert -install</span><br></pre></td></tr></table></figure><h3 id="Option-2-Using-openssl">Option-2: Using openssl</h3><ul><li><strong>option-a</strong>: configure with command line</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -nodes -newkey rsa:4096 -days 365 \</span><br><span class="line">    -subj &quot;/C=CN/ST=SH/L=Shanghai/CN=*.x.internal&quot; \</span><br><span class="line">    -keyout certs/key.pem \</span><br><span class="line">    -out certs/cert.pem</span><br></pre></td></tr></table></figure><ul><li><strong>option-b</strong>: configure with a <code>ssl.cnf</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">When using -x509, default_days <span class="keyword">in</span> config will be ignored, it is a bug</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">using -days to workaround</span></span><br><span class="line">openssl req -x509 -new -nodes -days 365 \</span><br><span class="line">    -config ssl.cnf \</span><br><span class="line">    -keyout certs/key.pem \</span><br><span class="line">    -out certs/cert.pem</span><br></pre></td></tr></table></figure><p><code>ssl.cnf</code> like as follows:</p><p>Tips: <code>DNS.1</code>, <code>DNS.2</code>, <code>IP.7</code>, <code>DNS.11</code>, the numbers are only required to be unique, and can also be unordered.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[ req ]</span><br><span class="line">default_bits       = 4096</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">x509_extensions    = v3_req</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line">C  = CN</span><br><span class="line">ST = SH</span><br><span class="line">L  = Shanghai</span><br><span class="line">O  = Individual</span><br><span class="line">OU = MyStudio</span><br><span class="line">CN = x.internal</span><br><span class="line"></span><br><span class="line">[ v3_req ]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[alt_names]</span><br><span class="line">DNS.1  = x.internal</span><br><span class="line">DNS.2  = *.x.internal</span><br><span class="line">IP.7   = 127.0.0.1</span><br><span class="line">DNS.11 = localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p traefik up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p traefik up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="https://traefik.x.internal">https://traefik.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to enable https for traefik and make browsers trust HTTPS</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
    <category term="https" scheme="https://blog.caoyu.info/tags/https/"/>
    
    <category term="ssl" scheme="https://blog.caoyu.info/tags/ssl/"/>
    
    <category term="openssl" scheme="https://blog.caoyu.info/tags/openssl/"/>
    
    <category term="certificates" scheme="https://blog.caoyu.info/tags/certificates/"/>
    
  </entry>
  
  <entry>
    <title>Quick Start: Traefik Dashboard with Custom Domain</title>
    <link href="https://blog.caoyu.info/quick-start-1-traefik.html"/>
    <id>https://blog.caoyu.info/quick-start-1-traefik.html</id>
    <published>2023-04-13T09:25:36.000Z</published>
    <updated>2023-04-13T09:55:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Quick Start: Traefik</h1><h2 id="Preparation">Preparation</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create <span class="built_in">dirs</span> and empty files</span></span><br><span class="line">mkdir -p traefik/dynamic-conf &amp;&amp; cd traefik &amp;&amp; touch compose.yml traefik.yml dynamic-conf/self.yml</span><br></pre></td></tr></table></figure><h3 id="compose-yml">compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">traefik:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">traefik:3.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="comment"># /traefik.yml and /etc/traefik/traefik.yml are both available.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./traefik.yml:/etc/traefik/traefik.yml&quot;</span></span><br><span class="line">            <span class="comment"># dynamic-conf dir is self-defined</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;./dynamic-conf:/etc/traefik/dynamic-conf&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">traefik-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">traefik-net:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">traefik-net</span></span><br><span class="line">        <span class="attr">ipam:</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="bullet">-</span>   <span class="attr">subnet:</span> <span class="number">172.16</span><span class="number">.238</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="traefik-yml">traefik.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Static Configuration</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">INFO</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">    <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">dashboard:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">entryPoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">        <span class="attr">address:</span> <span class="string">:80</span></span><br><span class="line"><span class="attr">providers:</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">directory:</span> <span class="string">/etc/traefik/dynamic-conf</span></span><br><span class="line">        <span class="attr">watch:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="self-yml-in-dir-dynamic-conf">self.yml in dir dynamic-conf</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Dynamic Configuration</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">    <span class="attr">routers:</span></span><br><span class="line">        <span class="attr">dashboard:</span></span><br><span class="line">            <span class="attr">rule:</span> <span class="string">Host(`traefik.x.internal`)</span></span><br><span class="line">            <span class="attr">service:</span> <span class="string">api@internal</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Config-DNS-domain-parse">Config DNS domain parse</h2><p>If you have DNS server, please reference the DNS server guide to config it</p><p>If not and using unix-like system, edit the <code>/etc/hosts</code></p><p>if using windows, edit the <code>C:\Windows\System32\drivers\etc\hosts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 traefik.x.internal</span><br></pre></td></tr></table></figure><h2 id="Run">Run</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -p traefik up -d</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker compose -f ./compose.yml -p traefik up -d</span></span><br></pre></td></tr></table></figure><p>Access: <a href="http://traefik.x.internal">http://traefik.x.internal</a></p>]]></content>
    
    
    <summary type="html">how to configure custom domain for traefik dashboard</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
    <category term="traefik" scheme="https://blog.caoyu.info/tags/traefik/"/>
    
  </entry>
  
  <entry>
    <title>Create Self-signed Certificate with custom subject</title>
    <link href="https://blog.caoyu.info/self-signed-cert.html"/>
    <id>https://blog.caoyu.info/self-signed-cert.html</id>
    <published>2023-03-10T09:33:32.000Z</published>
    <updated>2023-03-10T09:33:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Self-signed Certificate</h1><blockquote><p>The deprecated, legacy behavior of treating the <code>CommonName</code> field on X.509 certificates as a host name when no Subject Alternative Names are present is now disabled by default. It can be temporarily re-enabled by adding the value <code>x509ignoreCN=0</code> to the <code>GODEBUG</code> environment variable.</p><p>Note that if the <code>CommonName</code> is an invalid host name, it's always ignored, regardless of <code>GODEBUG</code> settings. Invalid names include those with any characters other than letters, digits, hyphens and underscores, and those with empty labels or trailing dots.</p></blockquote><h2 id="create-root-key-and-crt">create root key and crt</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Here, rootCA.key is the same as rootKey.pem. Only the file extensions are different.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rootCA.crt &lt;==&gt; rootCrt.pem. The reason is the same as the above.</span></span><br><span class="line">openssl req -x509 -nodes -sha256 -days 10240 -newkey rsa:4096 -keyout rootCA.key -out rootCA.crt \</span><br><span class="line">-subj &quot;/C=CN/ST=Beijing/L=Beijing/O=MyOrg, Inc./OU=Software Dept/CN=localhost&quot;</span><br><span class="line">openssl req -x509 -nodes -sha256 \</span><br><span class="line">-newkey rsa:4096 \</span><br><span class="line">-days 10240 \</span><br><span class="line">-subj &quot;/C=CN/ST=Beijing/L=Beijing/O=MyOrg, Inc./OU=Software Dept/CN=localhost&quot; \</span><br><span class="line">-keyout root.key.pem \</span><br><span class="line">-out root.crt.pem</span><br></pre></td></tr></table></figure><h2 id="Self-signed-Certificate-by-Owned-CA">Self-signed Certificate by Owned CA</h2><p>If you don't have the servers and clients, this section is enough for you.</p><p>If not, please reference the section <strong>Create Server Certificate</strong> and <strong>Create Client Certificate</strong>.</p><h3 id="create-by-config-Recommend">create by config [Recommend]</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">MY_CONFIG=&quot;</span><br><span class="line">[ req ]</span><br><span class="line">default_bits                    = 4096</span><br><span class="line">distinguished_name              = req_distinguished_name</span><br><span class="line">req_extensions                  = v3_req</span><br><span class="line">x509_extensions                 = v3_ca</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line">countryName                     = Country Name (2 letter code)</span><br><span class="line">countryName_default             = CN</span><br><span class="line">countryName_min                 = 2</span><br><span class="line">countryName_max                 = 2</span><br><span class="line"></span><br><span class="line">stateOrProvinceName             = State or Province Name (full name)</span><br><span class="line">stateOrProvinceName_default     = Shanghai</span><br><span class="line"></span><br><span class="line">localityName                    = Locality Name (eg, city)</span><br><span class="line">localityName_default            = Shanghai</span><br><span class="line"></span><br><span class="line">0.organizationName              = Organization Name (eg, company)</span><br><span class="line">0.organizationName_default      = MyOrg, Inc.</span><br><span class="line"></span><br><span class="line">organizationalUnitName          = Organizational Unit Name (eg, section)</span><br><span class="line">organizationalUnitName_default  = Software Dept.</span><br><span class="line"></span><br><span class="line">commonName                      = Common Name (eg, YOUR name)</span><br><span class="line">commonName_default              = localhost</span><br><span class="line">commonName_max                  = 64</span><br><span class="line"></span><br><span class="line">emailAddress                    = Email Address</span><br><span class="line">emailAddress_max                = 64</span><br><span class="line"></span><br><span class="line">[ v3_req ]</span><br><span class="line">subjectAltName=@alt_names</span><br><span class="line">basicConstraints=CA:true</span><br><span class="line"></span><br><span class="line">[ v3_ca ]</span><br><span class="line">subjectAltName=@alt_names</span><br><span class="line">basicConstraints=CA:true</span><br><span class="line"></span><br><span class="line">[ alt_names ]</span><br><span class="line">IP.1=127.0.0.1</span><br><span class="line">IP.2=::1</span><br><span class="line">DNS.1=localhost</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">openssl req -new -nodes \</span><br><span class="line">    -newkey rsa:4096 \</span><br><span class="line">    -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=MyOrg, Inc./OU=Software Dept/CN=localhost&quot; \</span><br><span class="line">    -config &lt;(echo &quot;$&#123;MY_CONFIG&#125;&quot;) \</span><br><span class="line">    -keyout localhost.key.pem \</span><br><span class="line">    -out localhost.csr</span><br><span class="line"></span><br><span class="line">openssl x509 -req -sha256 -CAcreateserial -days 365 \</span><br><span class="line">-CA root.crt.pem \</span><br><span class="line">-CAkey root.key.pem \</span><br><span class="line">-extensions v3_ca \</span><br><span class="line">-extfile &lt;(echo &quot;$&#123;MY_CONFIG&#125;&quot;) \</span><br><span class="line">-in localhost.csr \</span><br><span class="line">-out localhost.crt.pem</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="one-command-Not-Recommend">one command [Not Recommend]</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OPENSSL_CONF=<span class="string">&quot;/etc/ssl/openssl.cnf&quot;</span></span></span><br><span class="line">OPENSSL_CONF=&quot;/System/Library/OpenSSL/openssl.cnf&quot;</span><br><span class="line">openssl req -new -nodes \</span><br><span class="line">    -newkey rsa:4096 \</span><br><span class="line">    -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=MyOrg, Inc./OU=Software Dept/CN=localhost&quot; \</span><br><span class="line">    -reqexts SAN \</span><br><span class="line">    -config &lt;(cat &quot;$&#123;OPENSSL_CONF&#125;&quot; \</span><br><span class="line">        &lt;(printf &quot;\n[SAN]\nsubjectAltName=DNS:localhost&quot;)) \</span><br><span class="line">    -keyout localhost.key.pem \</span><br><span class="line">    -out localhost.csr</span><br><span class="line"></span><br><span class="line">openssl x509 -req -sha256 -CAcreateserial -days 365 \</span><br><span class="line">-CA root.crt.pem \</span><br><span class="line">-CAkey root.key.pem \</span><br><span class="line">-extfile &lt;(printf &quot;subjectAltName=DNS:localhost&quot;) \</span><br><span class="line">-in localhost.csr \</span><br><span class="line">-out localhost.crt.pem</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Create-Server-Certificate">Create Server Certificate</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">config file is at the following</span></span><br><span class="line">openssl req -new -nodes \</span><br><span class="line">    -newkey rsa:4096 \</span><br><span class="line">    -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=MyOrg, Inc./OU=Software Dept/CN=localhost&quot; \</span><br><span class="line">    -config crt_ext_server.cnf \</span><br><span class="line">    -keyout server.key.pem \</span><br><span class="line">    -out server.csr</span><br><span class="line"></span><br><span class="line">openssl x509 -req -sha256 -CAcreateserial -days 365 \</span><br><span class="line">-CA root.crt.pem \</span><br><span class="line">-CAkey root.key.pem \</span><br><span class="line">-extensions v3_ca \</span><br><span class="line">-extfile crt_ext_server.cnf \</span><br><span class="line">-in server.csr \</span><br><span class="line">-out server.crt.pem</span><br></pre></td></tr></table></figure><h3 id="cat-crt-ext-server-cnf">cat crt_ext_server.cnf</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">oid_section</span> = new_oids</span><br><span class="line"></span><br><span class="line"><span class="section">[ new_oids ]</span></span><br><span class="line"><span class="attr">custom_base</span>                         = <span class="number">4.2</span>.<span class="number">1.3</span>.<span class="number">5.2</span>.<span class="number">6.8</span>.<span class="number">1.2</span></span><br><span class="line"><span class="attr">custom_user_group</span>                   = <span class="variable">$&#123;custom_base&#125;</span>.<span class="number">1</span></span><br><span class="line"><span class="attr">custom_user_role</span>                    = <span class="variable">$&#123;custom_base&#125;</span>.<span class="number">2</span></span><br><span class="line"><span class="attr">custom_concurrent_num</span>               = <span class="variable">$&#123;custom_base&#125;</span>.<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ req ]</span></span><br><span class="line"><span class="attr">default_bits</span>                        = <span class="number">4096</span></span><br><span class="line"><span class="attr">distinguished_name</span>                  = req_distinguished_name</span><br><span class="line"><span class="attr">req_extensions</span>                      = v3_req</span><br><span class="line"><span class="attr">x509_extensions</span>                     = v3_ca</span><br><span class="line"></span><br><span class="line"><span class="section">[ req_distinguished_name ]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ v3_req ]</span></span><br><span class="line"><span class="attr">basicConstraints</span>                    = CA:<span class="literal">false</span></span><br><span class="line"><span class="attr">custom_user_group</span>                   = ASN1:UTF8String:G1</span><br><span class="line"><span class="attr">custom_user_role</span>                    = ASN1:UTF8String:R1</span><br><span class="line"><span class="attr">custom_concurrent_num</span>               = ASN1:UTF8String:<span class="number">3</span></span><br><span class="line"><span class="attr">subjectAltName</span>                      = @alt_names</span><br><span class="line"></span><br><span class="line"><span class="section">[ v3_ca ]</span></span><br><span class="line"><span class="attr">basicConstraints</span>                    = CA:<span class="literal">false</span></span><br><span class="line"><span class="attr">nsCertType</span>                          = server</span><br><span class="line"><span class="attr">nsComment</span>                           = <span class="string">&quot;OpenSSL Generated Server Certificate&quot;</span></span><br><span class="line"><span class="attr">keyUsage</span>                            = critical, digitalSignature, keyEncipherment</span><br><span class="line"><span class="attr">extendedKeyUsage</span>                    = serverAuth</span><br><span class="line"><span class="attr">4.2.1.3.5.2.6.8.1.2.1</span>               = ASN1:UTF8String:G1</span><br><span class="line"><span class="attr">4.2.1.3.5.2.6.8.1.2.2</span>               = ASN1:UTF8String:R1</span><br><span class="line"><span class="attr">4.2.1.3.5.2.6.8.1.2.3</span>               = ASN1:UTF8String:<span class="number">3</span></span><br><span class="line"><span class="attr">subjectAltName</span>                      = @alt_names</span><br><span class="line"></span><br><span class="line"><span class="section">[ alt_names ]</span></span><br><span class="line"><span class="attr">IP.1</span>                                = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">IP.2</span>                                = ::<span class="number">1</span></span><br><span class="line"><span class="attr">DNS.1</span>                               = localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Create-Client-Certificate">Create Client Certificate</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">config file is at the following</span></span><br><span class="line">openssl req -new -nodes \</span><br><span class="line">    -newkey rsa:4096 \</span><br><span class="line">    -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=MyOrg, Inc./OU=Software Dept/CN=localhost&quot; \</span><br><span class="line">    -config crt_ext_client.cnf \</span><br><span class="line">    -keyout client.key.pem \</span><br><span class="line">    -out client.csr</span><br><span class="line"></span><br><span class="line">openssl x509 -req -sha256 -CAcreateserial -days 365 \</span><br><span class="line">-CA root.crt.pem \</span><br><span class="line">-CAkey root.key.pem \</span><br><span class="line">-extensions v3_ca \</span><br><span class="line">-extfile crt_ext_client.cnf \</span><br><span class="line">-in client.csr \</span><br><span class="line">-out client.crt.pem</span><br></pre></td></tr></table></figure><h3 id="cat-crt-ext-client-cnf">cat crt_ext_client.cnf</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">oid_section</span> = new_oids</span><br><span class="line"></span><br><span class="line"><span class="section">[ new_oids ]</span></span><br><span class="line"><span class="attr">custom_base</span>                    = <span class="number">4.2</span>.<span class="number">1.3</span>.<span class="number">5.2</span>.<span class="number">6.8</span>.<span class="number">1.2</span></span><br><span class="line"><span class="attr">custom_user_group</span>              = <span class="variable">$&#123;custom_base&#125;</span>.<span class="number">1</span></span><br><span class="line"><span class="attr">custom_user_role</span>               = <span class="variable">$&#123;custom_base&#125;</span>.<span class="number">2</span></span><br><span class="line"><span class="attr">custom_concurrent_num</span>          = <span class="variable">$&#123;custom_base&#125;</span>.<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ req ]</span></span><br><span class="line"><span class="attr">default_bits</span>                   = <span class="number">4096</span></span><br><span class="line"><span class="attr">distinguished_name</span>             = req_distinguished_name</span><br><span class="line"><span class="attr">req_extensions</span>                 = v3_req</span><br><span class="line"><span class="attr">x509_extensions</span>                = v3_ca</span><br><span class="line"></span><br><span class="line"><span class="section">[ req_distinguished_name ]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ v3_req ]</span></span><br><span class="line"><span class="attr">basicConstraints</span>               = CA:<span class="literal">false</span></span><br><span class="line"><span class="attr">custom_user_group</span>              = ASN1:UTF8String:G1</span><br><span class="line"><span class="attr">custom_user_role</span>               = ASN1:UTF8String:R1</span><br><span class="line"><span class="attr">custom_concurrent_num</span>          = ASN1:UTF8String:<span class="number">3</span></span><br><span class="line"><span class="attr">subjectAltName</span>                 = @alt_names</span><br><span class="line"></span><br><span class="line"><span class="section">[ v3_ca ]</span></span><br><span class="line"><span class="attr">basicConstraints</span>               = CA:<span class="literal">false</span></span><br><span class="line"><span class="attr">nsCertType</span>                     = client, email</span><br><span class="line"><span class="attr">nsComment</span>                      = <span class="string">&quot;OpenSSL Generated Client Certificate&quot;</span></span><br><span class="line"><span class="attr">keyUsage</span>                       = critical, nonRepudiation, digitalSignature, keyEncipherment</span><br><span class="line"><span class="attr">extendedKeyUsage</span>               = clientAuth, emailProtection</span><br><span class="line"><span class="attr">4.2.1.3.5.2.6.8.1.2.1</span>          = ASN1:UTF8String:G1</span><br><span class="line"><span class="attr">4.2.1.3.5.2.6.8.1.2.2</span>          = ASN1:UTF8String:R1</span><br><span class="line"><span class="attr">4.2.1.3.5.2.6.8.1.2.3</span>          = ASN1:UTF8String:<span class="number">3</span></span><br><span class="line"><span class="attr">subjectAltName</span>                 = @alt_names</span><br><span class="line"></span><br><span class="line"><span class="section">[ alt_names ]</span></span><br><span class="line"><span class="attr">IP.1</span>                           = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">IP.2</span>                           = ::<span class="number">1</span></span><br><span class="line"><span class="attr">DNS.1</span>                          = localhost</span><br></pre></td></tr></table></figure><h2 id="Show-Certificate-Info">Show Certificate Info</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">show message</span></span><br><span class="line">openssl rsa -in localhost.key.pem -noout -text</span><br><span class="line">openssl req -in localhost.csr -noout -text</span><br><span class="line">openssl x509 -in localhost.crt.pem -noout -text</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">create self-signed certificate</summary>
    
    
    
    <category term="encryption" scheme="https://blog.caoyu.info/categories/encryption/"/>
    
    
    <category term="openssl" scheme="https://blog.caoyu.info/tags/openssl/"/>
    
    <category term="certificates" scheme="https://blog.caoyu.info/tags/certificates/"/>
    
    <category term="rsa" scheme="https://blog.caoyu.info/tags/rsa/"/>
    
  </entry>
  
  <entry>
    <title>Docker network conflicts with local networks</title>
    <link href="https://blog.caoyu.info/docker-network-conflicts.html"/>
    <id>https://blog.caoyu.info/docker-network-conflicts.html</id>
    <published>2023-03-10T09:05:11.000Z</published>
    <updated>2023-04-13T09:45:11.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Docker Compose Network Conflicts</h1><h2 id="Compose-default-network-conflicts-with-the-local-network">Compose default network conflicts with the local network</h2><blockquote><p>To fix this issue, we should config the specified network by compose file.</p><p>Here is a sample.</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">Compose</span> <span class="string">specification</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">net1:</span></span><br><span class="line">        <span class="attr">ipam:</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="comment"># if not set, the default gateway is 172.66.99.1</span></span><br><span class="line">                <span class="bullet">-</span>   <span class="attr">subnet:</span> <span class="number">172.66</span><span class="number">.99</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">                <span class="comment"># or set a gateway</span></span><br><span class="line">                <span class="comment"># -   subnet: 172.34.0.0/16</span></span><br><span class="line">                <span class="comment">#     gateway: 172.34.0.1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">create a specified network to fix the conflicts</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="network" scheme="https://blog.caoyu.info/tags/network/"/>
    
    <category term="container" scheme="https://blog.caoyu.info/tags/container/"/>
    
    <category term="compose" scheme="https://blog.caoyu.info/tags/compose/"/>
    
  </entry>
  
  <entry>
    <title>Build amd64 and arm64 for docker images</title>
    <link href="https://blog.caoyu.info/docker-buildx-multi-platform.html"/>
    <id>https://blog.caoyu.info/docker-buildx-multi-platform.html</id>
    <published>2023-03-10T09:00:42.000Z</published>
    <updated>2023-03-10T09:00:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1>docker buildx for multiarch support</h1><h2 id="create-a-builder">create a builder</h2><p>because the default builder doesn't support multi-arch building,<br>create a new builder with docker-container driver and use it</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx create  --use --name multiarch --driver docker-container</span><br></pre></td></tr></table></figure><p>if your self-build registry is not https, please touch a <code>buildkitd.toml</code></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[registry.&quot;your-registry-domain or ip&quot;]</span></span><br><span class="line"><span class="attr">http</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">insecure</span> = <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>and then use this config to create a builder</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> your builder has already existed, delete it and create</span></span><br><span class="line">docker buildx rm multiarch</span><br><span class="line">docker buildx create  --use --name multiarch --driver docker-container --config ./buildkitd.toml</span><br></pre></td></tr></table></figure><h2 id="build-the-multiarch-image-and-push-it-to-your-registry">build the multiarch image and push it to your registry</h2><p><code>docker buildx inspect --bootstrap</code> to get the supported platform information</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">don<span class="string">&#x27;t ignore the trailing dot, it&#x27;</span>s to search the current directory<span class="string">&#x27;s Dockerfile file</span></span></span><br><span class="line">docker buildx build --push --platform linux/amd64,linux/arm64 -t pplmx/demo:v2.0.0 .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">if you wanna to specify a Dockerfile</span></span></span><br><span class="line">docker buildx build --push --platform linux/amd64,linux/arm64 -t pplmx/demo:v2.0.0 -f ./Dockerfile</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">build amd64 and arm64 images for multi-platform support</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="amd64" scheme="https://blog.caoyu.info/tags/amd64/"/>
    
    <category term="arm64" scheme="https://blog.caoyu.info/tags/arm64/"/>
    
  </entry>
  
  <entry>
    <title>Build cpp with gcc11 on CentOS7</title>
    <link href="https://blog.caoyu.info/build-cpp-centos7.html"/>
    <id>https://blog.caoyu.info/build-cpp-centos7.html</id>
    <published>2023-03-10T08:58:34.000Z</published>
    <updated>2023-03-10T08:58:34.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### BUILDING</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span> AS builder</span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> author=<span class="string">&quot;Mystic&quot;</span></span></span><br><span class="line"><span class="keyword">ARG</span> CMAKE_VERSION=<span class="string">&quot;3.24.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/tmp</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -LO https://github.com/Kitware/CMake/releases/download/v<span class="variable">$&#123;CMAKE_VERSION&#125;</span>/cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>-linux-x86_64.tar.gz &amp;&amp;\</span></span><br><span class="line"><span class="language-bash">    tar -zxf cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>-linux-x86_64.tar.gz &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    \<span class="built_in">cp</span> -fr cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>-linux-x86_64/* /usr/local</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum upgrade -y</span></span><br><span class="line"><span class="comment"># install gcc 11</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y centos-release-scl &amp;&amp;  \</span></span><br><span class="line"><span class="language-bash">    yum install -y devtoolset-11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To ensure the symlink works fine on Windows, you must do the following:</span></span><br><span class="line"><span class="comment"># 1. `git config --global core.symlinks true`</span></span><br><span class="line"><span class="comment"># 2. Enable `Developer Mode` to authorize `mklink` permission</span></span><br><span class="line"><span class="comment"># 3. reclone your repo</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> build</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run cmake with gcc 11</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> scl <span class="built_in">enable</span> devtoolset-11 <span class="string">&#x27;cmake .. &amp;&amp; cmake --build . --target sample --config Release --parallel 8&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">### DEPLOYING</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/build/sample /sample</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="built_in">test</span> .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/sample&quot;</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">build cpp project with gcc 11 on CentOS7 image</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="cpp" scheme="https://blog.caoyu.info/tags/cpp/"/>
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="centos7" scheme="https://blog.caoyu.info/tags/centos7/"/>
    
    <category term="gcc" scheme="https://blog.caoyu.info/tags/gcc/"/>
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Install binary packages on Unix-like systems</title>
    <link href="https://blog.caoyu.info/install-binary-file.html"/>
    <id>https://blog.caoyu.info/install-binary-file.html</id>
    <published>2023-03-10T08:45:12.000Z</published>
    <updated>2023-03-10T08:45:12.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># by wget</span></span><br><span class="line">wget -O /var/tmp/go.tar.gz https://go.dev/dl/go1.20.2.linux-amd64.tar.gz</span><br><span class="line">wget -O /var/tmp/node.tar.xz https://nodejs.org/dist/v19.7.0/node-v19.7.0-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># by curl</span></span><br><span class="line">curl -o /var/tmp/go.tar.gz https://go.dev/dl/go1.20.2.linux-amd64.tar.gz</span><br><span class="line">curl -o /var/tmp/node.tar.xz https://nodejs.org/dist/v19.7.0/node-v19.7.0-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># If not set to -z, or -j, or -J, etc., it will automatically decompress the files by file extension.</span></span><br><span class="line">sudo <span class="built_in">rm</span> -rf /usr/local/go &amp;&amp; sudo tar -C /usr/local -xf /var/tmp/go.tar.gz</span><br><span class="line">sudo <span class="built_in">rm</span> -fr /usr/local/node &amp;&amp; sudo install -d /usr/local/node &amp;&amp; sudo tar -C /usr/local/node -xf /var/tmp/node.tar.xz --strip-components=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can do this by adding the following line to your $HOME/.profile or /etc/profile (for a system-wide installation):</span></span><br><span class="line"><span class="comment"># for me, I like add exports to /etc/profile.d/sh.local for a system-wide</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/go/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/node/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Verify it</span></span><br><span class="line">go version</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">install golang and node binary packages on Unix-like systems</summary>
    
    
    
    <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
    <category term="linux" scheme="https://blog.caoyu.info/tags/linux/"/>
    
    <category term="binary" scheme="https://blog.caoyu.info/tags/binary/"/>
    
    <category term="go" scheme="https://blog.caoyu.info/tags/go/"/>
    
    <category term="node" scheme="https://blog.caoyu.info/tags/node/"/>
    
  </entry>
  
  <entry>
    <title>Let&#39;s deeply understand how to run a container</title>
    <link href="https://blog.caoyu.info/docker-world.html"/>
    <id>https://blog.caoyu.info/docker-world.html</id>
    <published>2021-03-31T06:48:04.000Z</published>
    <updated>2021-03-31T07:31:10.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Docker</h1><p><a href="https://www.docker.com/blog/introducing-docker-engine-18-09/">Referenced from here.</a></p><p><img src="assets/DockerEngineDiagram-1.png" alt="Introducing Docker Engine 18.09 - Docker Blog"></p><p><a href="https://mkdev.me/en/posts/the-tool-that-really-runs-your-containers-deep-dive-into-runc-and-oci-specifications">Referenced from here.</a></p><p><img src="assets/differ-container.png" alt="Differ Container"></p><p><a href="https://medium.com/@avijitsarkar123/docker-and-oci-runtimes-a9c23a5646d6">Referenced from here.</a></p><p><img src="assets/docker_oci.png" alt="Docker and OCI Runtimes."></p><h2 id="Components">Components</h2><ul><li>dockerd</li><li>containerd</li><li>containerd-shim</li><li>runc</li></ul><h3 id="runc">runc</h3><p><code>CLI tool</code> for spawning and running containers according to the <code>OCI specification</code>.</p><h3 id="containerd-shim">containerd-shim</h3><p>The shim allows for <code>daemonless</code> containers. It basically sits as the parent of the container's process to facilitate a few things.</p><ul><li>First it allows the runtimes(i.e. <code>runc</code>) to exit after it starts the container. This way we don't have to have the long running runtime processes for containers. When you start <code>mysql</code> you should only see the <code>mysql</code> process and the shim.</li><li>Second it keeps the STDIO and other fds open for the container incase <code>containerd</code> and/or docker both die. If the shim was not running then the parent side of the pipes or the TTY master would be closed and the container would exit.</li><li>Finally it allows the container's exit status to be reported back to a higher level tool like docker without having the be the actual parent of the container's process and do a <code>wait4</code>.</li></ul><h3 id="containerd">containerd</h3><p><strong>containerd</strong> was introduced in Docker 1.11 and since then took main responsibility of managing containers life-cycle. <code>containerd</code> is the <em>executor for containers</em>, but has a wider scope than <em>just executing</em> containers. So it also take care of:</p><ul><li>Image push and pull</li><li>Managing of storage</li><li>Of course executing of Containers by calling <strong>runc</strong> with the right parameters to run containers...</li><li>Managing of network primitives for interfaces</li><li>Management of network namespaces containers to join existing namespaces</li></ul><h3 id="dockerd">dockerd</h3><p>The Docker daemon - <strong>dockerd</strong> listens for Docker API requests and manages host's Container life-cycles by utilizing <strong>containerd</strong>.</p><p><code>dockerd</code> can listen for Docker Engine API requests via three different types of Socket: <code>unix</code>, <code>tcp</code>, and <code>fd</code>.</p><p>By default, a <code>unix</code> domain socket is created at <code>/var/run/docker.sock</code>, requiring either root permission, or docker group membership.</p><p>On <a href="http://alexander.holbreich.org/tag/systemd/">Systemd</a> based systems, you can communicate with the daemon via <code>Systemd</code> socket activation, use <code>dockerd -H fd://</code>.</p><h2 id="Workflow-among-the-above-components">Workflow among the above components</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">❯ docker --version</span><br><span class="line">Docker version 20.10.5, build 55c4c88</span><br><span class="line"></span><br><span class="line">❯ sudo docker container <span class="built_in">ls</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS     NAMES</span><br><span class="line">05ebb62bc655   nginx     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   13 days ago   Up 13 days   80/tcp    nginx2</span><br><span class="line">7f3fa77ddad8   nginx     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   13 days ago   Up 13 days   80/tcp    nginx1</span><br><span class="line"></span><br><span class="line">❯ ps -ef --forest | grep -v <span class="string">&quot; --color=auto&quot;</span> | grep -A3 -E <span class="string">&quot;dockerd|containerd&quot;</span></span><br><span class="line">root         714       1  0 Mar17 ?        00:17:12 /usr/bin/containerd</span><br><span class="line">root        1931       1  0 Mar17 ?        00:02:53 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">root        2139       1  0 Mar17 ?        00:01:04 /usr/bin/containerd-shim-runc-v2 -namespace moby -<span class="built_in">id</span> 7f3fa77ddad85e82619b21d6fd9bde8c6fa7cce9e1c063b4f18f258c1206b1e4 -address /run/containerd/containerd.sock</span><br><span class="line">root        2163    2139  0 Mar17 ?        00:00:00  \_ nginx: master process nginx -g daemon off;</span><br><span class="line">systemd+    2217    2163  0 Mar17 ?        00:00:00      \_ nginx: worker process</span><br><span class="line">root        2240       1  0 Mar17 ?        00:01:05 /usr/bin/containerd-shim-runc-v2 -namespace moby -<span class="built_in">id</span> 05ebb62bc6557c76f9d4494bbd2262e9fa7f91c3a0bad14677455a158e949f75 -address /run/containerd/containerd.sock</span><br><span class="line">root        2261    2240  0 Mar17 ?        00:00:00  \_ nginx: master process nginx -g daemon off;</span><br><span class="line">systemd+    2319    2261  0 Mar17 ?        00:00:00      \_ nginx: worker process</span><br><span class="line"></span><br><span class="line">=================================</span><br><span class="line"></span><br><span class="line">❯ docker --version</span><br><span class="line">Docker version 19.03.15, build 99e3ed8919</span><br><span class="line"></span><br><span class="line">❯ docker container <span class="built_in">ls</span></span><br><span class="line">CONTAINER ID    IMAGE    COMMAND                  CREATED           STATUS           PORTS     NAMES</span><br><span class="line">cbb233ea0045    nginx    <span class="string">&quot;/docker-entrypoint.…&quot;</span>   11 minutes ago    Up 11 minutes    80/tcp    nginx2</span><br><span class="line">fa3468d6e89a    nginx    <span class="string">&quot;/docker-entrypoint.…&quot;</span>   11 minutes ago    Up 11 minutes    80/tcp    nginx1</span><br><span class="line"></span><br><span class="line">❯ ps -ef --forest | less</span><br><span class="line">root      184283       1  0 14:10 ?        00:00:00 /usr/bin/containerd</span><br><span class="line">root      184493  184283  0 14:11 ?        00:00:00  \_ containerd-shim -namespace moby -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/moby/fa3468d6e89a7ddcbd67a7049b2fd1771555c445ba6e8795a4634cb4795ecdd6 -address /run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-root /var/run/docker/runtime-runc</span><br><span class="line">root      184509  184493  0 14:11 ?        00:00:00  |   \_ nginx: master process nginx -g daemon off;</span><br><span class="line">101       184564  184509  0 14:11 ?        00:00:00  |       \_ nginx: worker process</span><br><span class="line">root      184595  184283  0 14:11 ?        00:00:00  \_ containerd-shim -namespace moby -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/moby/cbb233ea004589877970ee3b4bcd08672370c159720617c29c31b943e4a5be3c -address /run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-root /var/run/docker/runtime-runc</span><br><span class="line">root      184611  184595  0 14:11 ?        00:00:00      \_ nginx: master process nginx -g daemon off;</span><br><span class="line">101       184663  184611  0 14:11 ?        00:00:00          \_ nginx: worker process</span><br><span class="line">root      184291       1  0 14:10 ?        00:00:01 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line"></span><br><span class="line">=================================</span><br><span class="line"></span><br><span class="line">❯ podman version</span><br><span class="line">Version:      2.2.1</span><br><span class="line">API Version:  2</span><br><span class="line">Go Version:   go1.14.12</span><br><span class="line">Built:        Mon Feb 22 12:51:35 2021</span><br><span class="line">OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">❯ podman container <span class="built_in">ls</span></span><br><span class="line">CONTAINER ID  IMAGE                           COMMAND               CREATED        STATUS            PORTS   NAMES</span><br><span class="line">2fed78dd707e  docker.io/library/nginx:latest  nginx -g daemon o...  2 minutes ago  Up 2 minutes ago          nginx2</span><br><span class="line">75103237f3d5  docker.io/library/nginx:latest  nginx -g daemon o...  2 minutes ago  Up 2 minutes ago          nginx1</span><br><span class="line"></span><br><span class="line">❯ runc list</span><br><span class="line">ID                                                                 PID         STATUS      BUNDLE                                                                                                                     CREATED                          OWNER</span><br><span class="line">2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9   188922      running     /var/lib/containers/storage/overlay-containers/2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9/userdata   2021-03-31T06:36:31.164181537Z   root</span><br><span class="line">75103237f3d5f8d78f1d34cd32747c083f8d59eb5df4d09e3e68ab8279fcf832   188806      running     /var/lib/containers/storage/overlay-containers/75103237f3d5f8d78f1d34cd32747c083f8d59eb5df4d09e3e68ab8279fcf832/userdata   2021-03-31T06:36:25.812499602Z   root</span><br><span class="line"></span><br><span class="line">❯ runc state 2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ociVersion&quot;</span>: <span class="string">&quot;1.0.2-dev&quot;</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9&quot;</span>,</span><br><span class="line">  <span class="string">&quot;pid&quot;</span>: 188922,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bundle&quot;</span>: <span class="string">&quot;/var/lib/containers/storage/overlay-containers/2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9/userdata&quot;</span>,</span><br><span class="line">  <span class="string">&quot;rootfs&quot;</span>: <span class="string">&quot;/var/lib/containers/storage/overlay/9fde6f2ab9dee9701adce3862803afe893c009269e74c0c77e18c4454c9184d1/merged&quot;</span>,</span><br><span class="line">  <span class="string">&quot;created&quot;</span>: <span class="string">&quot;2021-03-31T06:36:31.164181537Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;annotations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;io.container.manager&quot;</span>: <span class="string">&quot;libpod&quot;</span>,</span><br><span class="line">    <span class="string">&quot;io.kubernetes.cri-o.Created&quot;</span>: <span class="string">&quot;2021-03-31T14:36:30.807867268+08:00&quot;</span>,</span><br><span class="line">    <span class="string">&quot;io.kubernetes.cri-o.TTY&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">    <span class="string">&quot;io.podman.annotations.autoremove&quot;</span>: <span class="string">&quot;FALSE&quot;</span>,</span><br><span class="line">    <span class="string">&quot;io.podman.annotations.init&quot;</span>: <span class="string">&quot;FALSE&quot;</span>,</span><br><span class="line">    <span class="string">&quot;io.podman.annotations.privileged&quot;</span>: <span class="string">&quot;FALSE&quot;</span>,</span><br><span class="line">    <span class="string">&quot;io.podman.annotations.publish-all&quot;</span>: <span class="string">&quot;FALSE&quot;</span>,</span><br><span class="line">    <span class="string">&quot;org.opencontainers.image.stopSignal&quot;</span>: <span class="string">&quot;3&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">❯ ps -ef --forest</span><br><span class="line">root      188797       1  0 14:36 ?        00:00:00 /usr/bin/conmon --api-version 1 -c 75103237f3d5f8d78f1d34cd32747c083f8d59eb5df4d09e3e68ab8279fcf832 -u 75103237f3d5f8d78f1d34cd32747c083f8d59eb5df4d09e3e68ab8279fcf832 -r /usr/bin/runc -b /var/lib/containers/storage/overlay-containers/75103237f3d5f8d78f1d34cd32747c08/run/containers/storage/overlay-containers/75103237f3d5f8d78f1d34cd32747c083f8d59eb5df4d09e3e68ab8279fcf832/userdata/conmon.pid --exit-command /usr/bin/podman --exit-command-arg --root --exit-command-arg /var/lib/containers/storage --exit-command-arg --runroot --exit-command-arg /var/run/containers/storage --exit-comm</span><br><span class="line">root      188806  188797  0 14:36 ?        00:00:00  \_ nginx: master process nginx -g daemon off;</span><br><span class="line">101       188842  188806  0 14:36 ?        00:00:00      \_ nginx: worker process</span><br><span class="line">root      188913       1  0 14:36 ?        00:00:00 /usr/bin/conmon --api-version 1 -c 2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9 -u 2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9 -r /usr/bin/runc -b /var/lib/containers/storage/overlay-containers/2fed78dd707e865d4995f2d80dd9ee78/run/containers/storage/overlay-containers/2fed78dd707e865d4995f2d80dd9ee7830776e8adfe62f2b5b2754fa8b950be9/userdata/conmon.pid --exit-command /usr/bin/podman --exit-command-arg --root --exit-command-arg /var/lib/containers/storage --exit-command-arg --runroot --exit-command-arg /var/run/containers/storage --exit-comm</span><br><span class="line">root      188922  188913  0 14:36 ?        00:00:00  \_ nginx: master process nginx -g daemon off;</span><br><span class="line">101       188955  188922  0 14:36 ?        00:00:00      \_ nginx: worker process</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Docker Architecture</summary>
    
    
    
    <category term="docker" scheme="https://blog.caoyu.info/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.caoyu.info/tags/docker/"/>
    
    <category term="container" scheme="https://blog.caoyu.info/tags/container/"/>
    
  </entry>
  
  <entry>
    <title>Install the Latest Packages by Ubuntu PPA</title>
    <link href="https://blog.caoyu.info/install-latest-by-ubuntu-ppa.html"/>
    <id>https://blog.caoyu.info/install-latest-by-ubuntu-ppa.html</id>
    <published>2021-03-18T03:12:08.000Z</published>
    <updated>2021-03-18T03:12:08.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Ubuntu</h1><h2 id="Use-PPA-source-Latest-Version">Use PPA source(Latest Version)</h2><h3 id="Git">Git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># after this, it will generate a new list in /etc/apt/sources.list.d</span></span><br><span class="line">sudo add-apt-repository ppa:git-core/ppa</span><br><span class="line"></span><br><span class="line"><span class="comment"># change &quot;http://ppa.launchpad.net&quot; to &quot;https://launchpad.proxy.ustclug.org&quot;</span></span><br><span class="line">❯ ll /etc/apt/sources.list.d</span><br><span class="line">.rw-r--r-- root root 137 B Fri Feb  5 17:49:07 2021 git-core-ubuntu-ppa-focal.list</span><br><span class="line">❯ <span class="built_in">cat</span> /etc/apt/sources.list.d/git-core-ubuntu-ppa-focal.list</span><br><span class="line">deb https://launchpad.proxy.ustclug.org/git-core/ppa/ubuntu focal main</span><br><span class="line"></span><br><span class="line"><span class="comment"># install the latest git</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install git</span><br></pre></td></tr></table></figure><h3 id="Gradle">Gradle</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:cwchien/gradle</span><br></pre></td></tr></table></figure><h3 id="OpenJDK">OpenJDK</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:openjdk-r/ppa</span><br></pre></td></tr></table></figure><h3 id="Python">Python</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:deadsnakes/ppa</span><br></pre></td></tr></table></figure><h2 id="Change-the-Default-PPA-Source">Change the Default PPA Source</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s@http://ppa.launchpad.net@https://launchpad.proxy.ustclug.org@g&quot;</span> /etc/apt/sources.list.d/*.list</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&quot;s@http://mirrors.aliyun.com@https://mirrors.aliyun.com@g&quot;</span> /etc/apt/sources.list</span><br><span class="line">sed -i <span class="string">&quot;s@http://archive.ubuntu.com@https://mirrors.aliyun.com@g&quot;</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">By PPA, to install the latest</summary>
    
    
    
    <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
    <category term="ubuntu" scheme="https://blog.caoyu.info/tags/ubuntu/"/>
    
  </entry>
  
</feed>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>我还是个宝宝!</title>
  
  <subtitle>宝宝,就是我,耶~</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.caoyu.info/"/>
  <updated>2020-05-06T16:16:51.000Z</updated>
  <id>https://blog.caoyu.info/</id>
  
  <author>
    <name>紫玄</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Difference among Iterable, Iterator and Generator</title>
    <link href="https://blog.caoyu.info/iterable-iterator-in-python.html"/>
    <id>https://blog.caoyu.info/iterable-iterator-in-python.html</id>
    <published>2020-05-06T16:16:51.000Z</published>
    <updated>2020-05-06T16:16:51.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Iterable-metaclass-ABCMeta"><a href="#Iterable-metaclass-ABCMeta" class="headerlink" title="Iterable(metaclass=ABCMeta)"></a>Iterable(metaclass=ABCMeta)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">__iter__</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@abstractmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">yield</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__subclasshook__</span><span class="params">(cls, C)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls <span class="keyword">is</span> Iterable:</span><br><span class="line">        <span class="keyword">return</span> _check_methods(C, <span class="string">"__iter__"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure><h1 id="Iterator-Iterable"><a href="#Iterator-Iterable" class="headerlink" title="Iterator(Iterable)"></a>Iterator(Iterable)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">__next__</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@abstractmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'Return the next item from the iterator. When exhausted, raise StopIteration'</span></span><br><span class="line">    <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__subclasshook__</span><span class="params">(cls, C)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls <span class="keyword">is</span> Iterator:</span><br><span class="line">        <span class="keyword">return</span> _check_methods(C, <span class="string">'__iter__'</span>, <span class="string">'__next__'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure><h1 id="Generator-Iterator"><a href="#Generator-Iterator" class="headerlink" title="Generator(Iterator)"></a>Generator(Iterator)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">send()</span></span><br><span class="line"><span class="string">throw()</span></span><br><span class="line"><span class="string">close()</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Return the next item from the generator.</span></span><br><span class="line"><span class="string">    When exhausted, raise StopIteration.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> self.send(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@abstractmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(self, value)</span>:</span></span><br><span class="line">    <span class="string">"""Send a value into the generator.</span></span><br><span class="line"><span class="string">    Return next yielded value or raise StopIteration.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"><span class="meta">@abstractmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">throw</span><span class="params">(self, typ, val=None, tb=None)</span>:</span></span><br><span class="line">    <span class="string">"""Raise an exception in the generator.</span></span><br><span class="line"><span class="string">    Return next yielded value or raise StopIteration.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> val <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> tb <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> typ</span><br><span class="line">        val = typ()</span><br><span class="line">    <span class="keyword">if</span> tb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        val = val.with_traceback(tb)</span><br><span class="line">    <span class="keyword">raise</span> val</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Raise GeneratorExit inside generator.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.throw(GeneratorExit)</span><br><span class="line">    <span class="keyword">except</span> (GeneratorExit, StopIteration):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">"generator ignored GeneratorExit"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__subclasshook__</span><span class="params">(cls, C)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls <span class="keyword">is</span> Generator:</span><br><span class="line">        <span class="keyword">return</span> _check_methods(C, <span class="string">'__iter__'</span>, <span class="string">'__next__'</span>,</span><br><span class="line">                              <span class="string">'send'</span>, <span class="string">'throw'</span>, <span class="string">'close'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p><strong>Generator</strong> is <strong>Iterator</strong>.</p><p><strong>Iterator</strong> is <strong>Iterable</strong>.</p><hr><p>According to <code>__subclasshook__</code> function,</p><p>Iterable, must implement <code>__iter__</code></p><p>Iterator, must implement <code>__iter__</code> and <code>__next__</code></p><p>Generator, must implement <code>__iter__</code> , <code>__next__</code>, <code>send</code>, <code>throw</code> and <code>close</code></p>]]></content>
    
    <summary type="html">
    
      What&#39;s Iterable, Iterator, Generator in Python?
    
    </summary>
    
    
      <category term="python" scheme="https://blog.caoyu.info/categories/python/"/>
    
    
      <category term="source" scheme="https://blog.caoyu.info/tags/source/"/>
    
  </entry>
  
  <entry>
    <title>Time complexity in isEmpty() and size()</title>
    <link href="https://blog.caoyu.info/is-empty-size-in-java.html"/>
    <id>https://blog.caoyu.info/is-empty-size-in-java.html</id>
    <published>2020-05-06T14:55:08.000Z</published>
    <updated>2020-05-06T14:55:08.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Time-complexity-in-isEmpty-and-size"><a href="#Time-complexity-in-isEmpty-and-size" class="headerlink" title="Time complexity in isEmpty() and size()"></a>Time complexity in isEmpty() and size()</h1><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>isEmpty() is always O(1).</p><p>size() is mostly O(1), but it can be also O(n).</p><h2 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h2><p>Mostly, size() and isEmpty() implementation</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For the above, both of their time complexity is O(1).</p><hr><p>For <strong>ConcurrentLinkedQueue</strong> class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the first live (non-deleted) node on list, or null if none.</span></span><br><span class="line"><span class="comment"> * This is yet another variant of poll/peek; here returning the</span></span><br><span class="line"><span class="comment"> * first node, not element.  We could make peek() a wrapper around</span></span><br><span class="line"><span class="comment"> * first(), but that would cost an extra volatile read of item,</span></span><br><span class="line"><span class="comment"> * and the need to add a retry loop to deal with the possibility</span></span><br><span class="line"><span class="comment"> * of losing a race to a concurrent poll().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Node&lt;E&gt; <span class="title">first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    restartFromHead: <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;E&gt; h = head, p = h, q;; p = q) &#123;</span><br><span class="line">            <span class="keyword">boolean</span> hasItem = (p.item != <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (hasItem || (q = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                updateHead(h, p);</span><br><span class="line">                <span class="keyword">return</span> hasItem ? p : <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p == q)</span><br><span class="line">                <span class="keyword">continue</span> restartFromHead;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns &#123;<span class="doctag">@code</span> true&#125; if this queue contains no elements.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if this queue contains no elements</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> first() == <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the number of elements in this queue.  If this queue</span></span><br><span class="line"><span class="comment"> * contains more than &#123;<span class="doctag">@code</span> Integer.MAX_VALUE&#125; elements, returns</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Integer.MAX_VALUE&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Beware that, unlike in most collections, this method is</span></span><br><span class="line"><span class="comment"> * &lt;em&gt;NOT&lt;/em&gt; a constant-time operation. Because of the</span></span><br><span class="line"><span class="comment"> * asynchronous nature of these queues, determining the current</span></span><br><span class="line"><span class="comment"> * number of elements requires an O(n) traversal.</span></span><br><span class="line"><span class="comment"> * Additionally, if elements are added or removed during execution</span></span><br><span class="line"><span class="comment"> * of this method, the returned result may be inaccurate.  Thus,</span></span><br><span class="line"><span class="comment"> * this method is typically not very useful in concurrent</span></span><br><span class="line"><span class="comment"> * applications.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the number of elements in this queue</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    restartFromHead: <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (ConcurrentLinkedQueue.Node&lt;E&gt; p = first(); p != <span class="keyword">null</span>;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.item != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">if</span> (++count == Integer.MAX_VALUE)</span><br><span class="line">                    <span class="keyword">break</span>;  <span class="comment">// @see Collection.size()</span></span><br><span class="line">            <span class="keyword">if</span> (p == (p = p.next))</span><br><span class="line">                <span class="keyword">continue</span> restartFromHead;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For this, isEmpty() is O(1), size() is O(n).</p>]]></content>
    
    <summary type="html">
    
      Time complexity in isEmpty() and size()
    
    </summary>
    
    
      <category term="java" scheme="https://blog.caoyu.info/categories/java/"/>
    
    
      <category term="complexity" scheme="https://blog.caoyu.info/tags/complexity/"/>
    
  </entry>
  
  <entry>
    <title>Let&#39;s learn what&#39;s singleton</title>
    <link href="https://blog.caoyu.info/singleton.html"/>
    <id>https://blog.caoyu.info/singleton.html</id>
    <published>2020-04-30T16:12:37.000Z</published>
    <updated>2020-04-30T16:12:37.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="单例-Singleton"><a href="#单例-Singleton" class="headerlink" title="单例(Singleton)"></a>单例(Singleton)</h1><p>数学与逻辑学中，singleton定义为“有且仅有一个元素的集合”。</p><h2 id="什么是单例"><a href="#什么是单例" class="headerlink" title="什么是单例?"></a>什么是单例?</h2><p>一个类有且仅有一个实例, 并提供一个可以访问它的全局访问点.</p><h2 id="单例有什么用"><a href="#单例有什么用" class="headerlink" title="单例有什么用?"></a>单例有什么用?</h2><p>解决一个全局使用类的<strong>频繁创建</strong>与<strong>销毁</strong>.</p><h2 id="怎么实现单例"><a href="#怎么实现单例" class="headerlink" title="怎么实现单例?"></a>怎么实现单例?</h2><h3 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h3><ul><li>隐藏类的构造方法</li><li>定义一个公有的静态方法, 通过它返回类的唯一实例</li></ul><h3 id="java实现"><a href="#java实现" class="headerlink" title="java实现"></a>java实现</h3><ol><li>DCL(Double Checked Lock)实现</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lazy4SafeDoubleCheck</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Lazy4SafeDoubleCheck singleton = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Lazy4SafeDoubleCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 避免反射创建多个实例</span></span><br><span class="line">        <span class="keyword">if</span>(singleton != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Lazy4SafeDoubleCheck <span class="title">getSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Lazy4SafeDoubleCheck<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    singleton = <span class="keyword">new</span> Lazy4SafeDoubleCheck();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 避免反序列化创建多个实例</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>枚举实现</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SingletonEnum &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用枚举实现的单例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">otherMethods</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Something"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Let&#39;s learn what&#39;s singleton
    
    </summary>
    
    
      <category term="java" scheme="https://blog.caoyu.info/categories/java/"/>
    
    
      <category term="design pattern" scheme="https://blog.caoyu.info/tags/design-pattern/"/>
    
  </entry>
  
  <entry>
    <title>roles&amp;tags in ansible</title>
    <link href="https://blog.caoyu.info/ansible-role-tags.html"/>
    <id>https://blog.caoyu.info/ansible-role-tags.html</id>
    <published>2020-04-30T09:59:05.000Z</published>
    <updated>2020-04-30T09:59:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="install-lldpd-by-ansible-roles"><a href="#install-lldpd-by-ansible-roles" class="headerlink" title="install lldpd by ansible roles"></a>install lldpd by ansible roles</h1><h2 id="ansible-layout"><a href="#ansible-layout" class="headerlink" title="ansible layout"></a>ansible layout</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@03e6e45a7f92 cc]<span class="comment"># tree ansible</span></span><br><span class="line">ansible</span><br><span class="line">├── roles</span><br><span class="line">│   └── lldp</span><br><span class="line">│       ├── defaults</span><br><span class="line">│       │   └── main.yml</span><br><span class="line">│       ├── files</span><br><span class="line">│       └── tasks</span><br><span class="line">│           ├── disable_lldp.yml</span><br><span class="line">│           ├── enable_lldp.yml</span><br><span class="line">│           └── main.yml</span><br><span class="line">└── site.yml</span><br><span class="line"></span><br><span class="line">5 directories, 5 files</span><br></pre></td></tr></table></figure><h2 id="show-the-content"><a href="#show-the-content" class="headerlink" title="show the content"></a>show the content</h2><h3 id="site-yml"><a href="#site-yml" class="headerlink" title="site.yml"></a>site.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">lldpd</span> <span class="string">installation</span></span><br><span class="line">    <span class="attr">roles:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">role:</span> <span class="string">lldp</span></span><br><span class="line">            <span class="attr">tags:</span> <span class="string">lldp</span></span><br></pre></td></tr></table></figure><h3 id="defaults-main-yml"><a href="#defaults-main-yml" class="headerlink" title="defaults/main.yml"></a>defaults/main.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">LLDPD_VERSION:</span> <span class="number">1.0</span><span class="number">.5</span></span><br></pre></td></tr></table></figure><h3 id="tasks-main-yml"><a href="#tasks-main-yml" class="headerlink" title="tasks/main.yml"></a>tasks/main.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">include:</span> <span class="string">enable_lldp.yml</span></span><br></pre></td></tr></table></figure><h3 id="tasks-enable-lldp-yml"><a href="#tasks-enable-lldp-yml" class="headerlink" title="tasks/enable_lldp.yml"></a>tasks/enable_lldp.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Retrieve</span> <span class="string">lldpd</span> <span class="string">source</span> <span class="string">code</span></span><br><span class="line">    <span class="attr">get_url:</span></span><br><span class="line">        <span class="comment"># TODO replace it</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">https://media.luffy.cx/files/lldpd/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">archive</span></span><br><span class="line">    <span class="attr">unarchive:</span></span><br><span class="line">        <span class="comment"># if configured like as the following, 'Retrieve lldpd source code' task can be removed</span></span><br><span class="line">        <span class="comment"># src: https://media.luffy.cx/files/lldpd/lldpd-&#123;&#123; LLDPD_VERSION &#125;&#125;.tar.gz</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">install</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">./configure</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">        <span class="attr">chdir:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">creates:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;/configure.status.log</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span> <span class="string">lldpd</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">make</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">        <span class="attr">chdir:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">creates:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;/make.status.log</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Install</span> <span class="string">lldpd</span></span><br><span class="line">    <span class="attr">become:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">make</span> <span class="string">install</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">        <span class="attr">chdir:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">creates:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;/make_install.status.log</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Create</span> <span class="string">chroot</span> <span class="string">for</span> <span class="string">lldpd</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/usr/local/var/run/lldpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Create</span> <span class="string">_lldpd</span> <span class="string">group</span></span><br><span class="line">    <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">_lldpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Create</span> <span class="string">_lldpd</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">_lldpd</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">_lldpd</span></span><br><span class="line">        <span class="attr">comment:</span> <span class="string">lldpd</span> <span class="string">user</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">build</span> <span class="string">directory</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">archive</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">LLDPD_VERSION</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Create</span> <span class="string">lldpd.conf</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/lldpd.conf</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">lldpd.conf</span></span><br><span class="line">    <span class="attr">blockinfile:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/etc/lldpd.conf</span></span><br><span class="line">        <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line">            <span class="comment"># Reference from https://vincentbernat.github.io/lldpd/usage.html</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">system</span> <span class="string">chassisid</span> <span class="string">&lt;chassisid&gt;</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">system</span> <span class="string">hostname</span> <span class="string">&lt;hostname&gt;</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">system</span> <span class="string">description</span> <span class="string">&lt;description&gt;</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">system</span> <span class="string">platform</span> <span class="string">&lt;platform&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="string">configure</span> <span class="string">system</span> <span class="string">interface</span> <span class="string">pattern</span> <span class="string">eth0,eth1</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">system</span> <span class="string">interface</span> <span class="string">permanent</span> <span class="string">eth0,eth1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># rx-and-tx: receive and transmit LLDP frames</span></span><br><span class="line">            <span class="comment"># tx-only:</span></span><br><span class="line">            <span class="comment"># rx-only:</span></span><br><span class="line">            <span class="comment"># disabled:</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">ports</span> <span class="string">eth0,eth1</span> <span class="string">lldp</span> <span class="string">status</span> <span class="string">tx-only</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># TTL is tx-interval * tx-hold, i.e. 120 seconds</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">lldp</span> <span class="string">tx-interval</span> <span class="string">&lt;number,</span> <span class="string">default</span> <span class="string">is</span> <span class="number">30</span> <span class="string">seconds&gt;</span></span><br><span class="line">            <span class="string">configure</span> <span class="string">lldp</span> <span class="string">tx-hold</span> <span class="string">&lt;number,</span> <span class="string">default</span> <span class="string">is</span> <span class="number">4</span><span class="string">&gt;</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Enable</span> <span class="string">lldpd</span> <span class="string">service</span></span><br><span class="line">    <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">lldpd</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">masked:</span> <span class="literal">false</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Start</span> <span class="string">lldpd</span> <span class="string">service</span></span><br><span class="line">    <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">lldpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br></pre></td></tr></table></figure><h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook site.yml</span><br><span class="line"><span class="comment"># or only run role: lldp</span></span><br><span class="line">ansible-playbook site.yml -t lldp</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Let&#39;s run a specified role in Ansible
    
    </summary>
    
    
      <category term="automation" scheme="https://blog.caoyu.info/categories/automation/"/>
    
    
      <category term="ansible" scheme="https://blog.caoyu.info/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>ansible install software from source</title>
    <link href="https://blog.caoyu.info/ansible-install-from-source.html"/>
    <id>https://blog.caoyu.info/ansible-install-from-source.html</id>
    <published>2020-04-30T09:55:47.000Z</published>
    <updated>2020-04-30T09:55:47.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="install-lldpd-from-source-by-ansible"><a href="#install-lldpd-from-source-by-ansible" class="headerlink" title="install lldpd from source by ansible"></a>install lldpd from source by ansible</h1><h2 id="show-the-content"><a href="#show-the-content" class="headerlink" title="show the content"></a>show the content</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat lldpd.yml</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">lldpd</span> <span class="string">installation</span></span><br><span class="line">    <span class="attr">vars:</span></span><br><span class="line">        <span class="attr">lldpd_version:</span> <span class="number">1.0</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Retrieve</span> <span class="string">lldpd</span> <span class="string">source</span> <span class="string">code</span></span><br><span class="line">            <span class="attr">get_url:</span></span><br><span class="line">                <span class="comment"># TODO replace it</span></span><br><span class="line">                <span class="attr">url:</span> <span class="string">https://media.luffy.cx/files/lldpd/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">                <span class="attr">dest:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">archive</span></span><br><span class="line">            <span class="attr">unarchive:</span></span><br><span class="line">                <span class="comment"># if configured like as the following, 'Retrieve lldpd source code' task can be removed</span></span><br><span class="line">                <span class="comment"># src: https://media.luffy.cx/files/lldpd/lldpd-&#123;&#123; lldpd_version &#125;&#125;.tar.gz</span></span><br><span class="line">                <span class="attr">src:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">                <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">install</span></span><br><span class="line">            <span class="attr">command:</span> <span class="string">./configure</span></span><br><span class="line">            <span class="attr">args:</span></span><br><span class="line">                <span class="attr">chdir:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                <span class="attr">creates:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;/configure.status.log</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Build</span> <span class="string">lldpd</span></span><br><span class="line">            <span class="attr">command:</span> <span class="string">make</span></span><br><span class="line">            <span class="attr">args:</span></span><br><span class="line">                <span class="attr">chdir:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                <span class="attr">creates:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;/make.status.log</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Install</span> <span class="string">lldpd</span></span><br><span class="line">            <span class="attr">become:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">command:</span> <span class="string">make</span> <span class="string">install</span></span><br><span class="line">            <span class="attr">args:</span></span><br><span class="line">                <span class="attr">chdir:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                <span class="attr">creates:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;/make_install.status.log</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Create</span> <span class="string">chroot</span> <span class="string">for</span> <span class="string">lldpd</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">/usr/local/var/run/lldpd</span></span><br><span class="line">                <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Create</span> <span class="string">_lldpd</span> <span class="string">group</span></span><br><span class="line">            <span class="attr">group:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">_lldpd</span></span><br><span class="line">                <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Create</span> <span class="string">_lldpd</span> <span class="string">user</span></span><br><span class="line">            <span class="attr">user:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">_lldpd</span></span><br><span class="line">                <span class="attr">group:</span> <span class="string">_lldpd</span></span><br><span class="line">                <span class="attr">comment:</span> <span class="string">lldpd</span> <span class="string">user</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">build</span> <span class="string">directory</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">archive</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">/tmp/lldpd-&#123;&#123;</span> <span class="string">lldpd_version</span> <span class="string">&#125;&#125;.tar.gz</span></span><br><span class="line">                <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Enable</span> <span class="string">lldpd</span> <span class="string">service</span></span><br><span class="line">            <span class="attr">systemd:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">lldpd</span></span><br><span class="line">                <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">masked:</span> <span class="literal">false</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Start</span> <span class="string">lldpd</span> <span class="string">service</span></span><br><span class="line">            <span class="attr">systemd:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">lldpd</span></span><br><span class="line">                <span class="attr">state:</span> <span class="string">started</span></span><br></pre></td></tr></table></figure><h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook lldpd.yml</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Let&#39;s install a software from source in Ansible
    
    </summary>
    
    
      <category term="automation" scheme="https://blog.caoyu.info/categories/automation/"/>
    
    
      <category term="ansible" scheme="https://blog.caoyu.info/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>Asciidoc with Spring Restdocs</title>
    <link href="https://blog.caoyu.info/asciidoc-restdocs.html"/>
    <id>https://blog.caoyu.info/asciidoc-restdocs.html</id>
    <published>2020-04-27T15:02:01.000Z</published>
    <updated>2020-04-27T15:02:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Integrate-Asciidoc-with-Spring-Restdocs"><a href="#Integrate-Asciidoc-with-Spring-Restdocs" class="headerlink" title="Integrate Asciidoc with Spring Restdocs"></a>Integrate Asciidoc with Spring Restdocs</h1><h2 id="Preconditon"><a href="#Preconditon" class="headerlink" title="Preconditon"></a>Preconditon</h2><p><strong>The following is based on Webflux</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">asciidoctor version: 3.2.0</span><br><span class="line">spring restdocs version: 2.0.4.RELEASE</span><br><span class="line">dependency management: gradle</span><br></pre></td></tr></table></figure><p>Some asciidoctor knowledge:</p><p>sourceDir: <code>src/docs/asciidoc</code></p><p>outputDir: <code>${buildDir}/docs/asciidoc</code></p><h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><h3 id="common-config"><a href="#common-config" class="headerlink" title="common config"></a>common config</h3><p>The following config is not a complete configuration.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugins</span></span><br><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">'org.springframework.boot'</span> version <span class="string">'2.3.0.M4'</span></span><br><span class="line">    id <span class="string">'io.spring.dependency-management'</span> version <span class="string">'1.0.9.RELEASE'</span></span><br><span class="line">    id <span class="string">'java'</span></span><br><span class="line">    <span class="comment">/* for rest docs */</span></span><br><span class="line">    id <span class="string">'org.asciidoctor.jvm.convert'</span> version <span class="string">'3.2.0'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configurations &#123;</span><br><span class="line">    asciidoctorExtensions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ext &#123;</span><br><span class="line">    set(<span class="string">'snippetsDir'</span>, file(<span class="string">'build/generated-snippets'</span>))</span><br><span class="line">    set(<span class="string">'springRestdocsVersion'</span>, <span class="string">'2.0.4.RELEASE'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    testImplementation(<span class="string">'org.springframework.boot:spring-boot-starter-test'</span>) &#123;</span><br><span class="line">        exclude <span class="string">group:</span> <span class="string">'org.junit.vintage'</span>, <span class="string">module:</span> <span class="string">'junit-vintage-engine'</span></span><br><span class="line">    &#125;</span><br><span class="line">    testImplementation <span class="string">'io.projectreactor:reactor-test'</span></span><br><span class="line">    <span class="comment">/* for rest docs */</span></span><br><span class="line">    testImplementation <span class="string">"org.springframework.restdocs:spring-restdocs-webtestclient:$&#123;springRestdocsVersion&#125;"</span></span><br><span class="line">    asciidoctorExtensions <span class="string">"org.springframework.restdocs:spring-restdocs-asciidoctor:$&#123;springRestdocsVersion&#125;"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    outputs.dir snippetsDir</span><br><span class="line">    useJUnitPlatform()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asciidoctor &#123;</span><br><span class="line">    configurations <span class="string">'asciidoctorExtensions'</span></span><br><span class="line">    dependsOn test</span><br><span class="line">    attributes <span class="string">'snippets'</span>: snippetsDir</span><br><span class="line">    inputs.dir snippetsDir</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bootJar &#123;</span><br><span class="line">    dependsOn asciidoctor</span><br><span class="line">    from(<span class="string">"$&#123;asciidoctor.outputDir&#125;"</span>) &#123;</span><br><span class="line">        into <span class="string">'static/docs'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="create-docs-asciidoc-directory"><a href="#create-docs-asciidoc-directory" class="headerlink" title="create docs/asciidoc/ directory"></a>create docs/asciidoc/ directory</h3><p>like this</p><p><img src="assets/20200427131513411.png" alt="directory_layout"></p><h3 id="index-adoc-amp-updateUser-adoc-e-g"><a href="#index-adoc-amp-updateUser-adoc-e-g" class="headerlink" title="index.adoc &amp; updateUser.adoc(e.g.)"></a>index.adoc &amp; updateUser.adoc(e.g.)</h3><p>index.adoc</p><figure class="highlight adoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">= Blog Restful API</span></span><br><span class="line">Purple Mystic;</span><br><span class="line"><span class="meta">:toc:</span> left</span><br><span class="line"><span class="meta">:toc-title:</span> Chapter</span><br><span class="line"><span class="meta">:doctype:</span> book</span><br><span class="line"><span class="meta">:icons:</span> font</span><br><span class="line"><span class="meta">:source-highlighter:</span> highlightjs</span><br><span class="line"><span class="meta">:sourcedir:</span> &#123;sourcedir&#125;/user</span><br><span class="line"></span><br><span class="line">include::createUser.adoc[]</span><br><span class="line">include::updateUser.adoc[]</span><br><span class="line">include::findUserById.adoc[]</span><br><span class="line">include::findAllUsers.adoc[]</span><br></pre></td></tr></table></figure><p>updateUser.adoc</p><figure class="highlight adoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">== *Backend: updateUser:*</span></span><br><span class="line"></span><br><span class="line"><span class="section">=== Curl request:</span></span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/updateUser/curl-request.adoc[]</span><br><span class="line"></span><br><span class="line"><span class="section">=== HTTP request:</span></span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/updateUser/http-request.adoc[]</span><br><span class="line"></span><br><span class="line"><span class="section">=== HTTP response:</span></span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/updateUser/http-response.adoc[]</span><br><span class="line"></span><br><span class="line"><span class="section">=== Request using HTTPie:</span></span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/updateUser/httpie-request.adoc[]</span><br><span class="line"></span><br><span class="line"><span class="section">=== Request body:</span></span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/updateUser/request-body.adoc[]</span><br><span class="line"></span><br><span class="line"><span class="section">=== Response body:</span></span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/updateUser/response-body.adoc[]</span><br></pre></td></tr></table></figure><h3 id="Other-solution"><a href="#Other-solution" class="headerlink" title="Other solution"></a>Other solution</h3><ul><li>remove <code>:sourcedir: {sourcedir}/user</code> from index.adoc</li><li>reconfigure asciidoctor task in build.gradle, like this</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">asciidoctor &#123;</span><br><span class="line">    configurations <span class="string">'asciidoctorExtensions'</span></span><br><span class="line">    dependsOn test</span><br><span class="line">    attributes <span class="string">'snippets'</span>: snippetsDir</span><br><span class="line">    inputs.dir snippetsDir</span><br><span class="line">    sources &#123;</span><br><span class="line">        include <span class="string">'**/index.adoc'</span></span><br><span class="line">    &#125;</span><br><span class="line">    baseDirFollowsSourceFile()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Unit-Tests"><a href="#Unit-Tests" class="headerlink" title="Unit Tests"></a>Unit Tests</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> team.star.blog.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mockito;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.mock.mockito.MockBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.restdocs.RestDocumentationContextProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.restdocs.RestDocumentationExtension;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"><span class="keyword">import</span> team.star.blog.pojo.User;</span><br><span class="line"><span class="keyword">import</span> team.star.blog.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.when;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.operation.preprocess.Preprocessors.prettyPrint;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.request.RequestDocumentation.parameterWithName;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.request.RequestDocumentation.pathParameters;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.webtestclient.WebTestClientRestDocumentation.document;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.restdocs.webtestclient.WebTestClientRestDocumentation.documentationConfiguration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mystic</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFluxTest</span>(UserController<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ExtendWith</span>(<span class="title">RestDocumentationExtension</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">UserControllerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line">    <span class="keyword">private</span> WebTestClient client;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">(RestDocumentationContextProvider provider)</span> </span>&#123;</span><br><span class="line">        client = WebTestClient.bindToApplicationContext(context)</span><br><span class="line">                .configureClient()</span><br><span class="line">                .filter(</span><br><span class="line">                        documentationConfiguration(provider)</span><br><span class="line">                                .operationPreprocessors()</span><br><span class="line">                                .withRequestDefaults(prettyPrint())</span><br><span class="line">                                .withResponseDefaults(prettyPrint())</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        User u1 = User.builder().id(<span class="number">1</span>).name(<span class="string">"Mystic"</span>).build();</span><br><span class="line">        User u2 = User.builder().id(<span class="number">2</span>).name(<span class="string">"Ran"</span>).build();</span><br><span class="line"></span><br><span class="line">        when(userService.findAll()).thenReturn(Flux.fromIterable(List.of(u1, u2)));</span><br><span class="line">        when(userService.findById(Mockito.anyInt())).thenReturn(Mono.just(u1));</span><br><span class="line">        when(userService.save(Mockito.any(User<span class="class">.<span class="keyword">class</span>))).<span class="title">thenReturn</span>(<span class="title">Mono</span>.<span class="title">just</span>(<span class="title">u2</span>))</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">findUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        client.get().uri(<span class="string">"/user/&#123;id&#125;"</span>, <span class="number">1</span>)</span><br><span class="line">                .exchange()</span><br><span class="line">                .expectStatus().isOk()</span><br><span class="line">                .expectBody(User<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">                .consumeWith(document("findUserById",</span><br><span class="line">                        pathParameters(parameterWithName(<span class="string">"id"</span>).description(<span class="string">"User ID"</span>))</span><br><span class="line">                ));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">findAllUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        client.get().uri(<span class="string">"/user"</span>).exchange()</span><br><span class="line">                .expectStatus().isOk()</span><br><span class="line">                .expectBodyList(User<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">                .consumeWith(document("findAllUsers"));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u3 = User.builder().name(<span class="string">"cc"</span>).build();</span><br><span class="line">        client.post().uri(<span class="string">"/user"</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                .body(Mono.just(u3), User<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">                .<span class="title">exchange</span>()</span></span><br><span class="line"><span class="class">                .<span class="title">expectStatus</span>().<span class="title">isCreated</span>()</span></span><br><span class="line"><span class="class">                .<span class="title">expectBody</span>()</span></span><br><span class="line">                .jsonPath("$.id").isEqualTo(2)</span><br><span class="line">                .consumeWith(document(<span class="string">"createUser"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u2 = User.builder().id(<span class="number">2</span>).name(<span class="string">"cc"</span>).build();</span><br><span class="line">        client.patch().uri(<span class="string">"/user"</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                .body(Mono.just(u2), User<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">                .<span class="title">exchange</span>()</span></span><br><span class="line"><span class="class">                .<span class="title">expectStatus</span>().<span class="title">isOk</span>()</span></span><br><span class="line"><span class="class">                .<span class="title">expectBody</span>()</span></span><br><span class="line">                .jsonPath("$.name").isEqualTo("Ran")</span><br><span class="line">                .consumeWith(document(<span class="string">"updateUser"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><p><a href="https://github.com/PurpleMystic-star/blog-backend" target="_blank" rel="noopener">https://github.com/PurpleMystic-star/blog-backend</a></p>]]></content>
    
    <summary type="html">
    
      integrate asciidoc with spring restdocs
    
    </summary>
    
    
      <category term="java" scheme="https://blog.caoyu.info/categories/java/"/>
    
    
      <category term="spring" scheme="https://blog.caoyu.info/tags/spring/"/>
    
      <category term="springboot" scheme="https://blog.caoyu.info/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>expand IPv6 by shell</title>
    <link href="https://blog.caoyu.info/expand-ipv6-by-shell.html"/>
    <id>https://blog.caoyu.info/expand-ipv6-by-shell.html</id>
    <published>2020-04-26T15:21:38.000Z</published>
    <updated>2020-04-26T15:21:38.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">expand_ipv6</span></span>() &#123;</span><br><span class="line">    <span class="comment"># input: ::</span></span><br><span class="line">    <span class="comment"># output: 0:0:0:0:0:0:0:0</span></span><br><span class="line">    <span class="comment"># input: 2001:2d:1f::1</span></span><br><span class="line">    <span class="comment"># output: 2001:2d:1f:0:0:0:0:1</span></span><br><span class="line">    <span class="built_in">local</span> ipv6=<span class="variable">$&#123;1&#125;</span></span><br><span class="line">    <span class="built_in">local</span> colon_num=$(<span class="built_in">echo</span> <span class="variable">$&#123;ipv6&#125;</span> | awk <span class="string">'&#123;print gsub(/:/, "")&#125;'</span>)</span><br><span class="line">    <span class="built_in">local</span> replace_str=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> (( i = 0; i &lt;= $(( 7 - <span class="variable">$&#123;colon_num&#125;</span> )); ++ i )); <span class="keyword">do</span></span><br><span class="line">        replace_str=<span class="string">"<span class="variable">$&#123;replace_str&#125;</span>:0"</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    replace_str=<span class="string">"<span class="variable">$&#123;replace_str&#125;</span>:"</span></span><br><span class="line">    <span class="built_in">local</span> ipv6_expanded=<span class="variable">$&#123;ipv6/::/$replace_str&#125;</span></span><br><span class="line">    [[ <span class="variable">$&#123;ipv6_expanded&#125;</span> == *: ]] &amp;&amp; ipv6_expanded=<span class="string">"<span class="variable">$&#123;ipv6_expanded&#125;</span>0"</span></span><br><span class="line">    [[ <span class="variable">$&#123;ipv6_expanded&#125;</span> == :* ]] &amp;&amp; ipv6_expanded=<span class="string">"0<span class="variable">$&#123;ipv6_expanded&#125;</span>"</span></span><br><span class="line">    <span class="comment"># return value</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;ipv6_expanded&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">expand_expanded_ipv6</span></span>() &#123;</span><br><span class="line">    <span class="comment"># input: 0:0:0:0:0:0:0:0</span></span><br><span class="line">    <span class="comment"># output: 0000:0000:0000:0000:0000:0000:0000:0000</span></span><br><span class="line">    <span class="comment"># input: 2001:2d:1f:0:0:0:0:1</span></span><br><span class="line">    <span class="comment"># output: 2001:002d:001f:0000:0000:0000:0000:0001</span></span><br><span class="line">    <span class="built_in">local</span> expanded_ipv6=<span class="variable">$&#123;1&#125;</span></span><br><span class="line">    <span class="built_in">local</span> hex_arr=(<span class="variable">$&#123;expanded_ipv6//:/ &#125;</span>)</span><br><span class="line">    <span class="keyword">for</span> (( i = 0; i &lt; 8; ++ i )); <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">local</span> len=<span class="variable">$&#123;#hex_arr[i]&#125;</span></span><br><span class="line">        <span class="keyword">for</span> (( j = 4; j &gt; <span class="variable">$&#123;len&#125;</span>; -- j )); <span class="keyword">do</span></span><br><span class="line">            hex_arr[i]=<span class="string">"0<span class="variable">$&#123;hex_arr[i]&#125;</span>"</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="comment"># return value</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;hex_arr[@]&#125;</span> | tr <span class="string">" "</span> :</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">convert_ipv6_to_decimal_basing_8bit</span></span>() &#123;</span><br><span class="line">    <span class="comment"># input(hexadecimal): 0000:0000:0000:0000:0000:0000:0000:0000</span></span><br><span class="line">    <span class="comment"># output(decimal): 00.00.00.00.00.00.00.00.00.00.00.00.00.00.00.00</span></span><br><span class="line">    <span class="comment"># input(hexadecimal): 2001:002d:001f:0000:0000:0000:0000:0001</span></span><br><span class="line">    <span class="comment"># output(decimal): 32.1.0.45.0.31.0.0.0.0.0.0.0.0.0.1</span></span><br><span class="line">    <span class="built_in">local</span> completed_ipv6=<span class="variable">$&#123;1&#125;</span></span><br><span class="line">    <span class="built_in">local</span> hex_arr=(<span class="variable">$&#123;completed_ipv6//:/ &#125;</span>)</span><br><span class="line">    <span class="built_in">local</span> hex_arr_split_by_8bit=()</span><br><span class="line">    <span class="keyword">for</span> (( i = 0; i &lt; 8; ++ i )); <span class="keyword">do</span></span><br><span class="line">        hex_arr_split_by_8bit=( <span class="variable">$&#123;hex_arr_split_by_8bit[@]&#125;</span> <span class="variable">$&#123;hex_arr[i]:0:2&#125;</span> <span class="variable">$&#123;hex_arr[i]:2&#125;</span> )</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">local</span> dec_arr=()</span><br><span class="line">    <span class="keyword">for</span> (( i = 0; i &lt; 16; ++ i )); <span class="keyword">do</span></span><br><span class="line">        dec_arr=( <span class="variable">$&#123;dec_arr[@]&#125;</span> $(<span class="built_in">echo</span> $(( 16<span class="comment">#$&#123;hex_arr_split_by_8bit[i]&#125; ))) )</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="comment"># return value</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;dec_arr[@]&#125;</span> | tr <span class="string">" "</span> .</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">convert_ipv6_to_decimal_basing_16bit</span></span>() &#123;</span><br><span class="line">    <span class="comment"># input(hexadecimal): 0:0:0:0:0:0:0:0</span></span><br><span class="line">    <span class="comment"># output(decimal): 0.0.0.0.0.0.0.0</span></span><br><span class="line">    <span class="comment"># input(hexadecimal): 2001:2d:1f:0:0:0:0:1</span></span><br><span class="line">    <span class="comment"># output(decimal): 8193.45.31.0.0.0.0.1</span></span><br><span class="line">    <span class="built_in">local</span> expanded_ipv6=<span class="variable">$&#123;1&#125;</span></span><br><span class="line">    <span class="built_in">local</span> hex_arr=(<span class="variable">$&#123;expanded_ipv6//:/ &#125;</span>)</span><br><span class="line">    <span class="built_in">local</span> dec_arr=()</span><br><span class="line">    <span class="keyword">for</span> (( i = 0; i &lt; 8; ++ i )); <span class="keyword">do</span></span><br><span class="line">        dec_arr=( <span class="variable">$&#123;dec_arr[@]&#125;</span> $(<span class="built_in">echo</span> $(( 16<span class="comment">#$&#123;hex_arr[i]&#125; ))) )</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="comment"># return value</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;dec_arr[@]&#125;</span> | tr <span class="string">" "</span> .</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">expand_ipv6 <span class="variable">$1</span></span><br><span class="line">expand_expanded_ipv6 $(expand_ipv6 <span class="variable">$1</span>)</span><br><span class="line">convert_ipv6_to_decimal_basing_8bit $(expand_expanded_ipv6 $(expand_ipv6 <span class="variable">$1</span>))</span><br><span class="line">convert_ipv6_to_decimal_basing_16bit $(expand_ipv6 <span class="variable">$1</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      expand IPv6
    
    </summary>
    
    
      <category term="shell" scheme="https://blog.caoyu.info/categories/shell/"/>
    
    
      <category term="IPv6" scheme="https://blog.caoyu.info/tags/IPv6/"/>
    
      <category term="shell" scheme="https://blog.caoyu.info/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>How to configure gradle build on Github Actions</title>
    <link href="https://blog.caoyu.info/gradle-build4github-actions.html"/>
    <id>https://blog.caoyu.info/gradle-build4github-actions.html</id>
    <published>2020-04-26T15:21:04.000Z</published>
    <updated>2020-04-26T15:21:04.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This workflow will build a Java project with Gradle</span></span><br><span class="line"><span class="comment"># For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name:</span> <span class="string">Java</span> <span class="string">CI</span> <span class="string">with</span> <span class="string">Gradle</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">    <span class="attr">push:</span></span><br><span class="line">        <span class="attr">branches:</span> <span class="string">[</span> <span class="string">master</span> <span class="string">]</span></span><br><span class="line">    <span class="attr">pull_request:</span></span><br><span class="line">        <span class="attr">branches:</span> <span class="string">[</span> <span class="string">master</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Gradle</span> <span class="string">Automation</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">        <span class="attr">strategy:</span></span><br><span class="line">            <span class="attr">matrix:</span></span><br><span class="line">                <span class="attr">java:</span> <span class="string">[11,</span> <span class="number">13</span><span class="string">]</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">uses:</span> <span class="string">actions/setup-java@v1</span></span><br><span class="line">                <span class="attr">with:</span></span><br><span class="line">                    <span class="attr">java-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.java</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># add cache to improve workflow execution time</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">.gradle/caches</span></span><br><span class="line">                <span class="attr">uses:</span> <span class="string">actions/cache@v1</span></span><br><span class="line">                <span class="attr">with:</span></span><br><span class="line">                    <span class="attr">path:</span> <span class="string">~/.gradle/caches</span></span><br><span class="line">                    <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-gradle-$&#123;&#123;</span> <span class="string">hashFiles('**/*.gradle*')</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                    <span class="attr">restore-keys:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-gradle-</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">.gradle/wrapper</span></span><br><span class="line">                <span class="attr">uses:</span> <span class="string">actions/cache@v1</span></span><br><span class="line">                <span class="attr">with:</span></span><br><span class="line">                    <span class="attr">path:</span> <span class="string">~/.gradle/wrapper</span></span><br><span class="line">                    <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-gradle-wrapper-$&#123;&#123;</span> <span class="string">hashFiles('**/*.gradle')</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                    <span class="attr">restore-keys:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-gradle-wrapper-</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Grant</span> <span class="string">execute</span> <span class="string">permission</span> <span class="string">for</span> <span class="string">gradlew</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">chmod</span> <span class="string">+x</span> <span class="string">gradlew</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Build</span> <span class="string">with</span> <span class="string">Gradle</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">./gradlew</span> <span class="string">clean</span> <span class="string">build</span> <span class="string">-s</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Configure gradle build for github workflow
    
    </summary>
    
    
      <category term="general" scheme="https://blog.caoyu.info/categories/general/"/>
    
    
      <category term="gradle" scheme="https://blog.caoyu.info/tags/gradle/"/>
    
  </entry>
  
  <entry>
    <title>How to set schedule by github actions?</title>
    <link href="https://blog.caoyu.info/set-schedule4github-repo.html"/>
    <id>https://blog.caoyu.info/set-schedule4github-repo.html</id>
    <published>2020-04-25T21:58:58.000Z</published>
    <updated>2020-04-25T21:58:58.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Github-Actions-Schedule"><a href="#Github-Actions-Schedule" class="headerlink" title="Github Actions: Schedule"></a>Github Actions: Schedule</h1><p>Here is a trick to record a day the Miliky Way hasn’t collided with the Andromeda Galaxy.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Has</span> <span class="string">the</span> <span class="string">Milky</span> <span class="string">Way</span> <span class="string">collided</span> <span class="string">with</span> <span class="string">the</span> <span class="string">Andromeda</span> <span class="string">Galaxy?</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># daily job</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">    <span class="attr">schedule:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">cron:</span> <span class="number">0</span> <span class="number">0</span> <span class="string">*</span> <span class="string">*</span> <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">    <span class="comment"># This workflow contains a single job called "build"</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">        <span class="comment"># The type of runner that the job will run on</span></span><br><span class="line">        <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Steps represent a sequence of tasks that will be executed as part of the job</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="comment"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Setup git</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Git</span> <span class="string">Infomation</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">                    <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">'user'</span></span><br><span class="line">                    <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">'email'</span></span><br><span class="line">            <span class="comment"># Record (use record.sh or record2.sh)</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Recording</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">                    <span class="string">sh</span> <span class="string">./record.sh</span></span><br><span class="line">            <span class="bullet">-</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">Pushing</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">                    <span class="string">git</span> <span class="string">push</span> <span class="string">https://$&#123;&#123;github.actor&#125;&#125;:$&#123;&#123;secrets.GITHUB_TOKEN&#125;&#125;@github.com/$&#123;&#123;github.repository&#125;&#125;.git</span> <span class="string">HEAD:$&#123;&#123;</span> <span class="string">github.ref</span> <span class="string">&#125;&#125;</span> <span class="string">||</span> <span class="string">echo</span> <span class="string">"No changes to commit"</span></span><br></pre></td></tr></table></figure><p>For the complete project, you can follow <a href="https://github.com/mystic-cg/galaxy" target="_blank" rel="noopener">here</a>.</p>]]></content>
    
    <summary type="html">
    
      Let&#39;s start a simple schedule in github actions.
    
    </summary>
    
    
      <category term="general" scheme="https://blog.caoyu.info/categories/general/"/>
    
    
      <category term="schedule" scheme="https://blog.caoyu.info/tags/schedule/"/>
    
      <category term="github" scheme="https://blog.caoyu.info/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>Override&amp;Overload in Java and Python</title>
    <link href="https://blog.caoyu.info/overload-override-in-java-python.html"/>
    <id>https://blog.caoyu.info/overload-override-in-java-python.html</id>
    <published>2020-04-25T21:56:25.000Z</published>
    <updated>2020-04-25T21:56:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Override-amp-Overload-in-Java-amp-Python"><a href="#Override-amp-Overload-in-Java-amp-Python" class="headerlink" title="Override &amp; Overload in Java &amp; Python"></a>Override &amp; Overload in Java &amp; Python</h1><h2 id="In-Java"><a href="#In-Java" class="headerlink" title="In Java"></a>In Java</h2><table><thead><tr><th>Overload</th><th>Override</th></tr></thead><tbody><tr><td>参数列表: 必须<strong>不同</strong></td><td>参数列表: 必须<strong>一致</strong></td></tr><tr><td>返回类型: 可以相同, 也可以不同</td><td>返回类型: 相同, 或为派生类型</td></tr><tr><td>一种<strong>编译时多态</strong>例子</td><td>一种<strong>运行时多态</strong>的例子</td></tr><tr><td>重载发生在<strong>同一个类</strong></td><td>重写发生在两个关系为<strong>is-A</strong>的类中</td></tr></tbody></table><h2 id="In-Python"><a href="#In-Python" class="headerlink" title="In Python"></a>In Python</h2><table><thead><tr><th>Overload</th><th>Override</th></tr></thead><tbody><tr><td>没有重载(以下列出原因)</td><td>基本与java一致</td></tr><tr><td>重载要素: 1. 参数类型; 2. 参数数量</td><td>(但是以下代码可运行, 只是不建议这样写)</td></tr><tr><td>Python可以接受任意类型的参数</td><td></td></tr><tr><td>Python可以使用缺省参数</td><td></td></tr><tr><td></td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">f</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, a, b)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">e</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, a, b, d)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a + b + d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a = e()</span><br><span class="line">    print(a.add(<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      What&#39;s difference between Override and Overload? In java, or Python.
    
    </summary>
    
    
      <category term="general" scheme="https://blog.caoyu.info/categories/general/"/>
    
    
      <category term="python" scheme="https://blog.caoyu.info/tags/python/"/>
    
      <category term="java" scheme="https://blog.caoyu.info/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Let&#39;s install multiple python versions in linux</title>
    <link href="https://blog.caoyu.info/install-multi-version-python.html"/>
    <id>https://blog.caoyu.info/install-multi-version-python.html</id>
    <published>2020-04-25T21:55:12.000Z</published>
    <updated>2020-04-25T21:55:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="install-multiple-versions-of-python"><a href="#install-multiple-versions-of-python" class="headerlink" title="install multiple versions of python"></a>install multiple versions of python</h1><p><a href="https://www.python.org/ftp/python/" target="_blank" rel="noopener">All Python Released Source</a></p><p><strong>The following code has been verified in Centos8.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">PYTHON_DIR=<span class="string">"/opt/python/"</span></span><br><span class="line">DOWNLOAD_DIR=<span class="string">"/home/download/"</span></span><br><span class="line">PYTHON_2_HOME=<span class="string">"<span class="variable">$&#123;PYTHON_DIR&#125;</span>/py2"</span></span><br><span class="line">PYTHON_3_HOME=<span class="string">"<span class="variable">$&#123;PYTHON_DIR&#125;</span>/py3"</span></span><br><span class="line">PYTHON_2_VERSION=<span class="string">"2.7.17"</span></span><br><span class="line">PYTHON_3_VERSION=<span class="string">"3.8.2"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ************ preparation ************</span></span><br><span class="line">mkdir -p <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>; mkdir -p <span class="variable">$&#123;PYTHON_2_HOME&#125;</span>; mkdir -p <span class="variable">$&#123;PYTHON_3_HOME&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ! [[ -f <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>/Python-<span class="variable">$&#123;PYTHON_3_VERSION&#125;</span>.tgz ]]; <span class="keyword">then</span></span><br><span class="line">    wget -P <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span> https://www.python.org/ftp/python/<span class="variable">$&#123;PYTHON_3_VERSION&#125;</span>/Python-<span class="variable">$&#123;PYTHON_3_VERSION&#125;</span>.tgz || <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ! [[ -f <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>/Python-<span class="variable">$&#123;PYTHON_2_VERSION&#125;</span>.tgz ]]; <span class="keyword">then</span></span><br><span class="line">    wget -P <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span> https://www.python.org/ftp/python/<span class="variable">$&#123;PYTHON_2_VERSION&#125;</span>/Python-<span class="variable">$&#123;PYTHON_2_VERSION&#125;</span>.tgz || <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">tar -zxvf <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>/Python-<span class="variable">$&#123;PYTHON_3_VERSION&#125;</span>.tgz -C <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span></span><br><span class="line">tar -zxvf <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>/Python-<span class="variable">$&#123;PYTHON_2_VERSION&#125;</span>.tgz -C <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ************ install dependency packages ************</span></span><br><span class="line">yum install -y gcc gcc-c++ automake make autoconf libtool diffutils sudo zlib-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ************ install python 2 ************</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>/Python-<span class="variable">$&#123;PYTHON_2_VERSION&#125;</span> || <span class="built_in">return</span></span><br><span class="line"><span class="comment"># if need, you can uncomment the following code</span></span><br><span class="line"><span class="comment"># make clean</span></span><br><span class="line">./configure --prefix=<span class="variable">$&#123;PYTHON_2_HOME&#125;</span> --<span class="built_in">enable</span>-optimizations</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep 10s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ************ install python 3 ************</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;DOWNLOAD_DIR&#125;</span>/Python-<span class="variable">$&#123;PYTHON_3_VERSION&#125;</span> || <span class="built_in">return</span></span><br><span class="line"><span class="comment"># if need, you can uncomment the following code</span></span><br><span class="line"><span class="comment"># make clean</span></span><br><span class="line">./configure --prefix=<span class="variable">$&#123;PYTHON_3_HOME&#125;</span> --<span class="built_in">enable</span>-optimizations</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ************ manage python version ************</span></span><br><span class="line"><span class="comment"># remove old python version management</span></span><br><span class="line">alternatives --display python | grep priority | awk <span class="string">'&#123;print $1&#125;'</span> | xargs -n1 alternatives --remove python &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="comment"># remove old python2 version management</span></span><br><span class="line">alternatives --display python2 | grep priority | awk <span class="string">'&#123;print $1&#125;'</span> | xargs -n1 alternatives --remove python2 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="comment"># remove old python3 version management</span></span><br><span class="line">alternatives --display python3 | grep priority | awk <span class="string">'&#123;print $1&#125;'</span> | xargs -n1 alternatives --remove python3 &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># rebuild all python version management</span></span><br><span class="line">alternatives --install /usr/bin/python python <span class="variable">$&#123;PYTHON_2_HOME&#125;</span>/bin/python2 1</span><br><span class="line">alternatives --install /usr/bin/python python <span class="variable">$&#123;PYTHON_3_HOME&#125;</span>/bin/python3 9</span><br><span class="line"></span><br><span class="line">alternatives --install /usr/bin/python2 python2 <span class="variable">$&#123;PYTHON_2_HOME&#125;</span>/bin/python2 9</span><br><span class="line">alternatives --install /usr/bin/python3 python3 <span class="variable">$&#123;PYTHON_3_HOME&#125;</span>/bin/python3 9</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Let&#39;s install multiple python versions in linux
    
    </summary>
    
    
      <category term="python" scheme="https://blog.caoyu.info/categories/python/"/>
    
    
      <category term="python" scheme="https://blog.caoyu.info/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>VLAN</title>
    <link href="https://blog.caoyu.info/net-vlan.html"/>
    <id>https://blog.caoyu.info/net-vlan.html</id>
    <published>2020-04-18T21:20:37.000Z</published>
    <updated>2020-04-18T21:20:37.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h1><blockquote><p>  <a href="https://www.utepo.net/article/detail/255.html" target="_blank" rel="noopener">Get to Know Basic Knwoledge of VLAN(Part 1)</a></p><p>  <a href="https://www.utepo.net/article/detail/295.html" target="_blank" rel="noopener">Get to Know Basic Knwoledge of VLAN(Part 2)</a></p></blockquote><h2 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h2><ol><li><p>reduce broadcast storm</p><blockquote><p>  The key advantage of VLAN is that it can isolate the conflict domain as well as broadcast domain. If there are hundreds of hosts in a LAN, the network would be completely paralyzed when a broadcast storm happened. Meanwhile, users can divide the broadcast domain through VLAN, limiting the broadcast to each VLAN, and can not be transferred to cross VLAN. Most important, as consideration to improved security, the broadcasts of different VLANS can not communicate without a layer 3 router.</p></blockquote></li><li><p>simplify the administration of the network</p><blockquote><p>  One of the best things about VLAN is that it simplifies management. By logically grouping users into the same virtual networks, you make it easy to set up and control your policies at a group level. When users physically move workstations, you can keep them on the same network with different equipment. Or if someone changes teams but not workstations, they can easily be given access to whatever new VLANs they need.</p></blockquote></li></ol>]]></content>
    
    <summary type="html">
    
      What&#39;s VLAN?
    
    </summary>
    
    
      <category term="network" scheme="https://blog.caoyu.info/categories/network/"/>
    
    
      <category term="device" scheme="https://blog.caoyu.info/tags/device/"/>
    
  </entry>
  
  <entry>
    <title>trunk in switch</title>
    <link href="https://blog.caoyu.info/net-switch-trunk.html"/>
    <id>https://blog.caoyu.info/net-switch-trunk.html</id>
    <published>2020-04-18T21:18:09.000Z</published>
    <updated>2020-04-18T21:18:09.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Trunk"><a href="#Trunk" class="headerlink" title="Trunk"></a>Trunk</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><blockquote><p>  <a href="https://wenku.baidu.com/view/6694697d657d27284b73f242336c1eb91a373323.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/6694697d657d27284b73f242336c1eb91a373323.html</a></p></blockquote><h2 id="vlan-between-switches"><a href="#vlan-between-switches" class="headerlink" title="vlan between switches"></a>vlan between switches</h2><p><img src="assets/trunk.png" alt="trunk"></p><p>PC1 sends traffic to PC2 after processing its host routing table. These nodes are in the same VLAN but they are connected to different switches. The basic process:</p><ol><li>The Ethernet frame leaves PC1 and is received by Switch 1.</li><li>The Switch 1 SAT indicates that the destination is on the other end of the trunk line.</li><li>Switch 1 uses the trunking protocol to modify the Ethernet frame by adding the VLAN id.</li><li>The new frame leaves the trunk port on Switch1 and is received by Switch 2.</li><li>Switch2 reads the VLAN id and strips off the trunking protocol.</li><li>The original frame is forwarded to the destination (port 4) based on the SAT of Switch 2.</li></ol><h2 id="Openstack-Trunk"><a href="#Openstack-Trunk" class="headerlink" title="Openstack Trunk"></a>Openstack Trunk</h2><p><img src="assets/20200424170120849.png" alt="openstack trunk port"></p><p><a href="https://object-storage-ca-ymq-1.vexxhost.net/swift/v1/6e4619c416ff4bd19e1c087f27a43eea/www-assets-prod/presentation-media/Neutron-Trunks.pdf" target="_blank" rel="noopener">Reference from here1</a></p><p><a href="https://www.oreilly.com/library/view/packet-guide-to/9781449311315/ch04.html" target="_blank" rel="noopener">Reference from here2</a></p>]]></content>
    
    <summary type="html">
    
      What&#39;s Trunk port?
    
    </summary>
    
    
      <category term="network" scheme="https://blog.caoyu.info/categories/network/"/>
    
    
      <category term="device" scheme="https://blog.caoyu.info/tags/device/"/>
    
  </entry>
  
  <entry>
    <title>Let&#39;s understand what&#39;s lldp.</title>
    <link href="https://blog.caoyu.info/net-lldp.html"/>
    <id>https://blog.caoyu.info/net-lldp.html</id>
    <published>2020-04-18T21:08:20.000Z</published>
    <updated>2020-04-18T21:08:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LLDP"><a href="#LLDP" class="headerlink" title="LLDP"></a>LLDP</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>目前，网络设备的种类日益繁多且各自的配置错综复杂，为了使不同厂商的设备能够在网络中相互发现并交互各自的系统及配置信息，需要有一个标准的信息交流平台。</p><p>LLDP（Link Layer Discovery Protocol，<strong>链路层发现协议</strong>）就是在这样的背景下产生的，它提供了一种标准的链路层发现方式，可以将本端设备的<strong>主要能力</strong>、<strong>管理地址</strong>、<strong>设备标识</strong>、<strong>接口标识</strong>等信息组织成不同的<code>TLV</code>（Type/Length/Value，类型/长度/值），并封装在LLDPDU（LLDP Data Unit，<strong>链路层发现协议数据单元</strong>）中发布给与自己直连的邻居，邻居收到这些信息后将其以标准MIB（Management Information Base，<strong>管理信息库</strong>）的形式保存起来，以供网络管理系统查询及判断链路的通信状况。</p><p>类似的还有Cisco Discovery Protocol, Foundry Discovery Protocol, Nortel Discovery Protocol, etc.</p><h2 id="Frame-Structure"><a href="#Frame-Structure" class="headerlink" title="Frame Structure"></a>Frame Structure</h2><p>LLDP的以太帧通常有DST MAC, SRC MAC, EtherType(0x88cc). 以及LLDPDU和FCS组成.</p><p><strong>Ethernet Frame structure</strong>:</p><table><thead><tr><th align="center"><a href="https://en.wikipedia.org/wiki/Preamble_(communication)" target="_blank" rel="noopener">Preamble</a></th><th align="center">Destination MAC</th><th align="center">Source MAC</th><th align="center"><a href="https://en.wikipedia.org/wiki/Ethertype" target="_blank" rel="noopener">Ethertype</a></th><th>LLDPDU</th><th align="center"><a href="https://en.wikipedia.org/wiki/Frame_check_sequence" target="_blank" rel="noopener">Frame check sequence</a></th></tr></thead><tbody><tr><td align="center"></td><td align="center">01:80:c2:00:00:0e, or 01:80:c2:00:00:03, or 01:80:c2:00:00:00</td><td align="center">Station’s address</td><td align="center">0x88CC</td><td></td><td align="center"></td></tr></tbody></table><p><strong>LLDPDU</strong>:</p><table><thead><tr><th>Chassis ID TLV</th><th>Port ID TLV</th><th>Time to live TLV</th><th>Optional TLV(s)</th><th>End of  LLDPDU TLV</th></tr></thead><tbody><tr><td>Type=1</td><td>Type=2</td><td>Type=3</td><td>Optional TLV</td><td>…</td></tr></tbody></table><p><strong>TLV structures</strong>:</p><table><thead><tr><th align="center">Type</th><th align="center">Length</th><th align="center">Value</th></tr></thead><tbody><tr><td align="center">7 bits</td><td align="center">9 bits</td><td align="center">0-511 octets</td></tr></tbody></table><p><strong>TLV type values</strong>:</p><table><thead><tr><th align="center">TLV type</th><th align="center">TLV name</th><th align="center">Usage in LLDPDU</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">End of LLDPDU</td><td align="center">Mandatory</td></tr><tr><td align="center">1</td><td align="center">Chassis ID</td><td align="center">Mandatory</td></tr><tr><td align="center">2</td><td align="center">Port ID</td><td align="center">Mandatory</td></tr><tr><td align="center">3</td><td align="center">Time To Live</td><td align="center">Mandatory</td></tr><tr><td align="center">4</td><td align="center">Port description</td><td align="center">Optional</td></tr><tr><td align="center">5</td><td align="center">System name</td><td align="center">Optional</td></tr><tr><td align="center">6</td><td align="center">System description</td><td align="center">Optional</td></tr><tr><td align="center">7</td><td align="center">System capabilities</td><td align="center">Optional</td></tr><tr><td align="center">8</td><td align="center">Management address</td><td align="center">Optional</td></tr><tr><td align="center">9–126</td><td align="center">Reserved</td><td align="center">-</td></tr><tr><td align="center">127</td><td align="center">Custom TLVs</td><td align="center">Optional</td></tr></tbody></table><p>Custom TLVs are supported via a TLV type 127. The value of a custom TLV starts with a 24-bit organizationally unique identifier and a 1 byte organizationally specific subtype followed by data. The basic format for an organizationally specific TLV is shown below:</p><table><thead><tr><th align="center">Type</th><th align="center">Length</th><th align="center">Organizationally unique identifier (OUI)</th><th align="center">Organizationally defined subtype</th><th align="center">Organizationally defined information string</th></tr></thead><tbody><tr><td align="center">7 bits—127</td><td align="center">9 bits</td><td align="center">24 bits</td><td align="center">8 bits</td><td align="center">0-507 octets</td></tr></tbody></table><p>According to IEEE Std 802.1AB, §9.6.1.3, “The Organizationally Unique Identifier shall contain the organization’s OUI as defined in IEEE Std 802-2001.” Each organization is responsible for managing their subtypes.</p><h2 id="Work-Mechanism"><a href="#Work-Mechanism" class="headerlink" title="Work Mechanism"></a>Work Mechanism</h2><h3 id="LLDP工作模式"><a href="#LLDP工作模式" class="headerlink" title="LLDP工作模式"></a>LLDP工作模式</h3><ul><li>TxRx: 既发送也接收LLDP报文</li><li>Tx: 只发送LLDP报文</li><li>Rx: 只接收LLDP报文</li><li>Disable: 既不发送也不接收LLDP报文</li></ul><p>当端口的LLDP工作模式发生变化时，端口将对协议状态机进行初始化操作。为了避免端口工作模式频繁改变而导致端口不断执行初始化操作，可配置端口初始化延迟时间，当端口工作模式改变时延迟一段时间再执行初始化操作。</p><h3 id="LLDP发送机制"><a href="#LLDP发送机制" class="headerlink" title="LLDP发送机制"></a>LLDP发送机制</h3><blockquote><p>  当端口工作在TxRx或Tx模式时，设备会周期性地向邻居设备发送LLDP报文。如果设备的本地配置发生变化则立即发送LLDP报文，以将本地信息的变化情况尽快通知给邻居设备。但为了防止本地信息的频繁变化而引起LLDP报文的大量发送，每发送一个LLDP报文后都需延迟一段时间后再继续发送下一个报文。</p><p>  当设备的工作模式由Disable/Rx切换为TxRx/Tx，或者发现了新的邻居设备（即收到一个新的LLDP报文且本地尚未保存发送该报文设备的信息）时，该设备将自动启用快速发送机制，即将LLDP报文的发送周期缩短为1秒，并连续发送指定数量的LLDP报文后再恢复为正常的发送周期。</p></blockquote><h3 id="LLDP接收机制"><a href="#LLDP接收机制" class="headerlink" title="LLDP接收机制"></a>LLDP接收机制</h3><blockquote><p>  当端口工作在TxRx或Rx模式时，设备会对收到的LLDP报文及其携带的TLV进行有效性检查，通过检查后再将邻居信息保存到本地，并根据TTL（Time To Live，生存时间） TLV中TTL的值来设置邻居信息在本地设备上的老化时间，若该值为零，则立刻老化该邻居信息。</p></blockquote><p><a href="http://www.h3c.com/cn/d_200805/605853_30003_0.htm" target="_blank" rel="noopener">H3C LLDP Information</a></p><p><a href="https://en.wikipedia.org/wiki/Link_Layer_Discovery_Protocol" target="_blank" rel="noopener">LLDP wiki</a></p>]]></content>
    
    <summary type="html">
    
      What&#39;s LLDP?
    
    </summary>
    
    
      <category term="network" scheme="https://blog.caoyu.info/categories/network/"/>
    
    
      <category term="protocol" scheme="https://blog.caoyu.info/tags/protocol/"/>
    
  </entry>
  
  <entry>
    <title>Switch</title>
    <link href="https://blog.caoyu.info/net-switch.html"/>
    <id>https://blog.caoyu.info/net-switch.html</id>
    <published>2020-04-18T21:08:13.000Z</published>
    <updated>2020-04-18T21:08:13.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Link-Type"><a href="#Link-Type" class="headerlink" title="Link Type"></a>Link Type</h3><blockquote><p>  The link type of VLAN can be divided into <strong>access link</strong> and <strong>trunk link</strong>.</p></blockquote><h4 id="Access-Link"><a href="#Access-Link" class="headerlink" title="Access Link"></a>Access Link</h4><ul><li>Access link is part of only one VLAN, and normally is for end devices.</li><li>Any device attached to an access link is unaware of a VLAN membership.</li><li>An access-link connection can understand only standard Ethernet frames.</li><li>Switches remove any VLAN information from the frame before it is sent to an access-link device.</li></ul><h4 id="Trunk-Link"><a href="#Trunk-Link" class="headerlink" title="Trunk Link"></a>Trunk Link</h4><ul><li>Trunk link can carry multiple VLAN traffic and normally is used to connect switches to other switches or to routers.</li></ul><h2 id="Access-Port"><a href="#Access-Port" class="headerlink" title="Access Port"></a>Access Port</h2><p>l Belong to <strong>one</strong> VLAN.</p><p>l Commonly used to connect computer ports.</p><hr><ul><li>Strip the VLAN information in the packet and forward the packet directly.</li></ul><h2 id="Trunk-Port"><a href="#Trunk-Port" class="headerlink" title="Trunk Port"></a>Trunk Port</h2><p>l Allow <strong>multiple</strong> VLANs through.</p><p>l Receive and send <strong>multiple</strong> VLAN packets.</p><p>l Typically used for connection between switches.</p><hr><ol><li><p>Compare the PVID of the port and the VLAN information in the packet to be transmitted.</p></li><li><p>If they are the same, proceed to Step 3, otherwise, proceed to Step 4</p></li><li><p>Strip the VLAN information in the packet and forward  the packet.</p></li><li><p>Forward the packet directly.</p></li></ol><h2 id="Hybrid-Port"><a href="#Hybrid-Port" class="headerlink" title="Hybrid Port"></a>Hybrid Port</h2><p>l Allow <strong>multiple</strong> VLANs through.</p><p>l Receive and send <strong>multiple</strong> VLAN packets.</p><p>l Used for connection between switches, or switch and computer.</p><hr><ol><li><p>Check the VLAN attributes on this port by running the command disp interface to se whether the VLAN attributes is “tagged” or “untagged”</p></li><li><p>If I is untagged, proceed to Step 3, if it is tagged, proceed to step 4.</p></li><li><p>Strip the VLAN information in the packet and forward the packet.</p></li><li><p>Forward the packet directly.</p></li></ol><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><table><thead><tr><th>Port Type</th><th align="left">Support Mode</th><th>Common use cases</th><th>Comment</th></tr></thead><tbody><tr><td>Access</td><td align="left">single untagged VLAN</td><td>PC/Printer to switch</td><td></td></tr><tr><td>Trunk</td><td align="left">single untagged VLAN &amp; multiple tagged VLANs</td><td>switch/hypervisor to switch</td><td>VLAN 1 can be Tagged (Untagged by default)</td></tr><tr><td>Hybrid</td><td align="left">Support Untagged VLANs &amp; Tagged VLANs</td><td>1. Physical Connection: IP Phone to Network Switch Port &amp; a PC to IP Phone’s Switch port; 2. Logical Connection: Voice VLAN as Tagged &amp; Data VLAN as Untagged &amp; Switch port in Trunk mode</td><td>1. Usually the Untagged VLAN number = Native/Default VLAN number; 2. Support for multi-Untagged Frames, usually require the use of protocol-based VLANs; 3. VLAN 1 can be Tagged (Untagged by default)</td></tr></tbody></table><p><img src="assets/switch-egg.jpg" alt="switch-egg"></p>]]></content>
    
    <summary type="html">
    
      What&#39;s switch?
    
    </summary>
    
    
      <category term="network" scheme="https://blog.caoyu.info/categories/network/"/>
    
    
      <category term="device" scheme="https://blog.caoyu.info/tags/device/"/>
    
  </entry>
  
  <entry>
    <title>tcpdump</title>
    <link href="https://blog.caoyu.info/linux-tcpdump.html"/>
    <id>https://blog.caoyu.info/linux-tcpdump.html</id>
    <published>2020-04-18T21:05:32.000Z</published>
    <updated>2020-04-18T21:05:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="some-common-tcpdump-cli"><a href="#some-common-tcpdump-cli" class="headerlink" title="some common tcpdump cli"></a>some common tcpdump cli</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reading / Writing Captures to a File </span></span><br><span class="line">tcpdump port 80 -w capture_file </span><br><span class="line"></span><br><span class="line"><span class="comment"># read PCAP files by using the -r switch </span></span><br><span class="line">tcpdump -r capture_file </span><br><span class="line"></span><br><span class="line"><span class="comment"># port 2000 of any nic  </span></span><br><span class="line">tcpdump -i any port 2000 –nn </span><br><span class="line"></span><br><span class="line"><span class="comment"># Everything on an interface </span></span><br><span class="line">tcpdump -i eth0 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Find Traffic by IP </span></span><br><span class="line"><span class="comment"># One of the most common queries, using host, you can see traffic that’s going to or from 1.1.1.1. </span></span><br><span class="line">tcpdump host 1.1.1.1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Filtering by Source and/or Destination </span></span><br><span class="line">tcpdump src 1.1.1.1  </span><br><span class="line">tcpdump dst 1.0.0.1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Finding Packets by Network </span></span><br><span class="line">tcpdump net 1.2.3.0/24 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Get Packet Contents with Hex Output </span></span><br><span class="line">tcpdump -c 1 -X icmp </span><br><span class="line"></span><br><span class="line"><span class="comment"># Show Traffic Related to a Specific Port </span></span><br><span class="line">tcpdump port 3389  </span><br><span class="line">tcpdump src port 1025 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Show Traffic of One Protocol </span></span><br><span class="line">tcpdump icmp </span><br><span class="line"></span><br><span class="line"><span class="comment"># Show only IP6 Traffic </span></span><br><span class="line">tcpdump ip6 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Find Traffic Using Port Ranges </span></span><br><span class="line">tcpdump portrange 21-23 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Find Traffic Based on Packet Size </span></span><br><span class="line">tcpdump less 32  </span><br><span class="line">tcpdump greater 64  </span><br><span class="line">tcpdump &lt;= 128 </span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># It’s All About the Combinations </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========= AND =========</span></span><br><span class="line"><span class="comment"># and or &amp;&amp; </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========= OR ========= </span></span><br><span class="line"><span class="comment"># or or || </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========= EXCEPT =========</span></span><br><span class="line"><span class="comment"># not or ! </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># From specific IP and destined for a specific Port </span></span><br><span class="line"><span class="comment"># Let’s find all traffic from 10.5.2.3 going to any host on port 3389. </span></span><br><span class="line">tcpdump -nnvvS src 10.5.2.3 and dst port 3389 </span><br><span class="line"></span><br><span class="line"><span class="comment"># From One Network to Another </span></span><br><span class="line"><span class="comment"># Let’s look for all traffic coming from 192.168.x.x and going to the 10.x or 172.16.x.x networks</span></span><br><span class="line"><span class="comment"># and we’re showing hex output with no hostname resolution and one level of extra verbosity. </span></span><br><span class="line">tcpdump -nvX src net 192.168.0.0/16 and dst net 10.0.0.0/8 or 172.16.0.0/16 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Non ICMP Traffic Going to a Specific IP </span></span><br><span class="line"><span class="comment"># This will show us all traffic going to 192.168.0.2 that is not ICMP. </span></span><br><span class="line">tcpdump dst 192.168.0.2 &amp;&amp; src ! icmp </span><br><span class="line">tcpdump dst 192.168.0.2 and src not icmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># catch packages from(to) eth0 or eth1</span></span><br><span class="line">tcpdump -vi eth0 || eth1 -w tmp.pcap</span><br></pre></td></tr></table></figure><h1 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h1><h2 id="match-MAC-address-amp-VLAN"><a href="#match-MAC-address-amp-VLAN" class="headerlink" title="match MAC address &amp; VLAN"></a>match MAC address &amp; VLAN</h2><ul><li>ether host <MAC> - capture packets sent from and to <MAC></li><li>ether src <MAC> - capture packets sent from <MAC></li><li>ether dst <MAC> - capture packets sent to <MAC></li><li>vlan <VLAN ID> - match <VLAN ID></li></ul><h2 id="match-protocol"><a href="#match-protocol" class="headerlink" title="match protocol"></a>match protocol</h2><p>Match protocols in L3 header:</p><ul><li><code>ip proto</code> - PROTO: icmp, icmp6, igmp, igrp, pim, ah, esp, vrrp, udp, or tcp</li></ul><p>Follow are abbreviations:</p><ul><li><code>icmp</code> = <code>proto icmp</code></li><li><code>tcp</code> = <code>proto tcp</code></li><li><code>udp</code> = <code>proto udp</code></li></ul><p>Match protocols in L2 header:</p><ul><li><code>ether proto</code> - PROTO: ip, ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl, moprc, iso, stp, ipx, or netbeui</li></ul><p>Follow are abbreviations:</p><ul><li><code>ip</code> = <code>ether proto ip</code></li><li><code>ip6</code> = <code>ether proto ip6</code></li><li><code>arp</code> = <code>ether proto arp</code></li><li><code>rarp</code> = <code>ether proto rarp</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 arp</span><br><span class="line">tcpdump -i eth0 icmp</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      some common tcpdump usages
    
    </summary>
    
    
      <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
      <category term="cli" scheme="https://blog.caoyu.info/tags/cli/"/>
    
  </entry>
  
  <entry>
    <title>proxy in linux</title>
    <link href="https://blog.caoyu.info/linux-proxy.html"/>
    <id>https://blog.caoyu.info/linux-proxy.html</id>
    <published>2020-04-18T21:00:15.000Z</published>
    <updated>2020-04-18T21:00:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="proxy-for-linux-centos-rhel"><a href="#proxy-for-linux-centos-rhel" class="headerlink" title="proxy for linux(centos/rhel)"></a>proxy for linux(centos/rhel)</h1><p>Define the environment variables in /etc/environment file if you want to add a permanent proxy in the CentOS/RHEL 7.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"all_proxy=http://proxy.example.com:3128/"</span> &gt; /etc/environment</span><br></pre></td></tr></table></figure><p>For <strong>bash</strong> and <strong>sh</strong> users, add the export line given above into a new file called <strong>/etc/profile.d/http_proxy.sh</strong> file:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"export all_proxy=http://proxy.example.com:3128/"</span> &gt; /etc/profile.d/http_proxy.sh</span><br></pre></td></tr></table></figure><h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a><code>PS</code></h2><table><thead><tr><th>Env Variable</th><th>Desc</th><th>e.g.</th></tr></thead><tbody><tr><td>http_proxy</td><td></td><td>10.0.0.51:8080<br/><a href="http://10.0.0.51:8080" target="_blank" rel="noopener">http://10.0.0.51:8080</a><br/>user:<a href="mailto:pass@10.0.0.10">pass@10.0.0.10</a>:8080<br/>socks4://10.0.0.51:1080<br/>socks5://192.168.1.1:1080</td></tr><tr><td>https_proxy</td><td></td><td>ditto</td></tr><tr><td>ftp_proxy</td><td></td><td>ditto</td></tr><tr><td>all_proxy</td><td>if this variable is set, there is no need to set the above variables</td><td>ditto</td></tr><tr><td>no_proxy</td><td></td><td><em>.aiezu.com,10.</em>.<em>.</em>,192.168.<em>.</em>,*.local,localhost,127.0.0.1</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      set proxy for linux
    
    </summary>
    
    
      <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
      <category term="proxy" scheme="https://blog.caoyu.info/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>config in cloud image</title>
    <link href="https://blog.caoyu.info/linux-cloud-image.html"/>
    <id>https://blog.caoyu.info/linux-cloud-image.html</id>
    <published>2020-04-18T20:56:44.000Z</published>
    <updated>2020-04-18T20:56:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="change-cloud-image-default-config"><a href="#change-cloud-image-default-config" class="headerlink" title="change cloud image default config"></a>change cloud image default config</h1><h2 id="install-package"><a href="#install-package" class="headerlink" title="install package"></a>install package</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y libguestfs-tools</span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">sudo yum install -y libguestfs-tools-c</span><br></pre></td></tr></table></figure><h2 id="Set-root-password"><a href="#Set-root-password" class="headerlink" title="Set root password"></a>Set root password</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a rhel-server-7.6.qcow2 --root-password password:StrongRootPassword</span><br></pre></td></tr></table></figure><h2 id="Register-System"><a href="#Register-System" class="headerlink" title="Register System"></a>Register System</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a overcloud-full.qcow2 --run-command <span class="string">'subscription-manager register --username=[username] --password=[password]'</span></span><br><span class="line"></span><br><span class="line">virt-customize -a rhel-server-7.6.qcow2 --run-command <span class="string">'subscription-manager attach --pool [subscription-pool]'</span></span><br></pre></td></tr></table></figure><h2 id="Install-Software-packages-inside-an-image"><a href="#Install-Software-packages-inside-an-image" class="headerlink" title="Install Software packages inside an image"></a>Install Software packages inside an image</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a rhel-server-7.6.qcow2 --install [vim,bash-completion,wget,curl,telnet,unzip]</span><br><span class="line"></span><br><span class="line">virt-customize -a rhel-server-7.6.qcow2 --install net-tools</span><br></pre></td></tr></table></figure><h2 id="Upload-SSH-public-key"><a href="#Upload-SSH-public-key" class="headerlink" title="Upload SSH public key"></a>Upload SSH public key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set ssh-key for a user(The user must exist in image)</span></span><br><span class="line">virt-customize -a rhel-server-7.6.qcow2  --ssh-inject root:file:./id_rsa.pub</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">virt-customize -a rhel-server-7.6.qcow2 --run-command <span class="string">'useradd mystic'</span> \</span><br><span class="line">--ssh-inject mystic:file:~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><h2 id="Uploading-files"><a href="#Uploading-files" class="headerlink" title="Uploading files"></a>Uploading files</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a rhel-server-7.6.qcow2 --upload rhsm.conf:/etc/rhsm/rhsm.conf</span><br><span class="line"></span><br><span class="line">virt-customize -a rhel-server-7.6.qcow2 --upload yum.conf:/etc/yum.conf</span><br><span class="line"></span><br><span class="line">virt-customize -a rhel-server-7.6.qcow2 --upload proxy.sh:/etc/profile.d/</span><br></pre></td></tr></table></figure><blockquote><p>  The format: <code>local_file_path:image_file_path</code></p></blockquote><h2 id="Set-Timezone"><a href="#Set-Timezone" class="headerlink" title="Set Timezone"></a>Set Timezone</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a rhel-server-7.6.qcow2 --timezone <span class="string">"Asia/Shanghai"</span></span><br></pre></td></tr></table></figure><h2 id="Relabel-SELinux"><a href="#Relabel-SELinux" class="headerlink" title="Relabel SELinux"></a>Relabel SELinux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-customize -a rhel-server-7.6.qcow2 --selinux-relabel</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      how to customize cloud image config
    
    </summary>
    
    
      <category term="linux" scheme="https://blog.caoyu.info/categories/linux/"/>
    
    
      <category term="image" scheme="https://blog.caoyu.info/tags/image/"/>
    
  </entry>
  
  <entry>
    <title>ansible</title>
    <link href="https://blog.caoyu.info/ansible.html"/>
    <id>https://blog.caoyu.info/ansible.html</id>
    <published>2020-04-18T20:24:55.000Z</published>
    <updated>2020-04-18T20:24:55.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h1><blockquote><p>  <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html#directory-layout" target="_blank" rel="noopener">Directory Layout</a></p></blockquote><h2 id="Directory-Layout"><a href="#Directory-Layout" class="headerlink" title="Directory Layout"></a>Directory Layout</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">production                # inventory file for production servers</span><br><span class="line">staging                   # inventory file for staging environment</span><br><span class="line"></span><br><span class="line">group_vars&#x2F;</span><br><span class="line">   group1.yml             # here we assign variables to particular groups</span><br><span class="line">   group2.yml</span><br><span class="line">host_vars&#x2F;</span><br><span class="line">   hostname1.yml          # here we assign variables to particular systems</span><br><span class="line">   hostname2.yml</span><br><span class="line"></span><br><span class="line">library&#x2F;                  # if any custom modules, put them here (optional)</span><br><span class="line">module_utils&#x2F;             # if any custom module_utils to support modules, put them here (optional)</span><br><span class="line">filter_plugins&#x2F;           # if any custom filter plugins, put them here (optional)</span><br><span class="line"></span><br><span class="line">site.yml                  # master playbook</span><br><span class="line">webservers.yml            # playbook for webserver tier</span><br><span class="line">dbservers.yml             # playbook for dbserver tier</span><br><span class="line"></span><br><span class="line">roles&#x2F;</span><br><span class="line">    common&#x2F;               # this hierarchy represents a &quot;role&quot;</span><br><span class="line">        tasks&#x2F;            #</span><br><span class="line">            main.yml      #  &lt;-- tasks file can include smaller files if warranted</span><br><span class="line">        handlers&#x2F;         #</span><br><span class="line">            main.yml      #  &lt;-- handlers file</span><br><span class="line">        templates&#x2F;        #  &lt;-- files for use with the template resource</span><br><span class="line">            ntp.conf.j2   #  &lt;------- templates end in .j2</span><br><span class="line">        files&#x2F;            #</span><br><span class="line">            bar.txt       #  &lt;-- files for use with the copy resource</span><br><span class="line">            foo.sh        #  &lt;-- script files for use with the script resource</span><br><span class="line">        vars&#x2F;             #</span><br><span class="line">            main.yml      #  &lt;-- variables associated with this role</span><br><span class="line">        defaults&#x2F;         #</span><br><span class="line">            main.yml      #  &lt;-- default lower priority variables for this role</span><br><span class="line">        meta&#x2F;             #</span><br><span class="line">            main.yml      #  &lt;-- role dependencies</span><br><span class="line">        library&#x2F;          # roles can also include custom modules</span><br><span class="line">        module_utils&#x2F;     # roles can also include custom module_utils</span><br><span class="line">        lookup_plugins&#x2F;   # or other types of plugins, like lookup in this case</span><br><span class="line"></span><br><span class="line">    webtier&#x2F;              # same kind of structure as &quot;common&quot; was above, done for the webtier role</span><br><span class="line">    monitoring&#x2F;           # &quot;&quot;</span><br><span class="line">    fooapp&#x2F;               # &quot;&quot;</span><br></pre></td></tr></table></figure><p>roles下的目录含义:</p><p><code>files</code>：用来存放由copy模块或script模块调用的文件。<br><code>templates</code>：用来存放jinjia2模板，template模块会自动在此目录中寻找jinjia2模板文件。<br><code>tasks</code>：此目录应当包含一个main.yml文件，用于定义此角色的任务列表，此文件可以使用include包含其它的位于此目录的task文件。<br><code>handlers</code>：此目录应当包含一个main.yml文件，用于定义此角色中触发条件时执行的动作。<br><code>vars</code>：此目录应当包含一个main.yml文件，用于定义此角色用到的变量。<br><code>defaults</code>：此目录应当包含一个main.yml文件，用于为当前角色设定默认变量。<br><code>meta</code>：此目录应当包含一个main.yml文件，用于定义此角色的特殊设定及其依赖关系。</p><h2 id="Alternative-Directory-Layout"><a href="#Alternative-Directory-Layout" class="headerlink" title="Alternative Directory Layout"></a>Alternative Directory Layout</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">inventories&#x2F;</span><br><span class="line">   production&#x2F;</span><br><span class="line">      hosts               # inventory file for production servers</span><br><span class="line">      group_vars&#x2F;</span><br><span class="line">         group1.yml       # here we assign variables to particular groups</span><br><span class="line">         group2.yml</span><br><span class="line">      host_vars&#x2F;</span><br><span class="line">         hostname1.yml    # here we assign variables to particular systems</span><br><span class="line">         hostname2.yml</span><br><span class="line"></span><br><span class="line">   staging&#x2F;</span><br><span class="line">      hosts               # inventory file for staging environment</span><br><span class="line">      group_vars&#x2F;</span><br><span class="line">         group1.yml       # here we assign variables to particular groups</span><br><span class="line">         group2.yml</span><br><span class="line">      host_vars&#x2F;</span><br><span class="line">         stagehost1.yml   # here we assign variables to particular systems</span><br><span class="line">         stagehost2.yml</span><br><span class="line"></span><br><span class="line">library&#x2F;</span><br><span class="line">module_utils&#x2F;</span><br><span class="line">filter_plugins&#x2F;</span><br><span class="line"></span><br><span class="line">site.yml</span><br><span class="line">webservers.yml</span><br><span class="line">dbservers.yml</span><br><span class="line"></span><br><span class="line">roles&#x2F;</span><br><span class="line">    common&#x2F;</span><br><span class="line">    webtier&#x2F;</span><br><span class="line">    monitoring&#x2F;</span><br><span class="line">    fooapp&#x2F;</span><br></pre></td></tr></table></figure><h1 id="env"><a href="#env" class="headerlink" title="env"></a>env</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">./</span><br><span class="line">├── filter_plugins</span><br><span class="line">├── group_vars</span><br><span class="line">├── host_vars</span><br><span class="line">│   └── hosts</span><br><span class="line">├── library</span><br><span class="line">├── module_utils</span><br><span class="line">├── roles</span><br><span class="line">└── site.yaml</span><br><span class="line"></span><br><span class="line">6 directories, 2 files</span><br></pre></td></tr></table></figure><h1 id="ansible-cli"><a href="#ansible-cli" class="headerlink" title="ansible cli"></a>ansible cli</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find system serial</span></span><br><span class="line"><span class="comment"># --module-name or -m    --args or -a</span></span><br><span class="line">ansible localhost --module-name setup --args <span class="string">'filter=ansible_product_serial'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list groups</span></span><br><span class="line">ansible localhost -m debug -a <span class="string">'var=groups'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list groups keys</span></span><br><span class="line">ansible localhost -m debug -a <span class="string">'var=groups.keys()'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list groups(or this command)</span></span><br><span class="line">ansible-inventory -i inventory/prod.yml --list</span><br></pre></td></tr></table></figure><h1 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">hello-world</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">set_fact:</span></span><br><span class="line">                <span class="attr">hello:</span> <span class="string">'hello world'</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Create</span> <span class="string">a</span> <span class="string">file</span> <span class="string">called</span> <span class="string">'/tmp/testfile.txt'</span> <span class="string">with</span> <span class="string">the</span> <span class="string">content</span> <span class="string">'hello world'</span><span class="string">.</span></span><br><span class="line">            <span class="attr">copy:</span></span><br><span class="line">            <span class="comment"># get variable from hostvars</span></span><br><span class="line">                <span class="attr">content:</span> <span class="string">'<span class="template-variable">&#123;&#123; hostvars[inventory_hostname]["hello"] &#125;&#125;</span>'</span></span><br><span class="line">                <span class="attr">dest:</span> <span class="string">/tmp/testfile.txt</span></span><br></pre></td></tr></table></figure><h1 id="append-some-lines-to-a-test-file"><a href="#append-some-lines-to-a-test-file" class="headerlink" title="append some lines to a test file"></a>append some lines to a test file</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">hello-world</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">vars:</span></span><br><span class="line">        <span class="attr">device_by_pci_address:</span> <span class="string">"<span class="template-variable">&#123;&#123;</span></span></span><br><span class="line"><span class="string"><span class="template-variable">            ansible_facts | json_query('@.* | [?pciid].&#123;key: pciid, value: device&#125;') | items2dict</span></span></span><br><span class="line"><span class="string"><span class="template-variable">        &#125;&#125;</span>"</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">To</span> <span class="string">set</span> <span class="string">some</span> <span class="string">variables</span> <span class="string">to</span> <span class="string">hostvars</span></span><br><span class="line">            <span class="attr">set_fact:</span></span><br><span class="line">                <span class="attr">classmates:</span></span><br><span class="line">                    <span class="bullet">-</span></span><br><span class="line">                        <span class="attr">sex:</span> <span class="string">'male'</span></span><br><span class="line">                        <span class="attr">name:</span> <span class="string">'AA'</span></span><br><span class="line">                        <span class="attr">age:</span> <span class="number">15</span></span><br><span class="line">                    <span class="bullet">-</span></span><br><span class="line">                        <span class="attr">sex:</span> <span class="string">'female'</span></span><br><span class="line">                        <span class="attr">name:</span> <span class="string">'BB'</span></span><br><span class="line">                        <span class="attr">age:</span> <span class="number">16</span></span><br><span class="line">                    <span class="bullet">-</span></span><br><span class="line">                        <span class="attr">sex:</span> <span class="string">'male'</span></span><br><span class="line">                        <span class="attr">name:</span> <span class="string">'CC'</span></span><br><span class="line">                    <span class="bullet">-</span></span><br><span class="line">                        <span class="attr">sex:</span> <span class="string">'female'</span></span><br><span class="line">                        <span class="attr">name:</span> <span class="string">'DD'</span></span><br><span class="line">                    <span class="bullet">-</span></span><br><span class="line">                        <span class="attr">sex:</span> <span class="string">'male'</span></span><br><span class="line">                        <span class="attr">name:</span> <span class="string">'lo'</span></span><br><span class="line">                    <span class="bullet">-</span></span><br><span class="line">                        <span class="attr">sex:</span> <span class="string">'female'</span></span><br><span class="line">                        <span class="attr">name:</span> <span class="string">'enp0s3'</span></span><br><span class="line">                <span class="attr">pci_bus_addr2nic:</span> <span class="string">"<span class="template-variable">&#123;&#123; ansible_facts | json_query('@.* | [?pciid].&#123;key: pciid, value: device&#125;') | items2dict &#125;&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">Get</span> <span class="string">system</span> <span class="string">serial</span></span><br><span class="line">            <span class="attr">become:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">shell:</span> <span class="string">cat</span> <span class="string">/sys/devices/virtual/dmi/id/product_serial</span></span><br><span class="line">            <span class="attr">register:</span> <span class="string">system_serial</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">To</span> <span class="string">create</span> <span class="string">a</span> <span class="string">test</span> <span class="string">file</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">/tmp/testfile.txt</span></span><br><span class="line">                <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line">                <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">                <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">                <span class="attr">mode:</span> <span class="number">0777</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">To</span> <span class="string">append</span> <span class="string">some</span> <span class="string">lines</span> <span class="string">to</span> <span class="string">the</span> <span class="string">test</span> <span class="string">file</span></span><br><span class="line">            <span class="attr">lineinfile:</span></span><br><span class="line">                <span class="comment"># test: get the mac address of a nic</span></span><br><span class="line">                <span class="attr">line:</span> <span class="string">'<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>: <span class="template-variable">&#123;&#123; item.sex &#125;&#125;</span> ==&gt; <span class="template-variable">&#123;&#123; ansible_facts[item.name].macaddress &#125;&#125;</span> '</span></span><br><span class="line">                <span class="attr">dest:</span> <span class="string">/tmp/testfile.txt</span></span><br><span class="line">            <span class="attr">loop:</span> <span class="string">'<span class="template-variable">&#123;&#123; hostvars[inventory_hostname]["classmates"] &#125;&#125;</span>'</span></span><br><span class="line">            <span class="attr">when:</span> <span class="string">inventory_hostname</span> <span class="string">not</span> <span class="string">in</span> <span class="string">['host1',</span> <span class="string">'host2'</span><span class="string">]</span> <span class="string">and</span> <span class="string">item.name</span> <span class="string">in</span> <span class="string">['enp0s3']</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">To</span> <span class="string">add</span> <span class="string">a</span> <span class="string">block</span> <span class="string">to</span> <span class="string">a</span> <span class="string">file</span></span><br><span class="line">            <span class="attr">blockinfile:</span></span><br><span class="line">                <span class="attr">dest:</span> <span class="string">/tmp/testfile.txt</span></span><br><span class="line">                <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line">                    <span class="string">hello</span> <span class="string">world</span></span><br><span class="line">                    <span class="string">Java</span> <span class="string">is</span> <span class="string">the</span> <span class="string">best.</span></span><br><span class="line">                    <span class="attr">system_serial.stdout:</span> <span class="string">&#123;&#123;</span> <span class="string">system_serial.stdout</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">                    <span class="string">&#123;&#123;</span> <span class="string">hostvars[inventory_hostname].system_serial.stdout</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                    <span class="comment">#########</span></span><br><span class="line">                    <span class="attr">pci_bus_addr2nic:</span> <span class="string">&#123;&#123;</span> <span class="string">pci_bus_addr2nic</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">                    <span class="string">&#123;&#123;</span> <span class="string">hostvars[inventory_hostname]["pci_bus_addr2nic"]</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                    <span class="comment">###########</span></span><br><span class="line">                    <span class="attr">device_by_pci_address:</span> <span class="string">&#123;&#123;</span> <span class="string">device_by_pci_address</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">                    <span class="attr">Must not Get from this way:</span> <span class="string">hostvars[inventory_hostname]["device_by_pci_address"]</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">debug:</span></span><br><span class="line">                <span class="attr">var:</span> <span class="string">pci_bus_addr2nic</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">debug:</span></span><br><span class="line">                <span class="attr">var:</span> <span class="string">device_by_pci_address</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">debug:</span></span><br><span class="line">                <span class="comment"># this variable is from ansible_facts</span></span><br><span class="line">                <span class="comment"># you can get some info by this command (ansible localhost --module-name setup --args 'filter=ansible_product_serial')</span></span><br><span class="line">                <span class="attr">var:</span> <span class="string">ansible_product_serial</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">debug:</span></span><br><span class="line">                <span class="attr">var:</span> <span class="string">system_serial.stdout</span></span><br></pre></td></tr></table></figure><h2 id="install-a-package-on-RHEL"><a href="#install-a-package-on-RHEL" class="headerlink" title="install a package on RHEL"></a>install a package on RHEL</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">install</span> <span class="string">Apache</span> <span class="string">webserver</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">install</span> <span class="string">httpd</span></span><br><span class="line">            <span class="attr">dnf:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">                <span class="attr">State:</span> <span class="string">latest</span></span><br></pre></td></tr></table></figure><h2 id="install-a-package-on-Debian"><a href="#install-a-package-on-Debian" class="headerlink" title="install a package on Debian"></a>install a package on Debian</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">install</span> <span class="string">Apache</span> <span class="string">webserver</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="string">databases</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">        <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">install</span> <span class="string">Apache</span> <span class="string">webserver</span></span><br><span class="line">            <span class="attr">apt:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">apache2</span></span><br><span class="line">                <span class="attr">State:</span> <span class="string">latest</span></span><br></pre></td></tr></table></figure><h2 id="operate-a-service"><a href="#operate-a-service" class="headerlink" title="operate a service"></a>operate a service</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># https://medium.com/bigpanda-engineering/using-ansible-to-compile-nginx-from-sources-with-custom-modules-f6e6c6a42493</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Start</span> <span class="string">service</span> <span class="string">httpd,</span> <span class="string">if</span> <span class="string">not</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Stop</span> <span class="string">service</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">stopped</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">network</span> <span class="string">service</span> <span class="string">for</span> <span class="string">interface</span> <span class="string">eth0</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">network</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">        <span class="attr">args:</span> <span class="string">enp2s0</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Let&#39;s start a simple sample in Ansible
    
    </summary>
    
    
      <category term="automation" scheme="https://blog.caoyu.info/categories/automation/"/>
    
    
      <category term="ansible" scheme="https://blog.caoyu.info/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>Some repos in aliyun</title>
    <link href="https://blog.caoyu.info/aliyun-repo.html"/>
    <id>https://blog.caoyu.info/aliyun-repo.html</id>
    <published>2020-04-18T20:02:12.000Z</published>
    <updated>2020-04-18T20:02:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pip-Repo"><a href="#Pip-Repo" class="headerlink" title="Pip Repo"></a>Pip Repo</h1> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux</span></span><br><span class="line">mkdir ~/.pip</span><br><span class="line">cat &gt; ~/.pip/pip.conf &lt;&lt; EOF</span><br><span class="line">[global]</span><br><span class="line">index-url=https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># windows</span></span><br><span class="line">mkdir <span class="variable">$HOME</span>/pip</span><br><span class="line">touch <span class="variable">$HOME</span>/pip/pip.ini</span><br></pre></td></tr></table></figure><h1 id="Centos8-Repo"><a href="#Centos8-Repo" class="headerlink" title="Centos8 Repo"></a>Centos8 Repo</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[AppStream]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - AppStream</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;$releasever&#x2F;AppStream&#x2F;$basearch&#x2F;os&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">[BaseOS]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - Base</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;$releasever&#x2F;BaseOS&#x2F;$basearch&#x2F;os&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - extras</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;$releasever&#x2F;extras&#x2F;$basearch&#x2F;os&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">[centosplus]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - centosplus</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;$releasever&#x2F;centosplus&#x2F;$basearch&#x2F;os&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">[HighAvailability]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - HighAvailability</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;$releasever&#x2F;HighAvailability&#x2F;$basearch&#x2F;os&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">[PowerTools]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - PowerTools</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;$releasever&#x2F;PowerTools&#x2F;$basearch&#x2F;os&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">[epel]</span><br><span class="line">name&#x3D;CentOS-$releasever - aliyun - epel</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;epel&#x2F;$releasever&#x2F;Everything&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br></pre></td></tr></table></figure><h1 id="Ubuntu18-04-Repo"><a href="#Ubuntu18-04-Repo" class="headerlink" title="Ubuntu18.04 Repo"></a>Ubuntu18.04 Repo</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      some repos in aliyun
    
    </summary>
    
    
      <category term="general" scheme="https://blog.caoyu.info/categories/general/"/>
    
    
      <category term="repo" scheme="https://blog.caoyu.info/tags/repo/"/>
    
      <category term="pip" scheme="https://blog.caoyu.info/tags/pip/"/>
    
      <category term="centos" scheme="https://blog.caoyu.info/tags/centos/"/>
    
      <category term="ubuntu" scheme="https://blog.caoyu.info/tags/ubuntu/"/>
    
  </entry>
  
</feed>
